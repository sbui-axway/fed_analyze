<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>
    <h2>Policy : Test Timestamp is Absent</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Test_Timestamp_is_Absent.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extract WSS Timestamp</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Test Timestamp is Absent</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>False</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>True</td>
        </tr>
    </table>
    <h3>filter :True</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract WSS Timestamp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully extracted the Timestamp</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract the Timestamp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract WSS Timestamp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>timestampMessageProperty</td>
                <td>wss.timestamp</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Fatal error while extracting the Timestamp. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Remove All Security Tokens</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Remove_All_Security_Tokens.svg">
    <table>
        <tr>
            <td>start</td>
            <td>XSLT Conversion: Remove All Security Tokens from Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Remove All Security Tokens</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>xpath</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>elementSpecifier</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>stylesheetURL</td>
            <td>#removeSecurityTokensInCurrentActor</td>
        </tr>
    </table>
    <h3>filter :Reset Signed NodeList</h3>
    <table>           
            <tr>
                <td>nodeListInsertionType</td>
                <td>reset</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>${node.list}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Located nodes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to locate nodes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>nodeListAttributeName</td>
                <td>nodeList.Signed</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reset Signed NodeList</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during node location. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :XSLT Conversion: Remove All Security Tokens from Message</h3>
    <table>           
            <tr>
                <td>useMessageAttributesAsParameters</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>xmlInplace</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>parameterAttributes</td>
                <td></td>
            </tr>           
            <tr>
                <td>provider</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>keepOriginalContentType</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XSLT Conversion: Remove All Security Tokens from Message</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Reset Encrypted NodeList</h3>
    <table>           
            <tr>
                <td>nodeListInsertionType</td>
                <td>reset</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>${node.list}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Located nodes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to locate nodes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>nodeListAttributeName</td>
                <td>nodeList.Encrypted</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reset Encrypted NodeList</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during node location. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Test Timestamp is Present and Valid</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Test_Timestamp_is_Present_and_Valid.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extract WSS Timestamp</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Test Timestamp is Present and Valid</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Validate &#x27;Created&#x27; timestamp</h3>
    <table>           
            <tr>
                <td>timezone</td>
                <td>UTC</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Timestamp is valid</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Invalid timestamp found in message</td>
            </tr>           
            <tr>
                <td>timestampCheckType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>timeFormat</td>
                <td>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&#x27;Z&#x27;</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate &#x27;Created&#x27; timestamp</td>
            </tr>           
            <tr>
                <td>timestampAttributeName</td>
                <td>${wss.timestamp#Created}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during validation of timestamp. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>driftTime</td>
                <td>5000</td>
            </tr>           
    </table>
    <h3>filter :Extract WSS Timestamp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully extracted the Timestamp</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract the Timestamp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract WSS Timestamp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>timestampMessageProperty</td>
                <td>wss.timestamp</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Fatal error while extracting the Timestamp. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate &#x27;Expires&#x27; timestamp</h3>
    <table>           
            <tr>
                <td>timezone</td>
                <td>UTC</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Timestamp is valid</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Invalid timestamp found in message</td>
            </tr>           
            <tr>
                <td>timestampCheckType</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>timeFormat</td>
                <td>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&#x27;Z&#x27;</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate &#x27;Expires&#x27; timestamp</td>
            </tr>           
            <tr>
                <td>timestampAttributeName</td>
                <td>${wss.timestamp#Expires}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during validation of timestamp. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>driftTime</td>
                <td>5000</td>
            </tr>           
    </table>

    <h2>Policy : Test WSS Username Token is Absent</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Test_WSS_Username_Token_is_Absent.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extract WSS Username Token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Test WSS Username Token is Absent</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>False</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>True</td>
        </tr>
    </table>
    <h3>filter :True</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract WSS Username Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully extracted the WSS Username Token</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract the WSS Username Token</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract WSS Username Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Fatal error while extracting the WSS Username Token. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : XML Threat Policy</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/XML_Threat_Policy.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Message Size Detection - only messages up-to 15k allowed</td>
        </tr>
        <tr>
            <td>name</td>
            <td>XML Threat Policy</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Block Non XML SOAP Attachments</td>
        </tr>
        <tr>
            <td>threatRegExprs</td>
            <td>ASCII Control Characters Except Line Feed and Carriage Return</td>
        </tr>
        <tr>
            <td>scanMimeTypes</td>
            <td>application/*+xml</td>
        </tr>
        <tr>
            <td>cacheToUse</td>
            <td></td>
        </tr>
        <tr>
            <td>validationNodes</td>
            <td>The entire message</td>
        </tr>
    </table>
    <h3>filter :Threatening Content</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>includeHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Message is clean and contains no known threats</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message contains known attacks</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Threatening Content</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while scanning the message for threatening content. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>includeQueryString</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :XML Complexity</h3>
    <table>           
            <tr>
                <td>maxNumChildren</td>
                <td>100</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>maxNumAttributes</td>
                <td>10</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed XML message complexity filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed XML message complexity filtering</td>
            </tr>           
            <tr>
                <td>maxNumNodes</td>
                <td>1000</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML Complexity</td>
            </tr>           
            <tr>
                <td>maxDepthDescendantNodes</td>
                <td>20</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during XML message complexity filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Block Non XML SOAP Attachments</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Request passed attachment filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Request failed attachment filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Block Non XML SOAP Attachments</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during attachment filtering. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>allowAttachments</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Maximum Messages</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>timePeriodUnit</td>
                <td>second</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>timePeriodStartDay</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Maximum number of messages filter was not triggered</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Maximum number of messages filter was triggered</td>
            </tr>           
            <tr>
                <td>numberMessages</td>
                <td>10</td>
            </tr>           
            <tr>
                <td>timePeriodStartHour</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>trackPerKey</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>timePeriod</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Maximum Messages</td>
            </tr>           
            <tr>
                <td>insertRateLimitingHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Throttle filter aborted: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>key</td>
                <td>${http.request.clientaddr.getAddress()}</td>
            </tr>           
    </table>
    <h3>filter :Must be SOAP 1.1 message</h3>
    <table>           
            <tr>
                <td>removeXSI</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>useWSSchema</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Schema validation passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Schema validation failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Must be SOAP 1.1 message</td>
            </tr>           
            <tr>
                <td>inlineMTOMAttachments</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during schema validation. Error:	${circuit.exception}</td>
            </tr>           
            <tr>
                <td>schemaKey</td>
                <td>ZATPGRNCZ45GSDMPW6DJZ55JCC7PM5VW</td>
            </tr>           
    </table>
    <h3>filter :Message Size Detection - only messages up-to 15k allowed</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed message size filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed message size filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Message Size Detection - only messages up-to 15k allowed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>useInCalculation</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>atMostSize</td>
                <td>15000</td>
            </tr>           
            <tr>
                <td>atLeastSize</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during message size filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Reflect</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Health Check</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Health_Check.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Health Check</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Reflect</td>
        </tr>
    </table>
    <h3>filter :Reflect</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;status&gt;ok&lt;/status&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Return HTTP Error 401: Unauthorized</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Return_HTTP_Error_401:_Unauthorized.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Make the &quot;Unauthorized&quot; Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Return HTTP Error 401: Unauthorized</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Pass the &quot;Unauthorized&quot; message back</td>
        </tr>
    </table>
    <h3>filter :Pass the &quot;Unauthorized&quot; message back</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message to IP Address ${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>401</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Pass the &quot;Unauthorized&quot; message back</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Make the &quot;Unauthorized&quot; Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Make the &quot;Unauthorized&quot; Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;TITLE&gt;401 Authorization Required&lt;/TITLE&gt;
&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;Authorization Required&lt;/H1&gt;
This server could not verify that you
are authorized to access the document
requested.  Either you supplied the wrong
credentials (e.g., bad password), or your
browser doesn&#x27;t understand how to supply
the credentials required.&lt;P&gt;
&lt;HR&gt;
&lt;/BODY&gt;&lt;/HTML&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Flag as blocked message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully set the response status</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the response status</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Flag as blocked message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>responseStatus</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>SetResponseStatusFilter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Return HTTP Error 403: Access Denied (Forbidden)</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Return_HTTP_Error_403:_Access_Denied_Forbidden.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Make the &quot;Forbidden&quot; Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Return HTTP Error 403: Access Denied (Forbidden)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Pass the &quot;Forbidden&quot; message back</td>
        </tr>
    </table>
    <h3>filter :Pass the &quot;Forbidden&quot; message back</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message to IP Address is ${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>403</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Pass the &quot;Forbidden&quot; message back</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Flag as blocked message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully set the response status</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the response status</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Flag as blocked message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>responseStatus</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>SetResponseStatusFilter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Make the &quot;Forbidden&quot; Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Make the &quot;Forbidden&quot; Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>Access Denied</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Throttle</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Throttle.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Has Request Exceeded Throttling Limit?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Throttle</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>3B. Set HTTP Response Code to 200</td>
        </tr>
        <tr>
            <td>cacheToUse</td>
            <td></td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>2A. Create Response Indicating Throttle Limit Exceeded</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :3B. Set HTTP Response Code to 200</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3B. Set HTTP Response Code to 200</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :1. Has Request Exceeded Throttling Limit?</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>timePeriodUnit</td>
                <td>second</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>timePeriodStartDay</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Maximum number of messages filter was not triggered</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Maximum number of messages filter was triggered</td>
            </tr>           
            <tr>
                <td>numberMessages</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>timePeriodStartHour</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>trackPerKey</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>timePeriod</td>
                <td>15</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Has Request Exceeded Throttling Limit?</td>
            </tr>           
            <tr>
                <td>insertRateLimitingHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Throttle filter aborted: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>key</td>
                <td>${${http.request.clientaddr.getAddress()}}</td>
            </tr>           
    </table>
    <h3>filter :2A. Create Response Indicating Throttle Limit Exceeded</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2A. Create Response Indicating Throttle Limit Exceeded</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>Warning!!  Throttle Limit has been exceeded</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/plain</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :3A. Set HTTP Response Code to 500</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3A. Set HTTP Response Code to 500</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :2B. Connect to StockQuote Web Service</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2B. Connect to StockQuote Web Service</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : REST to SOAP</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/REST_to_SOAP.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extract REST Request Attributes</td>
        </tr>
        <tr>
            <td>name</td>
            <td>REST to SOAP</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Connect to StockQuote Web Service</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>Price</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Create Text Response for REST Request</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create Text Response for REST Request</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${http.querystring.symbol}:${stockquote.price}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/plain</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve StockQuote Price from SOAP Response</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve StockQuote Price from SOAP Response</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>stockquote.price</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Set HTTP Response Code to 200</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set HTTP Response Code to 200</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connect to StockQuote Web Service</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to StockQuote Web Service</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Create New SOAP Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create New SOAP Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; standalone&#x3D;&quot;no&quot;?&gt;
&lt;soap12:Envelope xmlns:soap12&#x3D;&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap12:Body&gt;
&lt;ns:getPrice xmlns:ns&#x3D;&quot;http://quickstart.samples/xsd&quot;&gt;
&lt;!-- Zero or one occurrences --&gt;
&lt;ns:symbol&gt;${http.querystring.symbol}&lt;/ns:symbol&gt;
&lt;/ns:getPrice&gt;
&lt;/soap12:Body&gt;
&lt;/soap12:Envelope&gt;

</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/soap+xml</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>After - Create NEW SOAP Request</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>http.querystring</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set HTTP Verb</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the HTTP verb for the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the HTTP verb for the message</td>
            </tr>           
            <tr>
                <td>httpVerb</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set HTTP Verb</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the HTTP verb for the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Main</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Main.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1.Decrypt Request</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Main</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2.Route to StockQuote Web Service</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Encrypt</td>
        </tr>
    </table>
    <h3>filter :2.Route to StockQuote Web Service</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2.Route to StockQuote Web Service</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :1.Decrypt Request</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1.Decrypt Request</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :3.Encrypt Response</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3.Encrypt Response</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Encrypt</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Encrypt.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1.Configure XML-Encryption Settings</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Encrypt</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2.Apply XML Encryption</td>
        </tr>
        <tr>
            <td>nodesToEncryptElementSpecifier</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>nodesToEncrypt</td>
            <td>PriceNode</td>
        </tr>
        <tr>
            <td>recipient</td>
            <td>Default Recipient</td>
        </tr>
    </table>
    <h3>filter :1.Configure XML-Encryption Settings</h3>
    <table>           
            <tr>
                <td>insertCarriedKeyName</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>referenceListActor</td>
                <td>##current##</td>
            </tr>           
            <tr>
                <td>failIfNoNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>symmetricKeyEmbedMethod</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>generatedSymmetricKeyAttribute</td>
                <td>symmetric.key</td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>insertTimestamp</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>encryptionAlgorithm</td>
                <td>http://www.w3.org/2001/04/xmlenc#aes256-cbc</td>
            </tr>           
            <tr>
                <td>symmetricEncryptionKeyType</td>
                <td>generated</td>
            </tr>           
            <tr>
                <td>keyWrapAlgorithm</td>
                <td>http://www.w3.org/2001/04/xmlenc#rsa-1_5</td>
            </tr>           
            <tr>
                <td>useDerivedKey</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Setting XML encryption properties failed</td>
            </tr>           
            <tr>
                <td>layoutType</td>
                <td>Lax</td>
            </tr>           
            <tr>
                <td>symmetricKeyAttribute</td>
                <td>symmetric.key</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>node.list</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>encryptKeyWhenNoNodesToEncrypt</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>updateEncKeyReferenceList</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Setting XML encryption properties passed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1.Configure XML-Encryption Settings</td>
            </tr>           
            <tr>
                <td>insertReferenceList</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>readableFormat</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>includeSymmetricKeyInMessage</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while setting the XML encryption. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :2.Apply XML Encryption</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>XML encryption passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>XML encryption failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2.Apply XML Encryption</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during XML encryption. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Decrypt</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Decrypt.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1.Configure XML-Decryption Settings</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Decrypt</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2.Apply XML-Decryption</td>
        </tr>
        <tr>
            <td>nodesToDecrypt</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :2.Apply XML-Decryption</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>XML decryption passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>XML decryption failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2.Apply XML-Decryption</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during XML decryption. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :1.Configure XML-Decryption Settings</h3>
    <table>           
            <tr>
                <td>defaultDerivedKeyLabel</td>
                <td>WS-SecureConversationWS-SecureConversation</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>failIfNoEncryptedData</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>decryptionKeyType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decryptionKeyAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Setting XML decryption properties passed</td>
            </tr>           
            <tr>
                <td>decryptAll</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Setting XML decryption properties failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1.Configure XML-Decryption Settings</td>
            </tr>           
            <tr>
                <td>removeEncryptedKey</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>algorithmSuite</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while setting the XML decryption. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Signature Verification</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Signature_Verification.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Verify the Request XML Signature</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Signature Verification</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2A. Connect to stockquote Web Service</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>signedContent</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>signedContentElementSpecifier</td>
            <td>Body</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>2B. Set HTTP Response Code to 403</td>
        </tr>
        <tr>
            <td>verifyingCert</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>keyLocation</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sigLocation</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>symmetricKeyEncryptionCert</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>wsuIdXPath</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>signingCert</td>
            <td></td>
        </tr>
        <tr>
            <td>sigLocationXPath</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>wsuIdElementSpecification</td>
            <td>Body</td>
        </tr>
        <tr>
            <td>xpathPredicateWhatSign</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :2B. Set HTTP Response Code to 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>403</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2B. Set HTTP Response Code to 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :2A. Connect to stockquote Web Service</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2A. Connect to stockquote Web Service</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :1. Verify the Request XML Signature</h3>
    <table>           
            <tr>
                <td>defaultDerivedKeyLabel</td>
                <td>WS-SecureConversationWS-SecureConversation</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>sigPosition</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Integrity: Signature verification failed</td>
            </tr>           
            <tr>
                <td>signatureConfirmationType</td>
                <td>none</td>
            </tr>           
            <tr>
                <td>algorithmSuite</td>
                <td></td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>allAttachmentsSigned</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>removeWsSecurity</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>verifyForAuthentication</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>node.list</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td>##current##</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Integrity: Signature verification passed</td>
            </tr>           
            <tr>
                <td>failIfNoSignatures</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Verify the Request XML Signature</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Integrity: Signature verification error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :3. Sign the Response</h3>
    <table>           
            <tr>
                <td>insertCarriedKeyName</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>failIfNoNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>signingCertAttribute</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>keyWrapAlgorithm</td>
                <td>http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</td>
            </tr>           
            <tr>
                <td>sigLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to sign message</td>
            </tr>           
            <tr>
                <td>symmetricKeyEncryptionCertAttribute</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>timestampType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>nodesToSignIdAttrName</td>
                <td>wsu:Id</td>
            </tr>           
            <tr>
                <td>useSamlId</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>node.list</td>
            </tr>           
            <tr>
                <td>signatureMethod</td>
                <td>http://www.w3.org/2000/09/xmldsig#rsa-sha1</td>
            </tr>           
            <tr>
                <td>signingKeyType</td>
                <td>certificateInStore</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Signed message successfully</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3. Sign the Response</td>
            </tr>           
            <tr>
                <td>readableFormat</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during message signing. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>hmacSymmetricKeyLen</td>
                <td>256</td>
            </tr>           
            <tr>
                <td>symmetricSigningKeyType</td>
                <td>generated</td>
            </tr>           
            <tr>
                <td>envelopedSignature</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>generatedSymmetricKeyAttribute</td>
                <td>symmetric.key</td>
            </tr>           
            <tr>
                <td>specifyInclusiveNamespaces</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useDerivedKey</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>signatureConfirmationType</td>
                <td>none</td>
            </tr>           
            <tr>
                <td>additionalItemsToSign</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>layoutType</td>
                <td>Lax</td>
            </tr>           
            <tr>
                <td>keyType</td>
                <td>asymmetric</td>
            </tr>           
            <tr>
                <td>symmetricKeyEncryptionKeyType</td>
                <td>certificateInStore</td>
            </tr>           
            <tr>
                <td>symmetricKeyAttribute</td>
                <td>symmetric.key</td>
            </tr>           
            <tr>
                <td>appendToRootOrSoapHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>includeTransforms</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>digestAlgorithm</td>
                <td>http://www.w3.org/2000/09/xmldsig#sha1</td>
            </tr>           
            <tr>
                <td>timestampLifeTimeSecs</td>
                <td>300</td>
            </tr>           
            <tr>
                <td>wsuIdHow</td>
                <td>xpath</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td>##current##</td>
            </tr>           
            <tr>
                <td>strForSaml</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>includeSymmetricKeyInMessage</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>attachmentTransform</td>
                <td></td>
            </tr>           
    </table>

    <h2>Policy : Add Instance Name to Response</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Add_Instance_Name_to_Response.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Add Instance Name to Response</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Add Instance Name to Response</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>nodeLocation</td>
            <td>StockQuoteResponseNode</td>
        </tr>
    </table>
    <h3>filter :Add Instance Name to Response</h3>
    <table>           
            <tr>
                <td>nodeName</td>
                <td></td>
            </tr>           
            <tr>
                <td>nodeNamespace</td>
                <td></td>
            </tr>           
            <tr>
                <td>newNodeSource</td>
                <td>newCreation</td>
            </tr>           
            <tr>
                <td>newNodeMessageAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>insertType</td>
                <td>xpath</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>nodeLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>nodeContent</td>
                <td>&lt;servedBy&gt;${stockquote.instance.name}&lt;/servedBy&gt;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>nodeType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully inserted XML node into message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to insert XML node into the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add Instance Name to Response</td>
            </tr>           
            <tr>
                <td>nodeNamespacePrefix</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error inserting XML mode into the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Route to Instance 1</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Route_to_Instance_1.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to Instance1</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Route to Instance 1</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Instance Name</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Call &#x27;Return Routing Failure&#x27;</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Return Routing Failure</td>
        </tr>
    </table>
    <h3>filter :Connect to Instance1</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Instance1</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Set Instance Name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>instance1</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>stockquote.instance.name</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Instance Name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Return Routing Failure&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Return Routing Failure&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Route to Instance 2</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Route_to_Instance_2.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to Instance2</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Route to Instance 2</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Return Routing Failure</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Instance Name</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Call &#x27;Return Routing Failure&#x27;</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Return Routing Failure&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Return Routing Failure&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connect to Instance2</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>false</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://stockquote.com/stockquote/instance2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Instance2</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Set Instance Name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>instance2</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>stockquote.instance.name</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Instance Name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Threat Protection</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Threat_Protection.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Check Message Size</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Threat Protection</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Detects Viruses and Attacks</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>content-filtering</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Check XML Complexity</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Call &#x27;Return Invalid Message Failure&#x27;</td>
        </tr>
        <tr>
            <td>threatRegExprs</td>
            <td>DOCTYPE DTD Reference</td>
        </tr>
        <tr>
            <td>scanMimeTypes</td>
            <td>application/*+xml</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Return Invalid Message Failure</td>
        </tr>
    </table>
    <h3>filter :Check XML Complexity</h3>
    <table>           
            <tr>
                <td>maxNumChildren</td>
                <td>20</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>maxNumAttributes</td>
                <td>10</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed XML message complexity filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed XML message complexity filtering</td>
            </tr>           
            <tr>
                <td>maxNumNodes</td>
                <td>10</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Check XML Complexity</td>
            </tr>           
            <tr>
                <td>maxDepthDescendantNodes</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during XML message complexity filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Block Threatening Content</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>includeHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Message is clean and contains no know threats</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message contains known attacks</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Block Threatening Content</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while scanning the message for threatening content. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>includeQueryString</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Return Invalid Message Failure&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Return Invalid Message Failure&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Check Message Size</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>atLeastSize</td>
                <td>-1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed message size filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed message size filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Check Message Size</td>
            </tr>           
            <tr>
                <td>useInCalculation</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>atMostSize</td>
                <td>1500</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during message size filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Set Global Data</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Set_Global_Data.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Initialize attributes</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Set Global Data</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Initializes error.code and error.message to default values</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
    </table>
    <h3>filter :Initialize attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialize attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Return Invalid Message Failure</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Return_Invalid_Message_Failure.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Failure Data</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Return Invalid Message Failure</td>
        </tr>
        <tr>
            <td>description</td>
            <td>When Threat has been detected</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>False Filter</td>
        </tr>
    </table>
    <h3>filter :Set Failure Data</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Failure Data</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Global Exception Handler</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Global_Exception_Handler.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Exception Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Global Exception Handler</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Use as generic exception handling</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Response Status</td>
        </tr>
    </table>
    <h3>filter :Set Response Status</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully set the response status</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the response status</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Response Status</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>responseStatus</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>SetResponseStatusFilter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Exception Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Exception Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;
&lt;env:Envelope xmlns:env&#x3D;&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
    &lt;env:Header&gt;&lt;/env:Header&gt;
    &lt;env:Body&gt;
        &lt;env:Fault&gt;
            &lt;env:Code&gt;
                &lt;env:Value&gt;env:Receiver&lt;/env:Value&gt;
                &lt;env:Subcode&gt;
                    &lt;env:Value xmlns:fault&#x3D;&quot;http://www.vordel.com/soapfaults&quot;&gt;
                       ${error.code}
		       ${error.message}
                    &lt;/env:Value&gt;
                &lt;/env:Subcode&gt;
            &lt;/env:Code&gt;
            &lt;env:Reason&gt;
                &lt;env:Text lang&#x3D;&quot;en&quot;&gt;
                   Your request failed. Contact the administrator with the following code : ${id}
                &lt;/env:Text&gt;
            &lt;/env:Reason&gt;
        &lt;/env:Fault&gt;
    &lt;/env:Body&gt;
&lt;/env:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Return 500 code</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Return 500 code</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Return Routing Failure</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Return_Routing_Failure.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Failure Data</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Return Routing Failure</td>
        </tr>
        <tr>
            <td>description</td>
            <td>When Routing to Axis fails</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>False Filter</td>
        </tr>
    </table>
    <h3>filter :Set Failure Data</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Failure Data</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Main Policy</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Main_Policy.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Initialize Global Message Attributes</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Main Policy</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Top policy to invoke the service</td>
        </tr>
        <tr>
            <td>fault</td>
            <td>Call &#x27;Global Exception Handler&#x27;</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Global Exception Handler</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2. Apply Threat Detection</td>
        </tr>
    </table>
    <h3>filter :4. Add Instance Name to Response</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>4. Add Instance Name to Response</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :2. Apply Threat Detection</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2. Apply Threat Detection</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :3. Route based on Symbol Value</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3. Route based on Symbol Value</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :1. Initialize Global Message Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Initialize Global Message Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Global Exception Handler&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Global Exception Handler&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Route based on Symbol Value</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Route_based_on_Symbol_Value.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Retrieve symbol value from message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Route based on Symbol Value</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Routes on Symbol Value</td>
        </tr>
        <tr>
            <td>fault</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Choose Instance to send request to</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>defaultCircuit</td>
            <td>Route to Instance 1</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>SymbolValue</td>
        </tr>
    </table>
    <h3>filter :Choose Instance to send request to</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>defaultOption</td>
                <td>RETURN_DEFAULT_CIRCUIT</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Choose Instance to send request to</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>${message.symbol.value}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Retrieve symbol value from message</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Symbol not found in incoming message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve symbol value from message</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>message.symbol.value</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : StockQuote Update</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/StockQuote_Update.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Retrieve StockQuote Symbol</td>
        </tr>
        <tr>
            <td>name</td>
            <td>StockQuote Update</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2. Set HTTP Response Code to 202 (Accepted)</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>symbol</td>
        </tr>
    </table>
    <h3>filter :2. Set HTTP Response Code to 202 (Accepted)</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>202</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2. Set HTTP Response Code to 202 (Accepted)</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :1. Retrieve StockQuote Symbol</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Retrieve StockQuote Symbol</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>stockquote.symbol</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : StockQuote GetPrice</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/StockQuote_GetPrice.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Retrieve StockQuote Symbol</td>
        </tr>
        <tr>
            <td>name</td>
            <td>StockQuote GetPrice</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>4. Set HTTP Response Code</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>symbol</td>
        </tr>
    </table>
    <h3>filter :1. Retrieve StockQuote Symbol</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Retrieve StockQuote Symbol</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>stockquote.symbol</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :2. Set StockQuote Price</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>stockquote.price</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
var randomnumber &#x3D; Math.floor(Math.random()*101)
msg.put(&quot;stockquote.price&quot;,randomnumber);
return true;         }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2. Set StockQuote Price</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :3. Create SOAP Response</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>3. Create SOAP Response</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
 &lt;soap:Envelope
 xmlns:soap&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;

 &lt;soap:Body xmlns:m&#x3D;&quot;http://www.example.org/stock&quot;&gt;
   &lt;m:GetStockPriceResponse&gt;
     &lt;m:Price&gt;${stockquote.price}&lt;/m:Price&gt;
   &lt;/m:GetStockPriceResponse&gt;
&lt;/soap:Body&gt;

 &lt;/soap:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/soap+xml</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :4. Set HTTP Response Code</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>4. Set HTTP Response Code</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : StockQuote</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/StockQuote.svg">
    <table>
        <tr>
            <td>start</td>
            <td>1. Retrieve SOAP Operation Name</td>
        </tr>
        <tr>
            <td>name</td>
            <td>StockQuote</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>2. Switch on SOAP Operation value</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>defaultCircuit</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>The Soap Operation Name</td>
        </tr>
    </table>
    <h3>filter :2. Switch on SOAP Operation value</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>defaultOption</td>
                <td>RETURN_FALSE</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>2. Switch on SOAP Operation value</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>${soap.operation}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :1. Retrieve SOAP Operation Name</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>1. Retrieve SOAP Operation Name</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>soap.operation</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Default URL-based Routing</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Default_URL-based_Routing.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Default URL-based Routing</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${destinationURL}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Connexion</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Connexion.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Debut Chrono trace Technique Backend</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Connexion</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>content-filtering</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>xpathContentCheck</td>
            <td>XPATH is SOAP Fault ?</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Faux filtre</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>Server Error (500-599)</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td></td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td></td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Generation Trace Technique BACKEND</td>
        </tr>
        <tr>
            <td>caCerts</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :soap.fault.detail ANO-HTTP-SOAP-FAULT-WS-BACK-END</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {           
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-SOAP-FAULT-WS-BACK-END&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;SOAP Fault from WS back-end&quot;);
	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-HTTP-SOAP-FAULT-WS-BACK-END</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is SOAP Fault ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Le message a réussi le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Le message a échoué le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is SOAP Fault ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors du filtrage XPath. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connexion au WS Back-end</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>100</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec d&#x27;acheminement de la demande au point de fin.</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${ws.backend.protocol}://${ws.hostname.suffix}${ws.backend.host}:${ws.backend.port}${ws.backend.uri}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Demande acheminée avec succès au point de fin</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connexion au WS Back-end</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;acheminement de la demande au point de fin. Erreur : ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :is SOAP Fault 500 ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Le message a réussi le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Le message a échoué le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is SOAP Fault 500 ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors du filtrage XPath. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Définir Attribut trace.audit.code.statut</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Success</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>trace.audit.code.statut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Définir Attribut trace.audit.code.statut</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Generation Trace Technique BACKEND&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Generation Trace Technique BACKEND&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connexion au WS Partenaire BDF SANS PROXY</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>100</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec d&#x27;acheminement de la demande au point de fin.</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${ws.backend.protocol}://${ws.backend.host}:${ws.backend.port}${ws.backend.uri}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Demande acheminée avec succès au point de fin</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connexion au WS Partenaire BDF SANS PROXY</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;acheminement de la demande au point de fin. Erreur : ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Test code retour HTTP web service back-end (50x)</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Test code retour HTTP web service back-end (50x)</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut trace.technique.backend.status</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Success</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>trace.technique.backend.status</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut trace.technique.backend.status</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Debut Chrono trace Technique Backend</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importClass(java.lang.System);

function invoke(msg)         {      

	msg.put(&quot;ws.backend.start.time&quot;, System.currentTimeMillis());      
	
	return true;         
	
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Debut Chrono trace Technique Backend</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-HTTP-WS-BACK-END-ECHEC-CONNEXION</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {           
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-WS-BACK-END-ECHEC-CONNEXION&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Echec appel WS back-end&quot;);
	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-HTTP-WS-BACK-END-ECHEC-CONNEXION</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Test code retour HTTP web service back-end (20x)</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Test code retour HTTP web service back-end (20x)</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connexion au WS Partenaire BDF AVEC PROXY</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>100</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec d&#x27;acheminement de la demande au point de fin.</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${ws.backend.protocol}://${ws.backend.host}:${ws.backend.port}${ws.backend.uri}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Demande acheminée avec succès au point de fin</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connexion au WS Partenaire BDF AVEC PROXY</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;acheminement de la demande au point de fin. Erreur : ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :is Environment PROD or PREX or RECETTE OUVERTE?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Environment PROD or PREX or RECETTE OUVERTE?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Success ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Success ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Validation Header HTTP</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Validation_Header_HTTP.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extraction Identifiant Client</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Validation Header HTTP</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>is Identifiant Message Empty ?</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Validation Header SOAP</td>
        </tr>
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Validation Header SOAP&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Validation Header SOAP&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction Identifiant Client</h3>
    <table>           
            <tr>
                <td>headerName</td>
                <td>X-ClientID</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>base64Decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Attribut extrait de l&#x27;en-tête HTTP</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec d&#x27;extraction d&#x27;attribut de l&#x27;en-tête HTTP</td>
            </tr>           
            <tr>
                <td>useQueryParameter</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction Identifiant Client</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>trace.technique.circuit.appelant</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;extraction d&#x27;attributs de l&#x27;en-tête HTTP. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Identifiant Client Empty ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Identifiant Client Empty ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Identifiant Message Empty ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Identifiant Message Empty ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-MESSAGE-ID&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;En-tete de correlation absent !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-CLIENT-ID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {

	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-CLIENT-ID&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;En-tete de correlation absent !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-CLIENT-ID</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail.code is NULL ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail.code is NULL ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-INVALID-SIZE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-INVALID-SIZE&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;En-tete doit etre renseigne !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-INVALID-SIZE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction Identifiant Message</h3>
    <table>           
            <tr>
                <td>headerName</td>
                <td>X-RequestID</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>base64Decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Attribut extrait de l&#x27;en-tête HTTP</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec d&#x27;extraction d&#x27;attribut de l&#x27;en-tête HTTP</td>
            </tr>           
            <tr>
                <td>useQueryParameter</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction Identifiant Message</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>trace.technique.circuit.correlationID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;extraction d&#x27;attributs de l&#x27;en-tête HTTP. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Validation Header SOAP</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Validation_Header_SOAP.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Service autorisant les headers SOAP?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Validation Header SOAP</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>is Identifiant Message Empty ?</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>XPATH Location element X-RequestID</td>
        </tr>
    </table>
    <h3>filter :Service autorisant les headers SOAP?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Service autorisant les headers SOAP?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Identifiant Message Empty ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Identifiant Message Empty ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-INVALID-SIZE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-INVALID-SIZE&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;En-tete doit etre renseigne !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-INVALID-SIZE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Identifiant Client Empty ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Identifiant Client Empty ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction du header SOAP X-ClientID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction du header SOAP X-ClientID</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>trace.technique.circuit.appelant</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-NOT-SOAP</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-NOT-SOAP&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Ce service ne prend pas en charge la correlmation SOAP !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-NOT-SOAP</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Maj app.authorized.customer avec app.authorized.soapCustomer</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Maj app.authorized.customer avec app.authorized.soapCustomer</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :True Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-CORRELATION-MESSAGE-ID&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;En-tete de correlation absent !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-CORRELATION-MESSAGE-ID</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction header SOAP X-RequestID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction header SOAP X-RequestID</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>trace.technique.circuit.correlationID</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Point Entree 3C</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Point_Entree_3C.svg">
    <table>
        <tr>
            <td>start</td>
            <td>is Type Flux Entrant ?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Point Entree 3C</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>content-filtering</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Suppression du jeton de sécurité</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Supression HTTP Header HOST</td>
        </tr>
        <tr>
            <td>nodeLocation</td>
            <td>XPATH localisation de l&#x27;elementwsse:Security</td>
        </tr>
    </table>
    <h3>filter :Add HTTP Header Host</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Host</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${ws.backend.host}:${ws.backend.port}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Host</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Ajout identifiants corrélation trace technique</h3>
    <table>           
            <tr>
                <td>nodeName</td>
                <td></td>
            </tr>           
            <tr>
                <td>nodeNamespace</td>
                <td></td>
            </tr>           
            <tr>
                <td>newNodeSource</td>
                <td>newCreation</td>
            </tr>           
            <tr>
                <td>newNodeMessageAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>insertType</td>
                <td>xpath</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>nodeLocationType</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>nodeContent</td>
                <td>&lt;soapenv:Header xmlns:soapenv&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;&lt;ns1:transactionID soapenv:actor&#x3D;&quot;http://schemas.xmlsoap.org/soap/actor/next&quot; soapenv:mustUnderstand&#x3D;&quot;0&quot; xmlns:ns1&#x3D;&quot;urn:interops:cdc:retraite:trace:technique:1:0&quot;&gt;${trace.technique.circuit.transactionID}&lt;/ns1:transactionID&gt;&lt;ns2:clientID soapenv:actor&#x3D;&quot;http://schemas.xmlsoap.org/soap/actor/next&quot; soapenv:mustUnderstand&#x3D;&quot;0&quot; xmlns:ns2&#x3D;&quot;urn:interops:cdc:retraite:trace:technique:1:0&quot;&gt;${trace.technique.backend.appelant}&lt;/ns2:clientID&gt;&lt;/soapenv:Header&gt;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>nodeType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully inserted XML node into message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to insert XML node into the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Ajout identifiants corrélation trace technique</td>
            </tr>           
            <tr>
                <td>nodeNamespacePrefix</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error inserting XML mode into the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Supression HTTP Header HOST</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Host</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Supression HTTP Header HOST</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-ADD-HEADER-CORRELATION</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-ADD-HEADER-CORRELATION</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {          
	msg.put(&quot;soap.fault.detail&quot;, &quot;Erreur lors de l&#x27;ajout des identifiants de correlation&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-ADD-HEADER-CORRELATION&quot;);
	return true;
   }</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-REMOVE-TOKEN</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-REMOVE-TOKEN</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {           
	msg.put(&quot;soap.fault.detail&quot;, &quot;Erreur lors de la suppression du jeton de securite a destination du back-end&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-REMOVE-TOKEN&quot;);
	return true;
}</td>
            </tr>           
    </table>
    <h3>filter :Suppression du jeton de sécurité</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>failIfNoNodesFound</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully removed XML node from message</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to remove XML node from the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Suppression du jeton de sécurité</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error removing XML mode from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI APP - MIP 3A (preparation message)</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_APP_-_MIP_3A_preparation_message.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Message To CNAV</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI APP - MIP 3A (preparation message)</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Faux filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message To CNAV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message ${content.body}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message To CNAV</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;soap:Envelope xmlns:soap&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;
	xmlns:wsse&#x3D;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;
	xmlns:wsse11&#x3D;&quot;http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd&quot;
	xmlns:wsu&#x3D;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;
	xmlns:xsi&#x3D;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
	&lt;soap:Header&gt;
		&lt;wsse:Security&gt;${saml.assertion}&lt;/wsse:Security&gt;
	&lt;/soap:Header&gt;
&lt;soap:Body&gt;
${content.body.bak}
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-SET-BODY</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-SET-BODY</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {           
	msg.put(&quot;soap.fault.detail&quot;, &quot;Erreur lors de l&#x27;initialisation du message a destination du back-end&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-SET-BODY&quot;);
	return true;
}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Debut Circuit</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Debut_Circuit.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Debut Chrono Trace Technique Circuit</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Debut Circuit</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Appeler &#x27;DEI LIB - Politique Verification Plage Ouverture Service&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Initialisation Context Circuit</td>
        </tr>
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Verification Plage Ouverture Service&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Verification Plage Ouverture Service&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Debut Chrono Trace Technique Circuit</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.lang);

function invoke(msg)         {

	//Initialisation date début circuit
	msg.put(&quot;start.time.circuit&quot;, System.currentTimeMillis());

    return true;         
            
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Debut Chrono Trace Technique Circuit</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEI LIB - Deverminage&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEI LIB - Deverminage&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute soap.method.requested</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Attributs copiés avec succès</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de copie des attributs</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute soap.method.requested</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la copie des attributs. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Controles Generiques Message Entrant&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Controles Generiques Message Entrant&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Verification Nombre Message Service&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Verification Nombre Message Service&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Verification Nombre Message Client&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Verification Nombre Message Client&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Initialisation Context Circuit&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Initialisation Context Circuit&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Fin Circuit</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Fin_Circuit.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute trace.technique.circuit.status SUCCESS</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Fin Circuit</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>True Filter</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>True Filter</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Generation Trace Technique CIRCUIT</td>
        </tr>
    </table>
    <h3>filter :Set Attribute trace.technique.circuit.status SUCCESS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Success</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>trace.technique.circuit.status</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute trace.technique.circuit.status SUCCESS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Generation Trace Technique CIRCUIT&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Generation Trace Technique CIRCUIT&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :True Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Flux Sortant Controle Response</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Flux_Sortant_Controle_Response.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Block non XML attachments Reponse</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Flux Sortant Controle Response</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>soap.fault.detail ANO-MSG-VALIDATION-SCHEMA-END</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>xpathContentCheck</td>
            <td>XPATH Localisation soapenv:Envelope</td>
        </tr>
        <tr>
            <td>validationNodes</td>
            <td>All Elements inside SOAP Body (SOAP 1.1 or SOAP 1.2)</td>
        </tr>
    </table>
    <h3>filter :True</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Backend Success ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Backend Success ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-VALIDATION-SCHEMA-END</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {    
 	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-VALIDATION-SCHEMA-END&quot;);
	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-VALIDATION-SCHEMA-END</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Block non XML attachments Reponse</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Request passed attachment filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Request failed attachment filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Block non XML attachments Reponse</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during attachment filtering. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>allowAttachments</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :False</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is SOAP 1.1 ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message passed XPath filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message failed XPath filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is SOAP 1.1 ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during XPath filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Schema Validation reponse</h3>
    <table>           
            <tr>
                <td>removeXSI</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>useWSSchema</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Schema validation passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Schema validation failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Schema Validation reponse</td>
            </tr>           
            <tr>
                <td>inlineMTOMAttachments</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during schema validation. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-HTTP-NON-XML-ATTACHMENT-END</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-HTTP-NON-XML-ATTACHMENT-END</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {          
	msg.put(&quot;soap.fault.detail&quot;, &quot;Seul le contenu XML est autorise&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-NON-XML-ATTACHMENT-END&quot;);
	return true;
   }</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail - ANO-HTTP-SOAP-VERSION-END</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {          
	msg.put(&quot;soap.fault.detail&quot;, &quot;Probleme version SOAP&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-SOAP-VERSION-END&quot;);
	return true;
   }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail - ANO-HTTP-SOAP-VERSION-END</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set soap.fault.detail erreurs xsd</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>&lt;![CDATA[Echec validation schema de la reponse : ${xsd.errors}]]&gt;</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set soap.fault.detail erreurs xsd</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Interops Trace Audit Transaction</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Interops_Trace_Audit_Transaction.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Appeler &#x27;DEI Generation trace audit TRANSACTION&#x27;</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Interops Trace Audit Transaction</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Appeler &#x27;DEI Generation trace audit TRANSACTION&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI Generation trace audit TRANSACTION&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Appel Interops Check Token</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Appel_Interops_Check_Token.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Stocker le message ENTRANT avant appel JV3</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Appel Interops Check Token</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;DEI Point entre INTEROPS-A&#x27;</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;DEI Point entre INTEROPS-A&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEI Point entre INTEROPS-A&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Stocker le message ENTRANT avant appel JV3</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Stockage du message dans l&#x27;attribut réussi </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du stockage du message dans l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Stocker le message ENTRANT avant appel JV3</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>content.body.bak</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors du stockage du message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restaurer le message ENTRANT</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message restauré avec succès</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de restauration du message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restaurer le message ENTRANT</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${content.body.bak}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la restauration du message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute rise.service.vise.to.check for other</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${interops.service.vise.to.check}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>rise.service.vise.to.check</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute rise.service.vise.to.check for other</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Appel Interops Make Token</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Appel_Interops_Make_Token.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extraction header SOAP nameID</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Appel Interops Make Token</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>True</td>
        </tr>
        <tr>
            <td>attributeLocation</td>
            <td>XPATH Extraction header SOAP NAMEID</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.code ANO-MSG-EXTRACT-NAMEID</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Sauvegarde du message entrant avant appel STS</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Sauvegarde du message entrant avant appel STS</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>content.body.bak</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :False</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction header SOAP nameID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>xpathInterpretation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from message via XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes via XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction header SOAP nameID</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>interops.nameid</td>
            </tr>           
            <tr>
                <td>contentType</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes via XPath. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>attributeInContentBody</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :True</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.code ANO-MSG-EXTRACT-NAMEID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {      

	msg.put(&quot;soap.fault.detail&quot;, &quot;Probleme lors de l&#x27;extraction du Header SOAP nameID&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;,  &quot;ANO-MSG-EXTRACT-NAMEID&quot;);

      return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.code ANO-MSG-EXTRACT-NAMEID</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEI Point entree INTEROPS-A (makeToken)&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEI Point entree INTEROPS-A (makeToken)&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique SOAP Fault</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_SOAP_Fault.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Remove HTTP Header User-Agent</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique SOAP Fault</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set soap.fault.detail</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set soap.fault.detail erreurs xsd</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Generation Trace Technique CIRCUIT</td>
        </tr>
        <tr>
            <td>nodeLocation</td>
            <td>XPATH Localisation element detail</td>
        </tr>
    </table>
    <h3>filter :SOAP Fault Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Définition du message réussie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de définition du message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SOAP Fault Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;env:Envelope xmlns:env&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
   &lt;env:Header&gt;&lt;/env:Header&gt;
   &lt;env:Body&gt;
      &lt;env:Fault&gt;
         &lt;faultcode ${soap.fault.qname}&gt;${soap.fault.code}&lt;/faultcode&gt;
         &lt;faultstring&gt;${soap.fault.string}&lt;/faultstring&gt;
         &lt;faultactor&gt;${soap.fault.actor}&lt;/faultactor&gt;
         &lt;detail&gt;
             &lt;exception:faultDetail xmlns:exception&#x3D;&quot;urn:cdc:socle:commun:sps:exception&quot;&gt;
			&lt;code&gt;${soap.fault.detail.code}&lt;/code&gt;
			&lt;detail&gt;${soap.fault.detail}&lt;/detail&gt;
			&lt;version&gt;${app.version}&lt;/version&gt;
			&lt;id&gt;${id}&lt;/id&gt;
             &lt;/exception:faultDetail&gt;
         &lt;/detail&gt;
      &lt;/env:Fault&gt;
   &lt;/env:Body&gt;
&lt;/env:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Echec de définition du message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :set soap.fault.detail.code</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>ANO-MSG-SERVICE-HANDLER</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>soap.fault.detail.code</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>set soap.fault.detail.code</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header Host</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Host</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header Host</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message SOAP Fault JV3</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message SOAP Fault JV3</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;env:Envelope xmlns:env&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
${jv3.content.body}
&lt;/env:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is SOAP Fault From Jeton V3 ?</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var jv3ContentBody &#x3D; msg.get(&quot;jv3.content.body&quot;);

	if (jv3ContentBody &#x3D;&#x3D; null)  {
		return false;
	} else {
		return true;
	}
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is SOAP Fault From Jeton V3 ?</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header User-Agent</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>User-Agent</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header User-Agent</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Soap Fault Customize ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Soap Fault Customize ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Refléter le message [500]</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Echo du message réussi</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du retour d&#x27;écho du message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Refléter le message [500]</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;écho du message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Log Fault Message Payload </h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Données utiles du message consignées avec succès</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de consignation des données utiles du message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Log Fault Message Payload </td>
            </tr>           
            <tr>
                <td>format</td>
                <td>${timestamp} ${id} ${filterName} ${payload}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la consignation des données utiles du message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Generation Trace Activite Circuit&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Generation Trace Activite Circuit&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set soap.fault.detail</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>&lt;![CDATA[${circuit.failure.reason}]]&gt;</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set soap.fault.detail</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add XML Node faultactor</h3>
    <table>           
            <tr>
                <td>nodeName</td>
                <td></td>
            </tr>           
            <tr>
                <td>nodeNamespace</td>
                <td></td>
            </tr>           
            <tr>
                <td>newNodeSource</td>
                <td>newCreation</td>
            </tr>           
            <tr>
                <td>newNodeMessageAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>insertType</td>
                <td>xpath</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>nodeLocationType</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>nodeContent</td>
                <td>&lt;faultactor&gt;${soap.fault.actor}&lt;/faultactor&gt;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>nodeType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully inserted XML node into message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to insert XML node into the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add XML Node faultactor</td>
            </tr>           
            <tr>
                <td>nodeNamespacePrefix</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error inserting XML mode into the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail.code is NULL ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail.code is NULL ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set soap.fault.detail erreurs xsd</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>&lt;![CDATA[Problème validation schema: ${xsd.errors}]]&gt;</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set soap.fault.detail erreurs xsd</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :xsd.errors is null?</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var error&#x3D; msg.get(&quot;xsd.errors&quot;);
  	if (error.size() &gt;0 )  {
		return false;
	} else {
		return true;
	}
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>xsd.errors is null?</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Controles Generiques Message Entrant</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Controles_Generiques_Message_Entrant.svg">
    <table>
        <tr>
            <td>start</td>
            <td>is Type Flux Entrant ?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Controles Generiques Message Entrant</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>content-filtering</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Verification HTTP POST</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>xpathContentCheck</td>
            <td>XPATH Localisation SOAP:Envelope</td>
        </tr>
    </table>
    <h3>filter :soap.fault.detail  ANO-HTTP-NON-XML-ATTACHMENT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-NON-XML-ATTACHMENT&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Seul le contenu XML est autorise&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail  ANO-HTTP-NON-XML-ATTACHMENT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail  ANO-HTTP-NO-HTTP-HEADER</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-NO-HTTP-HEADER&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Le header HTTP Content-Type n&#x27;est pas présent&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail  ANO-HTTP-NO-HTTP-HEADER</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail  ANO-HTTP-VERB</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-ACCESS-NOT-ALLOWED&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Probleme controle HTTP VERB&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail  ANO-HTTP-VERB</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Verification HTTP POST</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verification HTTP POST</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail  ANO-HTTP-INVALID-HTTP-HEADER</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-INVALID-HTTP-HEADER&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;La valeur du header Content-Type n&#x27;est pas supportee&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail  ANO-HTTP-INVALID-HTTP-HEADER</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction Header HTTP Content-Type</h3>
    <table>           
            <tr>
                <td>headerName</td>
                <td>Content-Type</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>4</td>
            </tr>           
            <tr>
                <td>base64Decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>&gt;&gt;&gt; CONTENT-TYPE : ${app.content.type} - ${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attribute HTTP header</td>
            </tr>           
            <tr>
                <td>useQueryParameter</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction Header HTTP Content-Type</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>app.content.type</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from HTTP header. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vérification valiudité MTOM/XOP si Multipart</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vérification valiudité MTOM/XOP si Multipart</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Test présence Multipart ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Test présence Multipart ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Verification SOAP 1.1 uniquement</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Le message a réussi le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Le message a échoué le filtrage XPath</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verification SOAP 1.1 uniquement</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors du filtrage XPath. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Verification Type de contenu</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filtrage des pièces-jointes réussi par la demande</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>La demande a échoué le filtrage des pièces-jointes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verification Type de contenu</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors du filtrage des pièces-jointes. Erreur : ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>allowAttachments</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail  ANO-HTTP-SOAP-VERSION</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-HTTP-SOAP-VERSION&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Message SOAP 1.1 attendu&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail  ANO-HTTP-SOAP-VERSION</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Initialisation Context Circuit</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Initialisation_Context_Circuit.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Initialisation Variables Statiques Circuit</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Initialisation Context Circuit</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Initialisation Variables Contextuelles Circuit CPPService CNAV</td>
        </tr>
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction des parametres de la configuration COMMUNE</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${configuration.commune.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnEmptyAttributeSet</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully looked up Vordel user attributes for the user ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to look up Vordel user attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction des parametres de la configuration COMMUNE</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during when looking up Vordel user attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Initialisation Variables Contextuelles Circuit #3&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Initialisation Variables Contextuelles Circuit #3&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialisation Variables Statiques Circuit</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialisation Variables Statiques Circuit</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extraction Parametres Configuration</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${configuration.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnEmptyAttributeSet</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Recherche réussie des attributs de l&#x27;utilisateur local pour l&#x27;utilisateur ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la recherche des attributs de l&#x27;utilisateur local</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extraction Parametres Configuration</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la recherche des attributs de l&#x27;utilisateur local. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialisation Variables Contextuelles Circuit CPPService CNAV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialisation Variables Contextuelles Circuit CPPService CNAV</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialisation Variables Contextuelles Circuit #1</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialisation Variables Contextuelles Circuit #1</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialisation Variables Contextuelles Circuit #2</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialisation Variables Contextuelles Circuit #2</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Verification Nombre Message Client</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Verification_Nombre_Message_Client.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Verification Nombre Message Client</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Verification Nombre Message Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Verification_Nombre_Message_Service.svg">
    <table>
        <tr>
            <td>start</td>
            <td>is Type Flux Entrant ?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Verification Nombre Message Service</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-SLA-MAXIMUM-MESSAGE</td>
        </tr>
        <tr>
            <td>cacheToUse</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :soap.fault.detail ANO-SLA-MAXIMUM-MESSAGE</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-SLA-MAXIMUM-MESSAGE</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {          
	msg.put(&quot;soap.fault.detail&quot;, &quot;Nombre de messages maximum autorisé atteind&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-SLA-MAXIMUM-MESSAGE&quot;);
	return true;
}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Controle Nombre Maximum de Message autorise</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>timePeriodUnit</td>
                <td>second</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>timePeriodStartDay</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Le filtre Nombre maximum de messages n&#x27;a pas été déclenché</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Le filtre Nombre maximum de messages a été déclenché</td>
            </tr>           
            <tr>
                <td>numberMessages</td>
                <td>${ws.facade.sla.max.message}</td>
            </tr>           
            <tr>
                <td>timePeriodStartHour</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>trackPerKey</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>timePeriod</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Controle Nombre Maximum de Message autorise</td>
            </tr>           
            <tr>
                <td>insertRateLimitingHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filtre déclencheur abandonné : ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>key</td>
                <td>${http.request.clientaddr.getAddress()}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Verification Plage Ouverture Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Verification_Plage_Ouverture_Service.svg">
    <table>
        <tr>
            <td>start</td>
            <td>is Type Flux Entrant ?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Verification Plage Ouverture Service</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-SLA-BUSINESS-HOURS-ACCESS-NOT-ALLOWED</td>
        </tr>
    </table>
    <h3>filter :Controles des plages horaires autorisees</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);

function invoke(msg) {    
	
	//Format de la plage horaire attendu
	var myRegex &#x3D; new java.lang.String(&quot;([0-2][0-9])[H-h]([0-5][0-9])&quot;);
	
	//Récupération du paramétrage contextuel
	// Dimanche : 1 plage par défaut de 22h00 à 23h00
	
	// Dimanche
	var plageHoraireDimancheDebut1Indispo &#x3D; msg.get(&quot;plage.horaire.dimanche.debut.indispo.1&quot;);
	var plageHoraireDimancheFin1Indispo &#x3D; msg.get(&quot;plage.horaire.dimanche.fin.indispo.1&quot;);
	
    var plageHoraireDebut1Indispo;
    var plageHoraireFin1Indispo;

    // On détermine le jour de la semaine et l&#x27;heure courante
    var calNow &#x3D; new GregorianCalendar();

 	// 1. jour de la semaine
	var dayOfWeek &#x3D; calNow.get(Calendar.DAY_OF_WEEK);
	//Trace.debug(&quot;dayOfWeek : &quot; + dayOfWeek);
	
	// 2. on fixe les plages horaires d&#x27;indisponibilité selon l&#x27;algo suivant :
	// plage de fermeture programmée pour CPF : dimanche de 22h00 à 23h00	

	if (dayOfWeek &#x3D;&#x3D; Calendar.SUNDAY) {
		plageHoraireDebut1Indispo &#x3D; plageHoraireDimancheDebut1Indispo; 
		plageHoraireFin1Indispo &#x3D; plageHoraireDimancheFin1Indispo;
	} else {
		return true;
	}

	//3. on vérifie le format des paramètres	

	//3.1 plage debut 1
	var debut1Indispo &#x3D; plageHoraireDebut1Indispo.match(myRegex);

	var debutHeure1Indispo;
	var debutMinute1Indispo;
    
    if (debut1Indispo !&#x3D; null) {
    	//Trace.debug (&quot;OK &quot;+ debut1Indispo[1] + &quot;:&quot; + debut1Indispo[2]);
    	debutHeure1Indispo &#x3D; new java.lang.Integer(debut1Indispo[1]).intValue();
    	debutMinute1Indispo &#x3D; new java.lang.Integer(debut1Indispo[2]).intValue();
    } else {
    	return false;
    }

	//3.2 plage fin 1
    var fin1Indispo &#x3D; plageHoraireFin1Indispo.match(myRegex);

	var finHeure1Indispo;
	var finMinute1Indispo;
    
    if (fin1Indispo !&#x3D; null) {
    	//Trace.debug (&quot;OK &quot;+ fin1Indispo[1] + &quot;:&quot; + fin1Indispo[2]);
    	finHeure1Indispo &#x3D; new java.lang.Integer(fin1Indispo[1]).intValue();
    	finMinute1Indispo &#x3D; new java.lang.Integer(fin1Indispo[2]).intValue();
    } else {
    	return false;
    }
   
    // 4. on vérifie si le flux n&#x27;est pas dans la plage horaire interdite
    
    //4.1 conversion de la plage horaire de début 1 en minute
    var debut1IndispoMIN &#x3D; (debutHeure1Indispo * 60) + debutMinute1Indispo;
    //Trace.debug (&quot;debut1IndispoMIN : &quot; + debut1IndispoMIN);
    
    //4.2 conversion de la plage horaire de fin 1 en minute
    var fin1IndispoMIN &#x3D; (finHeure1Indispo * 60) + finMinute1Indispo;
	//Trace.debug (&quot;fin1IndispoMIN : &quot; + fin1IndispoMIN);

	//4.5 comparaison à la date système
	var heureCouranteMIN &#x3D; (calNow.get(Calendar.HOUR_OF_DAY) * 60) + calNow.get(Calendar.MINUTE);
    //Trace.debug (&quot;heureCouranteMIN : &quot; + heureCouranteMIN);
    
    if ( (heureCouranteMIN &gt; debut1IndispoMIN &amp;&amp; heureCouranteMIN &lt; fin1IndispoMIN) ) {
            return false;
    } else {            
    	return true;   	
    }
    
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Controles des plages horaires autorisees</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-SLA-BUSINESS-HOURS-ACCESS-NOT-ALLOWED</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {          
	msg.put(&quot;soap.fault.detail&quot;, &quot;Acces interdit en dehors des plages horaires autorisees&quot;);
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-SLA-BUSINESS-HOURS-ACCESS-NOT-ALLOWED&quot;);
	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-SLA-BUSINESS-HOURS-ACCESS-NOT-ALLOWED</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Controles des plages horaires autorisees par le PARTENAIRE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);

function invoke(msg)         {       

//configuration plage horaire CNAV
// Par défaut, c&#x27;est à eux de gérer cela, pas à nous !
/**
        var notBeforeMins &#x3D; msg.get(&quot;partenaire.plage.horaire.not.before.mins&quot;)* 60; 
        var notAfterMins &#x3D; msg.get(&quot;partenaire.plage.horaire.not.after.mins&quot;)* 60; 

        var calNow &#x3D; new GregorianCalendar();
        var hour &#x3D; calNow.get(Calendar.HOUR_OF_DAY);
        var minute &#x3D; calNow.get(Calendar.MINUTE);
        var minsNow &#x3D; (hour * 60) + minute;

        if  (minsNow &lt; notBeforeMins) {
            Trace.debug(&quot;Tried to access the web service before&quot; +  msg.get(&quot;partenaire.plage.horaire.not.before.mins&quot;) + &quot;am&quot;);
            return false;

        }

       if  (minsNow &gt; notAfterMins) {
           Trace.debug(&quot;Tried to access the web service after &quot; + msg.get(&quot;partenaire.plage.horaire.not.after.mins&quot;) + &quot;pm&quot;);
           return false;
       }
*/
       return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed javascript filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed javascript filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Controles des plages horaires autorisees par le PARTENAIRE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run javascript filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Generation Trace Technique CIRCUIT</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Generation_Trace_Technique_CIRCUIT.svg">
    <table>
        <tr>
            <td>start</td>
            <td>No-op replacement for LogAccessFilter &#x27;Log Access&#x27;</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Generation Trace Technique CIRCUIT</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Generation Trace Technique Circuit</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-GENERATE-TRACE-TECHNIQUE&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Incident rencontre lors de la generation de la trace technique&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Generation Trace Technique Circuit</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>4</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>trace.technique.circuit</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(java.util);
importClass(java.text.SimpleDateFormat);
importClass(java.lang.System);

function invoke(msg)         {            

		var timeNow &#x3D; System.currentTimeMillis();
		var timeStart &#x3D; msg.get(&quot;start.time.circuit&quot;);
		var totalTimeMs &#x3D; timeNow - timeStart;

		var df&#x3D; new SimpleDateFormat(&quot;dd-MM-yyyy HH:mm:ss&quot;, Locale.FRANCE);
		var dateEndDisplay &#x3D; df.format(timeNow);

		var msgTrace &#x3D;new java.lang.String(
				msg.get(&quot;app.domaine&quot;) + &quot;#&quot; +
				msg.get(&quot;app.projet&quot;) + &quot;#&quot; +
				msg.get(&quot;app.contexte&quot;) + &quot;#&quot; +
				msg.get(&quot;app.version&quot;) + &quot;#&quot; +				
				&quot;TECHNIQUE#&quot; +
				&quot;STAT_DUREE_CIRCUIT#&quot; +				
				dateEndDisplay + &quot;#&quot; +
				msg.get(&quot;trace.technique.circuit.transactionID&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.circuit.correlationID&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.circuit.appelant&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.circuit.appele&quot;) + &quot;#&quot; +
				msg.get(&quot;soap.request.method&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.circuit.status&quot;) + &quot;#&quot; + 
				totalTimeMs + &quot; ms#&quot; +
				msg.get(&quot;soap.fault.detail.code&quot;) + &quot;#&quot; +
				msg.get(&quot;soap.fault.detail&quot;));	

		msg.put(&quot;trace.technique.circuit&quot;, msgTrace);

		return true;         

 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>${trace.technique.circuit}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Generation Trace Technique Circuit</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :No-op replacement for LogAccessFilter &#x27;Log Access&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>No-op replacement for LogAccessFilter &#x27;Log Access&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Generation Trace Technique BACKEND</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Generation_Trace_Technique_BACKEND.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Generation Trace Technique BACKEND</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Generation Trace Technique BACKEND</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</td>
        </tr>
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-GENERATE-TRACE-TECHNIQUE&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Incident rencontre lors de la generation de la trace technique&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Generation Trace Technique BACKEND</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(java.util);
importClass(java.text.SimpleDateFormat);
importClass(java.lang.System);


function invoke(msg)         {

			var timeNow &#x3D; System.currentTimeMillis();
			var timeStart &#x3D; msg.get(&quot;ws.backend.start.time&quot;);
			var totalTimeMs &#x3D; timeNow - timeStart;

			var df&#x3D; new SimpleDateFormat(&quot;dd-MM-yyyy HH:mm:ss&quot;, Locale.FRANCE);
			var dateEndDisplay &#x3D; df.format(timeNow);
			
			var msgTrace &#x3D;new java.lang.String(
				msg.get(&quot;app.domaine&quot;) + &quot;#&quot; +
				msg.get(&quot;app.projet&quot;) + &quot;#&quot; +
				msg.get(&quot;app.contexte&quot;) + &quot;#&quot; +			
				msg.get(&quot;app.version&quot;) + &quot;#&quot; +
				&quot;TECHNIQUE#&quot; +
				&quot;STAT_APPEL_BACK_END#&quot; +
				dateEndDisplay + &quot;#&quot; +
				msg.get(&quot;trace.technique.circuit.transactionID&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.circuit.correlationID&quot;) + &quot;#&quot; + 
				msg.get(&quot;trace.technique.backend.appelant&quot;) + &quot;#&quot; +
				msg.get(&quot;trace.technique.backend.appele&quot;) + &quot;#&quot; + 
				msg.get(&quot;soap.request.method&quot;) + &quot;#&quot; +
				msg.get(&quot;trace.technique.backend.status&quot;) + &quot;#&quot; +
				totalTimeMs + &quot; ms#&quot; +
				msg.get(&quot;soap.fault.detail&quot;)+ &quot;#&quot; +
				msg.get(&quot;soap.fault.detail.code&quot;) );		

	   			msg.put(&quot;trace.technique.backend&quot;, msgTrace);

			return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>${trace.technique.backend}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Generation Trace Technique BACKEND</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Politique Generation Alerte Securite</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Politique_Generation_Alerte_Securite.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Génération Alerte Securite</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Politique Generation Alerte Securite</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Vrai filtre</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</td>
        </tr>
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot;ANO-MSG-GENERATE-TRACE-TECHNIQUE&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Incident rencontre lors de la generation de la trace technique&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-GENERATE-TRACE-TECHNIQUE</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vrai filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Réussite du filtre vrai</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vrai filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre vrai. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Faux filtre</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Faux filtre</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur de filtre faux. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Génération Alerte Securite</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(java.util);
importClass(java.text.SimpleDateFormat);
importClass(java.lang.System);


function invoke(msg)         {

		var timeNow &#x3D; System.currentTimeMillis();

		var df&#x3D; new SimpleDateFormat(&quot;dd-MM-yyyy HH:mm:ss&quot;, Locale.FRANCE);
		var dateEndDisplay &#x3D; df.format(timeNow);
			
		var msgAlerte &#x3D;new java.lang.String(
				msg.get(&quot;app.domaine&quot;) + &quot;#&quot; +
				msg.get(&quot;app.projet&quot;) + &quot;#&quot; +
				msg.get(&quot;app.contexte&quot;) + &quot;#&quot; +	
				msg.get(&quot;app.version&quot;) + &quot;#&quot; +				
				&quot;SECURITE#&quot; +
				msg.get(&quot;alert.event&quot;) + &quot;#&quot; +
				dateEndDisplay + &quot;#&quot; +
				msg.get(&quot;id&quot;) + &quot;#&quot; +
				msg.get(&quot;alert.reason&quot;) );

	   			msg.put(&quot;alerte.securite&quot;, msgAlerte);

			return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>${alerte.securite}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Génération Alerte Securite</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEI LIB - Deverminage</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEI_LIB_-_Deverminage.svg">
    <table>
        <tr>
            <td>start</td>
            <td>is Type Flux Entrant ?</td>
        </tr>
        <tr>
            <td>name</td>
            <td>DEI LIB - Deverminage</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>True Filter</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set Attribute alert.event</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique Generation Alerte Securite</td>
        </tr>
        <tr>
            <td>threatRegExprs</td>
            <td>DOCTYPE DTD Reference</td>
        </tr>
        <tr>
            <td>scanMimeTypes</td>
            <td>application/*+xml</td>
        </tr>
    </table>
    <h3>filter :is Type Flux Entrant ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Vérification réussie du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la vérification du contenu de l&#x27;attribut de message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is Type Flux Entrant ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de la vérification du contenu des attributs de message. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :soap.fault.detail ANO-MSG-THREATENING-CONTENT-DETECTED</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>soap.fault.detail</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {
	msg.put(&quot;soap.fault.detail.code&quot;, &quot; ANO-MSG-THREATENING-CONTENT-DETECTED&quot;);
	msg.put(&quot;soap.fault.detail&quot;, &quot;Code malicieux détecté !&quot;);

	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filtre de script réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec du filtre de script</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>soap.fault.detail ANO-MSG-THREATENING-CONTENT-DETECTED</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la tentative d&#x27;exécution du filtre de script. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute alert.reason</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Valeur de l&#x27;attribut définie</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de la définition de la valeur de l&#x27;attribut</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Détection d&#x27;un contenu malicieux ${trace.technique.circuit.appele} - ${threatening.content.expression}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.reason</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute alert.reason</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Erreur lors de la définition de la valeur de l&#x27;attribut. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute alert.event</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>THREATENING_CONTENT_DETECTED</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.event</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute alert.event</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Appeler &#x27;DEI LIB - Politique Generation Alerte Securite&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Appel du raccourci de politique réussi</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Echec de l&#x27;appel du raccourci de politique</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Appeler &#x27;DEI LIB - Politique Generation Alerte Securite&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Une erreur s&#x27;est produite lors de l&#x27;appel du circuit de raccourci de politique. Erreur : ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Threatening Content</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>includeHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Message is clean and contains no know threats</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message contains known attacks</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Threatening Content</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while scanning the message for threatening content. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>includeQueryString</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :True Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Access Token Info</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Access_Token_Info.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Access Token Information</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Access Token Info</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Access Token Information</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessTokenLocationSelector</td>
                <td>${http.client.getCgiArgument(&#x27;access_token&#x27;)}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access Token Information</td>
            </tr>           
            <tr>
                <td>accessTokenLocationQueryString</td>
                <td>access_token</td>
            </tr>           
            <tr>
                <td>accessTokenLocation</td>
                <td>SELECTOR</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Access Token Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Access_Token_Service.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Decide what grant type to use</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Access Token Service</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>defaultCircuit</td>
            <td>Return HTTP Error 401: Unauthorized</td>
        </tr>
    </table>
    <h3>filter :Decide what grant type to use</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decide what grant type to use</td>
            </tr>           
            <tr>
                <td>defaultOption</td>
                <td>RETURN_DEFAULT_CIRCUIT</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>${content.body.getParameters().get(&quot;grant_type&quot;)}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Client Credentials</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Client_Credentials.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Access Token using client credentials</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Client Credentials</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Access Token using client credentials</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NoRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access Token using client credentials</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : JWT</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/JWT.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Access token using JWT</td>
        </tr>
        <tr>
            <td>name</td>
            <td>JWT</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Access token using JWT</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>clockSkewInSeconds</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NoRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access token using JWT</td>
            </tr>           
            <tr>
                <td>requiredAudience</td>
                <td>http://apiserver/api/oauth/token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Verify SAML Signature</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Verify_SAML_Signature.svg">
    <table>
        <tr>
            <td>start</td>
            <td>XML Signature Verification</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Verify SAML Signature</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>content-filtering</td>
        </tr>
        <tr>
            <td>signedContent</td>
            <td>The First SAML 2.0 assertion</td>
        </tr>
        <tr>
            <td>signedContentElementSpecifier</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>verifyingCert</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>keyLocation</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sigLocation</td>
            <td>First Signature in First SAML Assertion (SAML 2.0)</td>
        </tr>
    </table>
    <h3>filter :XML Signature Verification</h3>
    <table>           
            <tr>
                <td>defaultDerivedKeyLabel</td>
                <td>WS-SecureConversationWS-SecureConversation</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${oauth.client.details.getX509Cert()}</td>
            </tr>           
            <tr>
                <td>extractNodesFromMessageAttribute</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>sigPosition</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Integrity: Signature verification failed</td>
            </tr>           
            <tr>
                <td>signatureConfirmationType</td>
                <td>none</td>
            </tr>           
            <tr>
                <td>algorithmSuite</td>
                <td></td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>${oauth.saml.doc}</td>
            </tr>           
            <tr>
                <td>allAttachmentsSigned</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>removeWsSecurity</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>verifyForAuthentication</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>extractNodeListAttributeName</td>
                <td>${node.list}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>actor</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Integrity: Signature verification passed</td>
            </tr>           
            <tr>
                <td>failIfNoSignatures</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML Signature Verification</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Integrity: Signature verification error. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : SAML</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/SAML.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Access token using SAML Assertion</td>
        </tr>
        <tr>
            <td>name</td>
            <td>SAML</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>scopeCircuitPK</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Verify SAML Signature</td>
        </tr>
    </table>
    <h3>filter :Access token using SAML Assertion</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>authNWith</td>
                <td>REPOSITORY</td>
            </tr>           
            <tr>
                <td>driftTime</td>
                <td>60</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NoRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access token using SAML Assertion</td>
            </tr>           
            <tr>
                <td>requiredAudience</td>
                <td>https://127.0.0.1:8089/api/oauth/token</td>
            </tr>           
            <tr>
                <td>subjectAttr</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Resource Owner Password Credentials</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Resource_Owner_Password_Credentials.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Resource Owner Password Credentials</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Resource Owner Password Credentials</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Resource Owner Password Credentials</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>authNWith</td>
                <td>REPOSITORY</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Resource Owner Password Credentials</td>
            </tr>           
            <tr>
                <td>subjectAttr</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Refresh</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Refresh.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Refresh Access token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Refresh</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Refresh Access token</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Refresh Access token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Access Code</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Access_Code.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Exchange AuthZ Code for Access Token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Access Code</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>jwtSigner</td>
            <td></td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Create an Open ID Connect ID Token</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>authzCodeCache</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Create an Open ID Connect ID Token</h3>
    <table>           
            <tr>
                <td>subject</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>issuer</td>
                <td>${http.request.url}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>jwtExpiresIn</td>
                <td>60</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>signatureAlg</td>
                <td>RS256</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create an Open ID Connect ID Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Exchange AuthZ Code for Access Token</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>600</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Exchange AuthZ Code for Access Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Revoke Token</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Revoke_Token.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Revoke OAuth token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Revoke Token</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Revoke OAuth token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Revoke OAuth token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : logout</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/logout.svg">
    <table>
        <tr>
            <td>start</td>
            <td>End Session</td>
        </tr>
        <tr>
            <td>name</td>
            <td>logout</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>HTTP Redirect</td>
        </tr>
    </table>
    <h3>filter :End Session</h3>
    <table>           
            <tr>
                <td>cookie</td>
                <td>VIDUSR</td>
            </tr>           
            <tr>
                <td>removeCookie</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>/</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td></td>
            </tr>           
            <tr>
                <td>name</td>
                <td>End Session</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :HTTP Redirect</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>307</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>HTTP Redirect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>Rdirect</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>/home</td>
            </tr>           
    </table>

    <h2>Policy : Client Registry AuthN-AuthZ</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Client_Registry_AuthN-AuthZ.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Client Registry Login Authn</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Client Registry AuthN-AuthZ</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set User&#x27;s Role</td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Set User&#x27;s Role</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user.role}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.role</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set User&#x27;s Role</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Client Registry Login Authn</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Authenticated via username-password attributes sucessfully.</td>
            </tr>           
            <tr>
                <td>password</td>
                <td>${authentication.subject.password}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to authenticate using username-password attributes.</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>credentialFormat</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Client Registry Login Authn</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during authentication using username-password attributes. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>username</td>
                <td>${authentication.subject.id}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve from user store</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnEmptyAttributeSet</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully looked up local user attributes for the user ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to look up local user attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve from user store</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during when looking up of local user attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set User&#x27;s Email</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user.email}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>user.email</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set User&#x27;s Email</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Resource Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Resource_Service.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Validate Access Token in Message</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Resource Service</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Congrats Message</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Reflect</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Congrats Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Congrats Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;html&gt;Congrats! You&#x27;ve hit an OAuth protected resource&lt;/html&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Validate Access Token in Message</h3>
    <table>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>validateScopesWith</td>
                <td>List</td>
            </tr>           
            <tr>
                <td>authorizationHeaderPrefix</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessTokenLocationSelector</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate Access Token in Message</td>
            </tr>           
            <tr>
                <td>accessTokenLocationQueryString</td>
                <td></td>
            </tr>           
            <tr>
                <td>accessTokenLocation</td>
                <td>HEADER</td>
            </tr>           
            <tr>
                <td>scopesRequired</td>
                <td>${scopes.required}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>removeCredentials</td>
                <td>true</td>
            </tr>           
    </table>

    <h2>Policy : Server user info</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Server_user_info.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Validate Access Token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Server user info</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Reflect Message</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Validate Access Token</h3>
    <table>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>validateScopesWith</td>
                <td>List</td>
            </tr>           
            <tr>
                <td>authorizationHeaderPrefix</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessTokenLocationSelector</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate Access Token</td>
            </tr>           
            <tr>
                <td>accessTokenLocationQueryString</td>
                <td></td>
            </tr>           
            <tr>
                <td>accessTokenLocation</td>
                <td>HEADER</td>
            </tr>           
            <tr>
                <td>scopesRequired</td>
                <td>${scopes.required}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>removeCredentials</td>
                <td>true</td>
            </tr>           
    </table>
    <h3>filter :Remove Cookie Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Cookie</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove Cookie Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Reflect Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve from user store</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnEmptyAttributeSet</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully looked up local user attributes for the user ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to look up local user attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve from user store</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during when looking up of local user attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
 &quot;kind&quot;: &quot;APIGatewayOpenIdConnect&quot;,
 &quot;gender&quot;: &quot;${user.gender}&quot;,
 &quot;sub&quot;: &quot;${authentication.subject.id}&quot;,
 &quot;name&quot;: &quot;${user.given_name} ${user.family_name}&quot;,
 &quot;given_name&quot;: &quot;${user.given_name}&quot;,
 &quot;family_name&quot;: &quot;${user.family_name}&quot;,
 &quot;picture&quot;: &quot;${user.picture}&quot;,
 &quot;email&quot;: &quot;${user.email}&quot;,
 &quot;email_verified&quot;: &quot;${user.email_verified}&quot;,
 &quot;locale&quot;: &quot;${user.locale}&quot;,
 &quot;hd&quot;: &quot;${user.hd}&quot;
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Login</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Login.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Login via HTML Form</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Login</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>authentication</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Remove HTTP Header</td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Login Failed</td>
        </tr>
        <tr>
            <td>cacheToUse</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Remove HTTP Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Cookie</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Redirect to OAuth Service</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Redirect to OAuth Service</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>redirect</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.client.getCgiArgument(&quot;continue&quot;)}</td>
            </tr>           
    </table>
    <h3>filter :Login Failed</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Login Failed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>redirect</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.client.getCgiArgument(&quot;continue&quot;)}#error&#x3D;loginfailed</td>
            </tr>           
    </table>
    <h3>filter :Login via HTML Form</h3>
    <table>           
            <tr>
                <td>timePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>createSession</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>password</td>
                <td>Passwd</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>invalidAttempts</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>credentialFormat</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>userTimePeriod</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>lockUser</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>lock</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>httpOnly</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>lockKey</td>
                <td>${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>cookie</td>
                <td>RESOURCEOWNERCOOKIE</td>
            </tr>           
            <tr>
                <td>userTimePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>lockTimePeriod</td>
                <td>30</td>
            </tr>           
            <tr>
                <td>userInvalidAttempts</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>lockTimePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>/api</td>
            </tr>           
            <tr>
                <td>sessionExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>onlySendOverSSL</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td></td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Login via HTML Form</td>
            </tr>           
            <tr>
                <td>timePeriod</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>username</td>
                <td>UserName</td>
            </tr>           
    </table>

    <h2>Policy : Authorization Request</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Authorization_Request.svg">
    <table>
        <tr>
            <td>start</td>
            <td>OAuthAuthZ</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Authorization Request</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Create an Open ID Connect ID Token</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Remove Cookie Header</td>
        </tr>
        <tr>
            <td>jwtSigner</td>
            <td></td>
        </tr>
        <tr>
            <td>scopeCircuitPK</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>authzCodeCache</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Remove Cookie Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Cookie</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove Cookie Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Create an Open ID Connect ID Token</h3>
    <table>           
            <tr>
                <td>subject</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>issuer</td>
                <td>${http.request.url}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>jwtExpiresIn</td>
                <td>60</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>signatureAlg</td>
                <td>RS256</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create an Open ID Connect ID Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :OAuthAuthZ</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>7</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>resourceOwnerCookieName</td>
                <td>RESOURCEOWNERCOOKIE</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>authzCodeLength</td>
                <td>30</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessCodeTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/showAccessCode.html</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>3600</td>
            </tr>           
            <tr>
                <td>loginTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/login.html</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>authNWith</td>
                <td>INTERNAL_AUTHN_FLOW</td>
            </tr>           
            <tr>
                <td>grantAccessTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/requestAccess.html</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>authzCodeExpiresInSecs</td>
                <td>20</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>OAuthAuthZ</td>
            </tr>           
            <tr>
                <td>subjectAttr</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>

    <h2>Policy : Get User Details</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Get_User_Details.svg">
    <table>
        <tr>
            <td>start</td>
            <td>HTTP Header</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Get User Details</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Reflect Message</td>
        </tr>
    </table>
    <h3>filter :Retrieve from user store</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnEmptyAttributeSet</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully looked up local user attributes for the user ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to look up local user attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve from user store</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during when looking up of local user attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :HTTP Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully extracted the HTTP header token</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract the HTTP header token</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>HTTP Header</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>tokenType</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to extract the HTTP headers. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
 &quot;kind&quot;: &quot;APIGatewayOpenIdConnect&quot;,
 &quot;gender&quot;: &quot;${user.gender}&quot;,
 &quot;sub&quot;: &quot;${authentication.subject.id}&quot;,
 &quot;name&quot;: &quot;${user.given_name} ${user.family_name}&quot;,
 &quot;given_name&quot;: &quot;${user.given_name}&quot;,
 &quot;family_name&quot;: &quot;${user.family_name}&quot;,
 &quot;picture&quot;: &quot;${user.picture}&quot;,
 &quot;email&quot;: &quot;${user.email}&quot;,
 &quot;email_verified&quot;: &quot;${user.email_verified}&quot;,
 &quot;locale&quot;: &quot;${user.locale}&quot;,
 &quot;hd&quot;: &quot;${user.hd}&quot;
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Reflect Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>200</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Client Application Logo</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Client_Application_Logo.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Extract Path Parameters</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Client Application Logo</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>caCerts</td>
            <td></td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Connect to URL</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://${env.OAUTH.SERVER}:${env.PORT.OAUTH2.SERVICES}/api/portal/v1.2/applications/${client.app.id}/image</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Extract Path Parameters</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>uriTemplate</td>
                <td>/api/oauth/application/image/{clientID}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Path Parameters</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : API Proxy Unpublished</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/API_Proxy_Unpublished.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>API Proxy Unpublished</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API proxy is unpublished</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Frontend API ${alert.apiproxy.name} with ID ${alert.apiproxy.id} has been unpublished.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : API Proxy Undeprecated</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/API_Proxy_Undeprecated.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>API Proxy Undeprecated</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API Proxy is undeprecated</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Frontend API ${alert.apiproxy.name} with ID ${alert.apiproxy.id} has been undeprecated.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : API Proxy Retired</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/API_Proxy_Retired.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>API Proxy Retired</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API Proxy is retired</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Frontend API ${alert.apiproxy.name} with ID ${alert.apiproxy.id} has been retired.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : API Proxy Deprecated</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/API_Proxy_Deprecated.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>API Proxy Deprecated</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API Proxy is deprecated</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Frontend API ${alert.apiproxy.name} with ID ${alert.apiproxy.id} has been deprecated.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : API Proxy Published</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/API_Proxy_Published.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>API Proxy Published</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API developer publishes an API Proxy</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Frontend API ${alert.apiproxy.name} with ID ${alert.apiproxy.id} has been published.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Send Alert</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Send_Alert.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Send API Manager Alert</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A common policy for transmitting API Management alerts</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>REST Call Success</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>REST Call Success</td>
        </tr>
    </table>
    <h3>filter :REST Call Success</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>REST Call Success</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Send API Manager Alert</h3>
    <table>           
            <tr>
                <td>alertMessage</td>
                <td>API Manager: ${alert.message}</td>
            </tr>           
            <tr>
                <td>alertType</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Alert generation success</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Alert generation failed</td>
            </tr>           
            <tr>
                <td>numberMessages</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Send API Manager Alert</td>
            </tr>           
            <tr>
                <td>timePeriodMillis</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Alert generation aborted: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>trackPerClient</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Enable Organization</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_Organization.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable Organization</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Organization is enabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been enabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Create Organization</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Create_Organization.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Create Organization</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Organization is created</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been created.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable Organization</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_Organization.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable Organization</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Organization is disabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been disabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Delete Organization</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Delete_Organization.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Delete Organization</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Organization is deleted</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been deleted.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Enable Organization API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_Organization_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Organization</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable Organization API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application’s access to an API is enabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>ID</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.organization.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Access to API ${alert.apiaccess.apiId} for organization ${alert.organization.name} has been enabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Remove Organization API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Remove_Organization_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Organization</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Remove Organization API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Organization has been revoked access to an API</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>ID</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.organization.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been revoked access to API ${alert.apiaccess.apiId}.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable Organization API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_Organization_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Organization</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable Organization API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application’s access to an API is disabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Attribute Filter</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Access to API ${alert.apiaccess.apiId} for organization ${alert.organization.name} has been disabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>ID</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.organization.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Add Organization API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Add_Organization_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Organization</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Add Organization API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Organization has been granted access to an API</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Organization ${alert.organization.name} has been granted access to API ${alert.apiaccess.apiId}.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>ID</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.organization.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Enable Application</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_Application.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable Application</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application is enabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application ${alert.application.name} has been enabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable Application</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_Application.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable Application</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application is disabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application ${alert.application.name} has been disabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Delete Application</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Delete_Application.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Delete Application</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application is deleted</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application ${alert.application.name} has been deleted.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Approved</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Approved.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Approved</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A new Application registration is approved (including auto-approve)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application ${alert.application.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable Application API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_Application_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Application</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable Application API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application’s access to an API is disabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.application.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Access to API ${alert.apiaccess.apiId} for application ${alert.application.name} has been disabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Remove Application API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Remove_Application_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Application</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Remove Application API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Application has been revoked access to an API</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.application.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application ${alert.application.name} has been revoked access to API ${alert.apiaccess.apiId}.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Approve Application Registration</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Approve_Application_Registration.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Approve Application Registration</td>
        </tr>
        <tr>
            <td>description</td>
            <td>When a new Application has been registered but approval is needed (only if auto-approved disabled)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Registration of application ${alert.application.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Enable Application API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_Application_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Application</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable Application API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application’s access to an API is enabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.application.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Access to API ${alert.apiaccess.apiId} for application ${alert.application.name} has been enabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Approve Application API Access Request</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Approve_Application_API_Access_Request.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Application</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Approve Application API Access Request</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An application access to an API has been requested but approval is needed (only if auto-approved disabled)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.application.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Request to access API ${alert.apiaccess.apiId} from application ${alert.application.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Approve Application API Access</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Approve_Application_API_Access.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Application</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Approve Application API Access</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An application access to an API has been approved (including auto-approve)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Access to API ${alert.apiaccess.apiId} from application ${alert.application.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${alert.application.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>alert.application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Enable Application Developer</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_Application_Developer.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable Application Developer</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application Developer is enabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application developer ${alert.appdev.name} has been enabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Reset Application Developer Password</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Reset_Application_Developer_Password.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Reset Application Developer Password</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An application Developer password is reset (not changed)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Password has been reset for application developer ${alert.appdev.name}.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Developer Approved</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Developer_Approved.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Developer Approved</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A new Application Developer user registration is approved (including auto-approve)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application developer ${alert.appdev.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Approve Application Developer Registration</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Approve_Application_Developer_Registration.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Approve Application Developer Registration</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A new Application Developer user has been registered but approval is needed (only if auto-approved disabled)</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Registration of application developer ${alert.appdev.name} has been approved.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable Application Developer</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_Application_Developer.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable Application Developer</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application Developer is disabled</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application developer ${alert.appdev.name} has been disabled.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Delete Application Developer</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Delete_Application_Developer.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Delete Application Developer</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An Application Developer user is deleted</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application developer ${alert.appdev.name} has been deleted.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Default Quota Changed</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Default_Quota_Changed.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Default Quota Changed</td>
        </tr>
        <tr>
            <td>description</td>
            <td>Application Default Quota is changed</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Application Default Quota is changed.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : System Quota Changed</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/System_Quota_Changed.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>System Quota Changed</td>
        </tr>
        <tr>
            <td>description</td>
            <td>System Quota is changed</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>System Quota is changed.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Quota Exceeded</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Quota_Exceeded.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Quota Exceeded</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An application quota is exceeded</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Error: usage of API ${api.name}, operation ${api.method.name} by application ${authentication.subject.id} has exceeded APPLICATION Quota.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Quota Warning Exceeded</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Quota_Warning_Exceeded.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Quota Warning Exceeded</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An application quota warning threshold is exceeded</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Warning: usage of API ${api.name}, operation ${api.method.name} by application ${authentication.subject.id} has reached ${api.application.quota.warn.percent}% of APPLICATION Quota</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Application Specific Quota Changed</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Application_Specific_Quota_Changed.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Application Specific Quota Changed</td>
        </tr>
        <tr>
            <td>description</td>
            <td>The application quota is changed</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Quota override ${alert.quota.name} for application with ID ${alert.application.id} changed.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : System Quota Exceeded</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/System_Quota_Exceeded.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>System Quota Exceeded</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A system quota is exceeded</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Error: usage of API ${api.name}, operation ${api.method.name} by application ${authentication.subject.id} has exceeded SYSTEM Quota.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : System Quota Warning Exceeded</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/System_Quota_Warning_Exceeded.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>System Quota Warning Exceeded</td>
        </tr>
        <tr>
            <td>description</td>
            <td>A system quota warning threshold is exceeded</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Warning: usage of API ${api.name}, operation ${api.method.name} by application ${authentication.subject.id} has reached ${api.system.quota.warn.percent}% of SYSTEM Quota.</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Enable API</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Enable_API.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Enable API</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API is enabled in the API Catalog</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>The following API(s) have been enabled: [${alert.apiIdList}]</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Disable API</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Disable_API.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Disable API</td>
        </tr>
        <tr>
            <td>description</td>
            <td>An API is disabled in the API Catalog</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>Send Alert</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;Send Alert&#x27;</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;Send Alert&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Send Alert&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>The following API(s) have been disabled: [${alert.apiIdList}]</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>alert.message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Account Creation Failure</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Account_Creation_Failure.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Trace Error</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Account Creation Failure</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
    </table>
    <h3>filter :Trace Error</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>Error creating account for external identity ${authN.loginname}: ${authN.failureCause.getMessage()}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Error</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Account Creation Success</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Account_Creation_Success.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Read Account</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Account Creation Success</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Trace Account</td>
        </tr>
    </table>
    <h3>filter :Read Account</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>${authN.accountId}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Account</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.appdeveloper</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Account</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>Account ${authN.accountId} (${apimgmt.appdeveloper.name}) was created for login name ${authN.loginname}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Account</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Retrieve Active Directory Account Information</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Retrieve_Active_Directory_Account_Information.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Retrieve User Email</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Retrieve Active Directory Account Information</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set extidentity.email</td>
        </tr>
        <tr>
            <td>ldapDir</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Set extidentity.role</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.role</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.role</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>Name</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>Community</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>extidentity.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.loginName</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authN.loginname}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.loginName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.loginName</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.enabled</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.enabled</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.enabled</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.phone</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].telephoneNumber[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.phone</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.phone</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.email</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].mail[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.email</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.email</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].cn[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.name</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve User Email</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${authN.loginname}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from LDAP</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from LDAP</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve User Email</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from LDAP. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.description</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].description[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.description</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.description</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Authenticate Active Directory Account</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Authenticate_Active_Directory_Account.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Attribute Authentication</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Authenticate Active Directory Account</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>authentication</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Attribute Authentication</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Authenticated via username-password attributes sucessfully.</td>
            </tr>           
            <tr>
                <td>password</td>
                <td>${authN.password}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to authenticate using username-password attributes.</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>credentialFormat</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Attribute Authentication</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during authentication using username-password attributes. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>username</td>
                <td>${authN.loginname}</td>
            </tr>           
    </table>

    <h2>Policy : Authenticate LDAP Account</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Authenticate_LDAP_Account.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Attribute Authentication</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Authenticate LDAP Account</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>authentication</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Attribute Authentication</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Authenticated via username-password attributes sucessfully.</td>
            </tr>           
            <tr>
                <td>password</td>
                <td>${authN.password}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to authenticate using username-password attributes.</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>credentialFormat</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Attribute Authentication</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error during authentication using username-password attributes. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>username</td>
                <td>${authN.loginname}</td>
            </tr>           
    </table>

    <h2>Policy : Retrieve LDAP Account Information</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Retrieve_LDAP_Account_Information.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Retrieve User Email</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Retrieve LDAP Account Information</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set extidentity.email</td>
        </tr>
        <tr>
            <td>ldapDir</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Set extidentity.enabled</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.enabled</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.enabled</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.organization</h3>
    <table>           
            <tr>
                <td>selects</td>
                <td>Name</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>idSelector</td>
                <td>Community</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.organization</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>extidentity.organization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.phone</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].telephoneNumber[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.phone</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.phone</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].cn[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.name</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.role</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.role</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.role</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.email</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].mail[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.email</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.email</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve User Email</h3>
    <table>           
            <tr>
                <td>userIdentityAttribName</td>
                <td>${authN.loginname}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from LDAP</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from LDAP</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>messageAttrPrefix</td>
                <td>user</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve User Email</td>
            </tr>           
            <tr>
                <td>enablyLegacyAttrNaming</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from LDAP. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.loginName</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authN.loginname}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.loginName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.loginName</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set extidentity.description</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${user[0].description[0]}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>extidentity.description</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set extidentity.description</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : PingFederate</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/PingFederate.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Create REST Request</td>
        </tr>
        <tr>
            <td>name</td>
            <td>PingFederate</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>fault</td>
            <td>API Manager Handler</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Successfully retrieved token information</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>caCerts</td>
            <td></td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Extract error information</td>
        </tr>
        <tr>
            <td>userStylesheet</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Create REST Request</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create REST Request</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>useAttributeLookupList</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>httpMethod</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call Token Service</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://changeme/as/token.oauth2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call Token Service</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Token Service returned OK</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Token Service returned OK</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set oauth.token.client_id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${ping.oauth.token.client_id}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>oauth.token.client_id</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set oauth.token.client_id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract token information</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract token information</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set oauth.token.valid</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${ping.oauth.token.expires_in &gt; 0}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>oauth.token.valid</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set oauth.token.valid</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Successfully retrieved token information</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Successfully retrieved token information</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract error information</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract error information</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set oauth.token.scopes</h3>
    <table>           
            <tr>
                <td>regexMatchString</td>
                <td>\s+</td>
            </tr>           
            <tr>
                <td>destAttributeOverride</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>replacementString</td>
                <td>,</td>
            </tr>           
            <tr>
                <td>straightMatchString</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>matchBehaviour</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>destAttribute</td>
                <td>oauth.token.scopes</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set oauth.token.scopes</td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>ping.oauth.token.scope</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>matchMode</td>
                <td>REGEX_REPLACE</td>
            </tr>           
    </table>
    <h3>filter :Cannot retrieve token information</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Cannot retrieve token information</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :API Manager Handler</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>showAttributes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>showPath</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>showDetailedReason</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>showStack</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>styleResponse</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>faultString</td>
                <td>Security failure</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>API Manager Handler</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : Salesforce API URL Rewriting</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Salesforce_API_URL_Rewriting.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Copy message contents to temp variable</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Salesforce API URL Rewriting</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Trace message contents after URL rewriting</td>
        </tr>
    </table>
    <h3>filter :Copy message contents to temp variable</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>message.with.urls.to.be.rewritten</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Copy message contents to temp variable</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace message contents before URL rewriting</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>Content-type: ${content.body.contentType}
Content body: ${message.with.urls.to.be.rewritten}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace message contents before URL rewriting</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Trace message contents after URL rewriting</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td>Content-type: ${content.body.contentType}
Content body: ${message.with.urls.to.be.rewritten}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace message contents after URL rewriting</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Update message contents post-transformation</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Update message contents post-transformation</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${message.with.urls.to.be.rewritten}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>${content.body.contentType}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Re-write URLs in message contents</h3>
    <table>           
            <tr>
                <td>regexMatchString</td>
                <td></td>
            </tr>           
            <tr>
                <td>destAttributeOverride</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>replacementString</td>
                <td>${api.path}</td>
            </tr>           
            <tr>
                <td>straightMatchString</td>
                <td>/services/data/v33.0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>matchBehaviour</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>destAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Re-write URLs in message contents</td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>message.with.urls.to.be.rewritten</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>matchMode</td>
                <td>STRAIGHT_REPLACE</td>
            </tr>           
    </table>

    <h2>Policy : GetFeedbackService</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/GetFeedbackService.svg">
    <table>
        <tr>
            <td>name</td>
            <td>GetFeedbackService</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set app.version</td>
        </tr>
        <tr>
            <td>fault</td>
            <td>Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>reqChainIntermediary</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>routingCircuit</td>
            <td>DEI LIB - Politique Connexion</td>
        </tr>
        <tr>
            <td>webService</td>
            <td>GetFeedbackService</td>
        </tr>
        <tr>
            <td>validationCircuit</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>beforeWSDLResponse</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>rspChainIntermediary</td>
            <td>DEI LIB - Flux Sortant Controle Response</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique SOAP Fault</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Service Handler for &#x27;GetFeedbackService&#x27;</td>
        </tr>
    </table>
    <h3>filter :Service Handler for &#x27;GetFeedbackService&#x27;</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>specifiedURL</td>
                <td>http://localhost:8080/GetFeedbackService</td>
            </tr>           
            <tr>
                <td>findURL</td>
                <td>fromWSDL</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>validationMethod</td>
                <td>wsdlSchema</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>advertiseWSDL</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Service Handler for &#x27;GetFeedbackService&#x27;</td>
            </tr>           
            <tr>
                <td>routingMode</td>
                <td>delegate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set app.version</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>app.version</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>1.0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set app.version</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ReceiveDeliveryService</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ReceiveDeliveryService.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ReceiveDeliveryService</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set app.version</td>
        </tr>
        <tr>
            <td>fault</td>
            <td>Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>reqChainIntermediary</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>routingCircuit</td>
            <td>DEI LIB - Politique Connexion</td>
        </tr>
        <tr>
            <td>webService</td>
            <td>ReceiveDeliveryService</td>
        </tr>
        <tr>
            <td>validationCircuit</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>beforeWSDLResponse</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>rspChainIntermediary</td>
            <td>DEI LIB - Flux Sortant Controle Response</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Service Handler for &#x27;ReceiveDeliveryService&#x27;</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEI LIB - Politique SOAP Fault</td>
        </tr>
    </table>
    <h3>filter :Service Handler for &#x27;ReceiveDeliveryService&#x27;</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>specifiedURL</td>
                <td>http://localhost:8080/ReceiveDeliveryService</td>
            </tr>           
            <tr>
                <td>findURL</td>
                <td>fromWSDL</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>validationMethod</td>
                <td>wsdlSchema</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>advertiseWSDL</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Service Handler for &#x27;ReceiveDeliveryService&#x27;</td>
            </tr>           
            <tr>
                <td>routingMode</td>
                <td>delegate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set app.version</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>app.version</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>1.0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set app.version</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEI LIB - Politique SOAP Fault&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Authorization Request</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Authorization_Request.svg">
    <table>
        <tr>
            <td>start</td>
            <td>set Audit Attribut</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Authorization Request</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>OAuthAuthZ //Test RECO</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>EXPIRATION.TIME OB // TEST RECO // DEBUG JN</td>
        </tr>
        <tr>
            <td>jwtSigner</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>InsertAPIOpenBanking</td>
        </tr>
        <tr>
            <td>scopeCircuitPK</td>
            <td>custom get scopes</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>authzCodeCache</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :AccessToken ou authzcode ?</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>def invoke(msg)         {            
	Object accesstoken &#x3D; msg.get(&quot;accesstoken&quot;);
	Object authzcode &#x3D; msg.get(&quot;authzcode&quot;);
	if ((accesstoken &#x3D;&#x3D; null) &amp;&amp; (authzcode &#x3D;&#x3D; null)) {
		return false;
	}
	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>AccessToken ou authzcode ?</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs OK</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs OK</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Create ID Token</h3>
    <table>           
            <tr>
                <td>subject</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>issuer</td>
                <td>${env.IDP.ISS}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>jwtExpiresIn</td>
                <td>${OPENIDTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>signatureAlg</td>
                <td>HS256</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create ID Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Compute at_hash_icdc Claim (contournement)</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.org.apache.commons.codec.binary);

function invoke(msg)         {            

	var hash, hashBytes, hashBytesLeftHalf, atHashICDC ;

if (msg.get(&quot;accesstoken&quot;) &#x3D;&#x3D; null)
{return true;
}
else {
	var accessToken &#x3D; new java.lang.String(msg.get(&quot;accesstoken&quot;));

Trace.debug(&quot;Access Token : &quot; + accessToken);	

	try {

		hash &#x3D; MessageDigest.getInstance(&quot;SHA-256&quot;);
		hash.reset();
		hash.update(accessToken.getBytes());

		hashBytes &#x3D; hash.digest();
	 	Trace.debug(&quot;HASH AT : &quot; +  new java.lang.String(hashBytes));

		hashBytesLeftHalf &#x3D; java.util.Arrays.copyOf(hashBytes, hashBytes.length / 2);
		Trace.debug(&quot;LEFT HALF HASH AT : &quot; + new java.lang.String(hashBytesLeftHalf));

		atHashICDC &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(hashBytesLeftHalf);
		Trace.debug(&quot;LEFT HALF HASH AT base64 : &quot; + atHashICDC);  

		msg.put(&quot;at.hash.icdc.claim&quot;, atHashICDC);

		return true;

	}  catch (e) {
		Trace.error(&quot;&gt;&gt;&gt;Exception : &quot; +e);
		msg.put(&quot;at.hash.icdc.claim&quot;, &quot;&quot;);
		return true;
	}
 }
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Compute at_hash_icdc Claim (contournement)</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Create JWT&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Create JWT&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :OAuthAuthZ //Test RECO</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>7</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>resourceOwnerCookieName</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>authzCodeLength</td>
                <td>30</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessCodeTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/showAccessCode.html</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>${ACCESSTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>loginTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/login-${codeApp}.html</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>authNWith</td>
                <td>INTERNAL_AUTHN_FLOW</td>
            </tr>           
            <tr>
                <td>grantAccessTemplateLocation</td>
                <td>${environment.VDISTDIR}/samples/oauth/templates/requestAccess-${codeApp}.html</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>authzCodeExpiresInSecs</td>
                <td>${ACCESSCODE.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>OAuthAuthZ //Test RECO</td>
            </tr>           
            <tr>
                <td>subjectAttr</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Circuit</td>
            </tr>           
    </table>
    <h3>filter :restore http.request.uri</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>restore http.request.uri</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove Cookie Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Cookie</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove Cookie Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Check Session - is User Authent ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>cookie</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Check Session - is User Authent ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{2}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{2}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Extract CODE ARAMIS from CLIENT_ID{1499328482029}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Extract CODE ARAMIS from CLIENT_ID{1499328482029}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call IDP - TITAN-HABILITATION</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call IDP - TITAN-HABILITATION</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :set Audit Attribut</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>set Audit Attribut</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Cookie jwttoken</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Set-Cookie</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>jwttoken${codeApp}&#x3D;; expires&#x3D;Thu, 01 Jan 1970 00:00:00 GMT; Domain&#x3D;dlintd2001.serv.cdc.fr; Path&#x3D;/api/oauth/authorize; HttpOnly;Secure;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Cookie jwttoken</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :store http.request.uri</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>store http.request.uri</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC IDP - GEDEON-ENTITY&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC IDP - GEDEON-ENTITY&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC IDP - BEL-COMPTES-OPENBANKING&#x27;{4}</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC IDP - BEL-COMPTES-OPENBANKING&#x27;{4}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Login Failed</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>redirect</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.header.Referer}#error&#x3D;loginfailed&amp;errordescription&#x3D;${error.description}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Login Failed</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter error.description habilitations</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Vous%20ne%20disposez%20pas%20des%20habilitations%20ad%C3%A9quates%2C%20dans%20CDC-Net%2C%20pour%20donner%20ce%20type%20d%E2%80%99autorisation.</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter error.description habilitations</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :End Session</h3>
    <table>           
            <tr>
                <td>removeCookie</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>cookie</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>${env.DSP2.COOKIE.PATH}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td>${env.DSP2.COOKIE.DOMAIN}</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>End Session</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter error.description comptes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Vous%20ne%20disposez%20pas%20de%20droits%2C%20dans%20CDC-Net%2C%20en%20consultation%20sur%20des%20comptes%20de%20paiements.</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter error.description comptes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Erreur détectée</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Erreur détectée</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;InsertAPIOpenBanking{6}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;InsertAPIOpenBanking{6}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Suppresion cookie OWNERCOOKIE</h3>
    <table>           
            <tr>
                <td>removeCookie</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>cookie</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>${env.DSP2.COOKIE.PATH}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td>${env.DSP2.COOKIE.DOMAIN}</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Suppresion cookie OWNERCOOKIE</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :content body is null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>content body is null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Abort</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in exception filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failure in exception filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Abort</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling exception filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :failure.reason is null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>failure.reason is null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Change URI with VIP name</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.org.apache.commons.codec.binary);
 
function invoke(msg)         {            
 
var host&#x3D;msg.get(&quot;vip.name&quot;);
            var protocol &#x3D; msg.get(&quot;http.request.protocol&quot;);
            var uri &#x3D; msg.get(&quot;http.request.uri&quot;);
            var requestURL &#x3D; new java.net.URL(protocol+&quot;://&quot;+host+uri);
            
          Trace.debug(&quot;java.net.URL : &quot;+ java.net.URL);
            msg.put(&quot;http.request.url&quot;, requestURL );
            return true;
            
 } 
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Change URI with VIP name</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Scope Specifique? // test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope Specifique? // test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Scope specifique? // Test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope specifique? // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :EXPIRATION.TIME Spe // TEST RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>EXPIRATION.TIME Spe // TEST RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :EXPIRATION.TIME OB // TEST RECO // DEBUG JN</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>EXPIRATION.TIME OB // TEST RECO // DEBUG JN</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter // TEST RECO</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter // TEST RECO</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - ISS Create JWT</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_ISS_Create_JWT.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - ISS Create JWT</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Initialize Attributes ISSProfile</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Authorisation aisp &amp; cbpii?</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>// Erreur 403</td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>All Elements inside SOAP Body (SOAP 1.1 or SOAP 1.2)</td>
        </tr>
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${gide.jwt.payload.b64}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialize Attributes ISSProfile</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialize Attributes ISSProfile</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Transform iss.listeHabilitationsFines</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
function invoke(msg)         {         

	
	var roles &#x3D; new java.util.ArrayList();
	//type java.util.ArrayList
	var listeHabilitationsFines&#x3D; msg.get(&quot;iss.listeHabilitationsFines&quot;);
	var scopesTri &#x3D; &quot;&quot;;
	var idFonctionnelHFinesString &#x3D; &quot;&quot;;
	
	if (typeof listeHabilitationsFines&#x3D;&#x3D;&#x3D;&#x27;object&#x27; &amp;&amp; listeHabilitationsFines!&#x3D; null) {
		Trace.debug(listeHabilitationsFines);
		for ( i &#x3D;0 ; i &lt;listeHabilitationsFines.size() ; i++){
			var habilitation &#x3D; listeHabilitationsFines.get(i);
			var idFonctionnelHFines &#x3D; habilitation.get(&quot;idFonctionnelHFines&quot;);
			var valeurParDefaut &#x3D;  habilitation.get(&quot;valeurParDefaut&quot;);
			idFonctionnelHFines&#x3D;idFonctionnelHFines.replace(&quot;HF_B_PISP&quot;, &quot;pisp&quot;).replace(&quot;HF_B_AISP&quot;, &quot;aisp&quot;).replace(&quot;HF_B_CBPII&quot;, &quot;cbpii&quot;);

			Trace.debug(idFonctionnelHFines + &quot;:&quot; + valeurParDefaut );
			if(valeurParDefaut &#x3D;&#x3D;&quot;1&quot;){
				roles.add(&quot;\&quot;&quot;+idFonctionnelHFines+&quot;\&quot;&quot; );
				idFonctionnelHFinesString &#x3D; idFonctionnelHFinesString + &quot; &quot; + idFonctionnelHFines;
			}
		}
	Trace.debug(&quot;idFonctionnelHFinesString&quot; + &quot;:&quot; + idFonctionnelHFinesString );
	msg.put(&quot;iss.idFonctionnelHFinesString&quot;, idFonctionnelHFinesString);
	}

	if (roles.size()&gt;0){
		msg.put(&quot;iss.roles&quot;,roles);
		return true;
	}
	else{
		return false;
	}         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Transform iss.listeHabilitationsFines</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Build ISS JWT Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>bel.jwt.payload</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>{
	&quot;iss&quot;:&quot;${env.IDP.ISS}&quot;,
	&quot;iat&quot;:${now},
	&quot;exp&quot;:${expiration.time},
	&quot;sub&quot;:&quot;${authentication.subject.id}&quot;,
	&quot;urn:cdc:claims:applicationEnv&quot;: &quot;${env.TYPE.ENVIRONNEMENT}&quot;,
	&quot;urn:cdc:claims:user:domaine&quot;: &quot;${apimgmt.application.domaine}&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:login&quot; : &quot;${gedeon.login}&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:nom&quot; : &quot;${gedeon.nom}&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:prenom&quot; : &quot;${gedeon.prenom}&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:tiers&quot; : &quot;${gedeon.numeroTiers}&quot;
}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build ISS JWT Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Base64 Encode Payload JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.common.base64.Encoder;

def invoke(msg)         
{        
    String data &#x3D; msg.get(&quot;bel.jwt.payload&quot;);
    String base64EncodedData &#x3D; Encoder.encodeNoLineBreaks(data.getBytes());
    msg.put(&quot;gide.jwt.payload.b64&quot;, base64EncodedData);
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Base64 Encode Payload JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp;
	var expirationTime&#x3D;msg.get(&quot;expirationTime&quot;);

	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration en ms
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract Profil Value</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Profil Value</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :create sub &amp; login</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
function invoke(msg)         {         

	var reponse &#x3D; msg.get(&quot;authentication.subject.id&quot;);
	var index &#x3D; 	reponse.indexOf(&quot;|&quot;);
	var sub&#x3D; reponse ;
	var login&#x3D; reponse ;	

	Trace.debug(&quot;response:&quot;+reponse);
	
	if ( index  &gt;0 ){
		sub&#x3D; reponse.substring(0, index);
		login&#x3D; reponse.substring(index+1);
	}

	Trace.debug(&quot;sub:&quot;+sub);
	Trace.debug(&quot;login:&quot;+ login);	

	msg.put(&quot;jwt.sub&quot;,sub);
	msg.put(&quot;jwt.login&quot;,login);
	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>create sub &amp; login</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :// Erreur 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Erreur 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter ://test reco</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>//test reco</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Scope Specifique? Authorisation pisp?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope Specifique? Authorisation pisp?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Scope aisp? Authorisation aisp?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope aisp? Authorisation aisp?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Scope cbpii ? Authorisation cbpii?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope cbpii ? Authorisation cbpii?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Scope cbpii &amp; aisp ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scope cbpii &amp; aisp ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Authorisation aisp &amp; cbpii?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Authorisation aisp &amp; cbpii?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - ISS-AUTHENT</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_ISS-AUTHENT.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - ISS-AUTHENT</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Store Message</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Reset Attribute authentication.subject.id</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>create iss.login &amp; iss.numeroabonne</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>All Elements inside SOAP Body (SOAP 1.1 or SOAP 1.2)</td>
        </tr>
    </table>
    <h3>filter :Set Attribute error.description user unauthorized</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Vous%20n%27%C3%AAtes%20pas%20autoris%C3%A9s%20%C3%A0%20vous%20connecter%20%C3%A0%20cette%20application%20!</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description user unauthorized</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute error.description erreur technique</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Erreur%20Interne%20Grave%20!</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description erreur technique</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Build ISService Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build ISService Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&#x27;1.0&#x27; encoding&#x3D;&#x27;UTF-8&#x27;?&gt;
&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:sch&#x3D;&quot;http://dei.icdc.fr/2008/09/iss/schema&quot;&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;sch:verifActivCard&gt;
         &lt;inLogin&gt;${params.query.UserName}&lt;/inLogin&gt;
         &lt;inToken&gt;${params.query.Passwd}&lt;/inToken&gt;
      &lt;/sch:verifActivCard&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Check Response Status Constains 200</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Check Response Status Constains 200</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute error.description authent failed</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Utilisateur%20ou%20mot%20de%20passe%20invalide%20!</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description authent failed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${params.query.UserName}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Message On Error</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Message On Error</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connect to ISS  /ISSWeb/services/ISS</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://dlj2eedevd2010.serv.cdc.fr:10030/ISSWeb/services/ISS</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to ISS  /ISSWeb/services/ISS</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter // test ELK JNV</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter // test ELK JNV</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :is login Invalide ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>is login Invalide ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Reset Attribute authentication.subject.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${iss.login}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reset Attribute authentication.subject.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :create iss.login &amp; iss.numeroabonne</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td>iss.numeroabonne</td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
function invoke(msg)         {         

	var reponse &#x3D; msg.get(&quot;iss.response&quot;);
	var split &#x3D; 	reponse.split(&quot;[|]&quot;);
	var login&#x3D; split[0] ;	
	var numeroabonne&#x3D; split[1];
	Trace.debug(&quot;numeroabonne:&quot;+numeroabonne);
	Trace.debug(&quot;login:&quot;+ login);	

	msg.put(&quot;iss.numeroabonne&quot;,numeroabonne);
	msg.put(&quot;iss.login&quot;,login);
	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td>iss.response</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>create iss.login &amp; iss.numeroabonne</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Login ISS</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Login_ISS.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Set Audit Attribut</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Login ISS</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Initialise Piste Audit Attributs OK</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set Attribute error.description authent failed</td>
        </tr>
        <tr>
            <td>xpathContentCheck</td>
            <td>XPTAH Extract roles item element</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - ISS-AUTHENT</td>
        </tr>
    </table>
    <h3>filter :Set Attribut codeApp ARAMIS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>codeApp</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${apimgmt.application.codeAramis.toLowerCase()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut codeApp ARAMIS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute error.description erreur technique</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Erreur%20Interne%20Grave%20!</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description erreur technique</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${params.query.ApplicationID}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.application</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Audit Attribut</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Audit Attribut</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs OK</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs OK</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Login Failed</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Login Failed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>redirect</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.client.getCgiArgument(&quot;continue&quot;)}#error&#x3D;loginfailed&amp;errordescription&#x3D;${error.description}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Redirect to OAuth Service</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Redirect to OAuth Service</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>redirect</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.client.getCgiArgument(&quot;continue&quot;)}</td>
            </tr>           
    </table>
    <h3>filter :Extract from FORM Username Password ApplicationID</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract from FORM Username Password ApplicationID</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute error.description authent failed</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Les%20informations%20transmises%20n%27ont%20pas%20permis%20de%20vous%20authentifier</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description authent failed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute error.description user unauthorized</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>error.description</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>Vous%20n%27%C3%AAtes%20pas%20autoris%C3%A9s%20%C3%A0%20vous%20connecter%20%C3%A0%20cette%20application%20!</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute error.description user unauthorized</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Exist Valid Roles ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message passed XPath filtering</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message failed XPath filtering</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Exist Valid Roles ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during XPath filtering. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Create Session OWNERCOOKIE</h3>
    <table>           
            <tr>
                <td>cookie</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>${env.DSP2.COOKIE.PATH}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>sessionExpiry</td>
                <td>${env.DSP2.SESSION.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>onlySendOverSSL</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td>${env.DSP2.COOKIE.DOMAIN}</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create Session OWNERCOOKIE</td>
            </tr>           
            <tr>
                <td>httpOnly</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;Call ISS-AUTHENT&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;Call ISS-AUTHENT&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header Cookie</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Cookie</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header Cookie</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Compare Attribute</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Compare Attribute</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - TITAN-HABILITATION</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_TITAN-HABILITATION.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - TITAN-HABILITATION</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Build Titan Payload</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Connect to Titan /TitanService/TitanService/AbonneService</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to Titan /TitanService/TitanService/AbonneService</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://sps-support-confiancenum-int.serv.cdc.fr:10100/Confiance/Numerique/Prive/GIDE/INFO/Facade/V1.2.6</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Titan /TitanService/TitanService/AbonneService</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Build Titan Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build Titan Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&#x27;1.0&#x27; encoding&#x3D;&#x27;UTF-8&#x27;?&gt;
&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:urn&#x3D;&quot;urn:fr:icdc:dei:banque:titan:titanservice:ws:schema&quot;&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;urn:consulterHabilitationsFinesRequest&gt;
         &lt;urn:numeroAbonne&gt;${authentication.subject.id}&lt;/urn:numeroAbonne&gt;
         &lt;urn:typeConsultation&gt;ACTIF&lt;/urn:typeConsultation&gt;
         &lt;urn:listeIdFonctionnelHAcces&gt;HA_OPEN_BANKING&lt;/urn:listeIdFonctionnelHAcces&gt;
      &lt;/urn:consulterHabilitationsFinesRequest&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Extract CODE ARAMIS from CLIENT_ID</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Extract_CODE_ARAMIS_from_CLIENT_ID.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Extract CODE ARAMIS from CLIENT_ID</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set Attribut oauth.client.id</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set  default Attribut codeApp</td>
        </tr>
    </table>
    <h3>filter :Set Attribut codeApp ARAMIS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>codeApp</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${ apimgmt.application.codeAramis.toLowerCase()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut codeApp ARAMIS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut oauth.client.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut oauth.client.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut oauth.application.id from KPS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut oauth.application.id from KPS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${oauth.application.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.application</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :oauth.application.id is not null</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>oauth.application.id is not null</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set  default Attribut codeApp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>codeApp</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set  default Attribut codeApp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Logout Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Logout_Service.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Logout Service</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set Audit Attribut</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Attribut oauth.application.id from KPS</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract AUD et CODEAPP claims from ID_TOKEN</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         {           

	var idToken &#x3D; String(msg.get(&quot;params.query.id_token_hint&quot;));
	Trace.debug(&quot;&gt;&gt;&gt; idToken : &quot; + idToken);

	var tokenParts &#x3D; idToken.split(&quot;.&quot;);
	Trace.debug(&quot;&gt;&gt;&gt; tokenParts : &quot; + tokenParts[0]);
	Trace.debug(&quot;&gt;&gt;&gt; tokenParts : &quot; + tokenParts[1]);

	//PAD Base64
	var base64data &#x3D; tokenParts[1];

    	while (base64data.length % 4 !&#x3D;&#x3D; 0) {
      		base64data+&#x3D; &quot;&#x3D;&quot;;
	}

	Trace.debug(&quot;&gt;&gt;&gt; base64data : &quot; + base64data);

	var claimsJson &#x3D; Decoder.decodeToString(base64data);
	Trace.debug(&quot;&gt;&gt;&gt; claimsJson : &quot; + claimsJson);

	var claims &#x3D; JSON.parse(claimsJson);

	var aud &#x3D; claims.aud;
	var codeapp &#x3D; claims.codeapp;

	Trace.debug(&quot;&gt;&gt;&gt; aud : &quot; + aud);
	Trace.debug(&quot;&gt;&gt;&gt; codeapp : &quot; + codeapp);

	msg.put(&quot;id.token.claim.aud&quot;,  aud);
	msg.put(&quot;codeApp&quot;,  codeapp.toLowerCase());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract AUD et CODEAPP claims from ID_TOKEN</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs OK</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs OK</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute codeApp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>codeApp</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${apimgmt.application.codeAramis.toLowerCase()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute codeApp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut oauth.application.id from KPS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut oauth.application.id from KPS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :HTTP Redirect</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>301</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>HTTP Redirect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/octet-stream</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${params.query.post_logout_redirect_uri}</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>empty</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :End Session</h3>
    <table>           
            <tr>
                <td>removeCookie</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>cookie</td>
                <td>OWNERCOOKIE${codeApp}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>uriprefix</td>
                <td>${env.DSP2.COOKIE.PATH}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>domain</td>
                <td>${env.DSP2.COOKIE.DOMAIN}</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>End Session</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Audit Attribut</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Audit Attribut</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Copy of&#x27;Trace Filter{1}&#x27;{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Copy of&#x27;Trace Filter{1}&#x27;{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${oauth.application.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.application</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut oauth.client.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut oauth.client.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Default Response Policy API Manager</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Default_Response_Policy_API_Manager.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Default Response Policy API Manager</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Trace Filter test 13/02/2019</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Initialise Piste Audit Attributs OK</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique End</td>
        </tr>
    </table>
    <h3>filter :Initialise Piste Audit Attributs OK</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs OK</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique End{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique End{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter test 13/02/2019</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter test 13/02/2019</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Default URL-based Routing Policy API Manager</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Default_URL-based_Routing_Policy_API_Manager.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Default URL-based Routing Policy API Manager</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Initialize Error Attributs </td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>fault</td>
            <td>Call &#x27;DEFAULT - Process Error&#x27;</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Connect to Backend</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td></td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEFAULT - Process Error</td>
        </tr>
    </table>
    <h3>filter :Connect to Backend</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${destinationURL}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Backend</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEFAULT - Process Error&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEFAULT - Process Error&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialize Error Attributs </h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialize Error Attributs </td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract SPS Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract SPS Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Trace Technique End</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Trace_Technique_End.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Trace Technique End</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract End Time and Produce Trace</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Extract End Time and Produce Trace</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>//importPackage(java.util);
//importClass(java.text.SimpleDateFormat);

function invoke(msg)         {           
	
	var now &#x3D; new Date(); 

//	var df&#x3D; new SimpleDateFormat(&quot;dd/MMMMM/yyyy:HH:mm:ss SSSS&quot;, Locale.FRANCE);
//	var dateEndDisplay &#x3D; df.format(now.getTime());
	var dateEndDisplay &#x3D; now.toUTCString();
	
	var startTime &#x3D; msg.get(&quot;technique.stat.start&quot;);

	var totalTimeMs &#x3D; Math.round(parseInt(now.getTime()) - parseInt(startTime));
	msg.put(&quot;request.reponse.time&quot;, totalTimeMs);

	var userid &#x3D; msg.get(&quot;authentication.subject.id&quot;);

	if (!userid) {
		userid &#x3D; null;
	} else {
		userid &#x3D; String(userid);
	}

	
	// Nom du path ou de l&#x27;API
	var apiName &#x3D; msg.get(&quot;api.name&quot;);
	var targetURL;

	if (apiName) {
		var serviceName &#x3D; msg.get(&quot;service.name&quot;);
		targetURL &#x3D; serviceName  + &quot; - &quot; + msg.get(&quot;api.method.path&quot;);
	} else {
		targetURL &#x3D; msg.get(&quot;resolved.to.path&quot;);
	}

	// AdresseIp 
	var ipSource &#x3D; msg.get(&quot;request.ip.source&quot;);
	var ipOrigin &#x3D; msg.get(&quot;request.ip.origin&quot;);

	if (!ipSource) {
		ipSource &#x3D; msg.get(&quot;http.request.clientaddr&quot;);
		ipOrigin &#x3D; msg.get(&quot;http.request.clientaddr&quot;);
	} 

	// Récupération d&#x27;un message d&#x27;erreur
	// Attention, par defaut, il y a un message d&#x27;erreur standard
	var detail &#x3D; msg.get(&quot;msg.error.reason&quot;);
	if (!detail) {
		detail &#x3D; &quot;Aucun détail&quot;;
	} 

	// Extraction du code statut
	var codeStatus &#x3D;  msg.get(&quot;http.response.status&quot;) ? msg.get(&quot;http.response.status&quot;) : msg.get(&quot;msg.error.status&quot;);

	if (codeStatus) {
		codeStatus	&#x3D; String(codeStatus);

		if (codeStatus.substring(0,1) &#x3D;&#x3D;&#x3D; &quot;2&quot; || codeStatus.substring(0,1) &#x3D;&#x3D;&#x3D;&quot;3&quot;  ) {
			detail &#x3D; &quot;Aucun détail&quot;;
		}
	}	


	var trace &#x3D; &quot;TECHNIQUE#STAT_DUREE_CIRCUIT#&quot; + dateEndDisplay + &quot;#&quot; + ipSource  + &quot;#&quot; + ipOrigin  + &quot;#&quot; + msg.get(&quot;http.request.verb&quot;)  + &quot;#&quot; + targetURL  + &quot;#&quot; + msg.get(&quot;id&quot;)  + &quot;#&quot; + userid + &quot;#&quot; + codeStatus  + &quot;#&quot; + totalTimeMs  + &quot;#&quot; + detail;
	msg.put(&quot;trace.technique&quot;, trace);

	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>${trace.technique}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract End Time and Produce Trace</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>nashorn</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Generate Piste Audit</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>7</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>//importPackage(java.util);
//importClass(java.text.SimpleDateFormat);
//importPackage(Packages.com.vordel.trace);

function invoke(msg)         {           
	
	var now &#x3D; new Date(); 

//	var df&#x3D; new SimpleDateFormat(&quot;dd/MMMMM/yyyy:HH:mm:ss SSSS&quot;, Locale.FRANCE);
//	var dateDisplay &#x3D; df.format(now.getTime());

	var dateEndDisplay &#x3D; now.toUTCString();
	
	var action &#x3D; msg.get(&quot;audit.action&quot;);
	var status &#x3D; msg.get(&quot;audit.status&quot;);
	var provider &#x3D; msg.get(&quot;audit.provider&quot;);
	var detail &#x3D; msg.get(&quot;audit.detail&quot;);
	var userid &#x3D; msg.get(&quot;authentication.subject.id&quot;);

	if (!userid) {
		userid &#x3D; null;
	} else {
		userid &#x3D; String(userid);
	}

	if (!detail) {
		detail &#x3D; msg.get(&quot;msg.error.reason&quot;);
		if (!detail) {
			detail &#x3D; &quot;Aucun détail&quot;;
		}
	}	
	
	// AdresseIp 
	var ipSource &#x3D; msg.get(&quot;request.ip.source&quot;);
	var ipOrigin &#x3D; msg.get(&quot;request.ip.origin&quot;);

	if (!ipSource) {
		ipSource &#x3D; msg.get(&quot;http.request.clientaddr&quot;);
		ipOrigin &#x3D; msg.get(&quot;http.request.clientaddr&quot;);
	} 

	var trace &#x3D; &quot;AUDIT#SPS#&quot;+dateEndDisplay  +&quot;#&quot; + ipSource +&quot;#&quot; +  ipOrigin +&quot;#&quot; + msg.get(&quot;id&quot;)  +&quot;#&quot; + action  +&quot;#&quot; + status +&quot;#&quot; + provider +&quot;#&quot; + userid +&quot;#&quot; + detail;
	msg.put(&quot;piste.audit&quot;, trace);

	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>${piste.audit}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Generate Piste Audit</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>nashorn</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Trace Technique Start</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Trace_Technique_Start.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract Start Time</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Retrieve from HTTP header X-Forwarded-For</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Initialize Error Default Attributs </h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialize Error Default Attributs </td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Default Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Default Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute request.ip.source</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>request.ip.source</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute request.ip.source</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve from HTTP header X-Forwarded-For</h3>
    <table>           
            <tr>
                <td>headerName</td>
                <td>X-Forwarded-For</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>base64Decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from HTTP header</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attribute HTTP header</td>
            </tr>           
            <tr>
                <td>useQueryParameter</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve from HTTP header X-Forwarded-For</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>request.ip.source</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from HTTP header. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Retrieve from HTTP header X-From-IP-Origin</h3>
    <table>           
            <tr>
                <td>headerName</td>
                <td>X-From-IP-Origin</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>base64Decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attribute from HTTP header</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attribute HTTP header</td>
            </tr>           
            <tr>
                <td>useQueryParameter</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Retrieve from HTTP header X-From-IP-Origin</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>request.ip.origin</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from HTTP header. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract Start Time</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {           
	
	var now &#x3D; new Date(); 

	msg.put(&quot;technique.stat.start&quot;, now.getTime().toString());

	return true;
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Start Time</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>nashorn</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :get body.length</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	//Extraction params.body
	var body &#x3D;msg.get(&quot;content.body&quot;);

	if (body !&#x3D; null) {
		var taille &#x3D; body.getContentLength(0);
		msg.put(&quot;body.length&quot;,taille   );
		com.vordel.trace.Trace.debug(&quot;body.length : &quot;+ taille );
	} else {
		msg.put(&quot;body.length&quot;, &quot;n/a&quot;);
	}
	return true;
}

</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>get body.length</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>nashorn</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :True Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute request.ip.origin</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>request.ip.origin</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute request.ip.origin</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEFAULT - Process Error Socle</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEFAULT_-_Process_Error_Socle.svg">
    <table>
        <tr>
            <td>name</td>
            <td>DEFAULT - Process Error Socle</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Trace Filter</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Reflect Message ERROR</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Reflect Message ERROR</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique End</td>
        </tr>
    </table>
    <h3>filter :Reflect Message ERROR</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>${msg.error.status}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect Message ERROR</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;is http.response.status Defined ?&#x27;{1}</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;is http.response.status Defined ?&#x27;{1}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Default Initialize Error Attributs 500</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Default Initialize Error Attributs 500</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Erreur Status?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Erreur Status?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique End{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique End{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message ERROR</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message ERROR</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
	&quot;error&quot; :  &quot;${msg.error.code}&quot;,
	&quot;error_description&quot; : &quot;${msg.error.reason}&quot;,
	&quot;id&quot; : &quot;${id}&quot;
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json; charset&#x3D;utf-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Error Attribute</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Error Attribute</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Error 500</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Error 500</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message error</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message error</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
	&quot;error&quot; :  &quot;${error}&quot;,
	&quot;message&quot; : &quot;${message}&quot;,
	&quot;path&quot; : &quot;${path}&quot;,
	&quot;status&quot; : ${status},
	&quot;timestamp&quot; : &quot;${timestamp}&quot;
	
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json; charset&#x3D;utf-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Access Token Info</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Access_Token_Info.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Access Token Information</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Access Token Info</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Trace Filter</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Access Token Information</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>accessTokenLocationSelector</td>
                <td>${http.client.getCgiArgument(&#x27;access_token&#x27;)}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access Token Information</td>
            </tr>           
            <tr>
                <td>accessTokenLocationQueryString</td>
                <td>access_token</td>
            </tr>           
            <tr>
                <td>accessTokenLocation</td>
                <td>SELECTOR</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Access Code</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Access_Code.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Exchange AuthZ Code for Access Token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Access Code</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>AccessToken ?</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>authzCodeCache</td>
            <td></td>
        </tr>
        <tr>
            <td>jwtSigner</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Controle Certificat</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>AccessToken ?</td>
        </tr>
    </table>
    <h3>filter :Exchange AuthZ Code for Access Token</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>${env.DSP2.REFRESHTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>${env.DSP2.ACCESSTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Exchange AuthZ Code for Access Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>
    <h3>filter :Create an Open ID Connect ID Token</h3>
    <table>           
            <tr>
                <td>subject</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>issuer</td>
                <td>${http.request.url}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>jwtExpiresIn</td>
                <td>60</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>signatureAlg</td>
                <td>RS256</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create an Open ID Connect ID Token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Remove jwttoken codeChallenge</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>jwttoken</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Remove jwttoken codeChallenge</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC IDP - PKCE CONTROL&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC IDP - PKCE CONTROL&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter / test RECO</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter / test RECO</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :AccessToken ?</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>def invoke(msg)         {            
	Object accesstoken &#x3D; msg.get(&quot;accesstoken&quot;);
	if (accesstoken &#x3D;&#x3D; null) {
		return false;
	}
	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>AccessToken ?</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Abort</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in exception filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failure in exception filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Abort</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling exception filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :// Extract scopes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.kps.impl.KPS
import com.vordel.kps.query.KeyQuery;
import com.vordel.kps.ObjectNotFound
import com.vordel.trace.Trace
import com.vordel.circuit.oauth.common.OAuth2Utils
import com.vordel.common.apiserver.discovery.model.OAuthAppScope
import java.util.ArrayList

def invoke(msg) {
    	
    try {
       def strScopes &#x3D; msg.get(&quot;params.query.scope&quot;);
       ArrayList requestedScopes &#x3D; null;
       if (strScopes !&#x3D; null){
           requestedScopes &#x3D; strScopes.tokenize(&quot; &quot;);
           Trace.debug(&quot; requested scopes: &quot;+ requestedScopes );
	msg.put(&quot;query.requestedScopes&quot;,requestedScopes)  
       }     
   
    } catch(Exception e) {
        Trace.error(e)
        return false
    }
    
    return true
}

</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Extract scopes</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract PrivateKey // Test CPF</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.security.KeyFactory;
import java.security.PrivateKey;
import java.security.spec.PKCS8EncodedKeySpec;
import java.util.Date;
import java.security.interfaces.RSAPrivateKey;
import com.vordel.security.cert.PersonalInfo;
import com.vordel.store.cert.CertStore;
import com.vordel.trace.Trace

def invoke(msg) {
    	
    try {
String certificateAlias &#x3D; &quot;apiadmin-banque-extcommun-reco.interext.cdc.fr&quot;; // msg.get(&quot;certificateAlias&quot;);


CertStore certs &#x3D; CertStore.getInstance();
PersonalInfo pi &#x3D; certs.getPersonalInfoByAlias(certificateAlias);
PrivateKey privKey &#x3D; pi.privateKey;


PKCS8EncodedKeySpec spec &#x3D; new PKCS8EncodedKeySpec(privKey.getEncoded());
KeyFactory rsaFact &#x3D; KeyFactory.getInstance(&quot;RSA&quot;);
RSAPrivateKey privateKey &#x3D; (RSAPrivateKey) rsaFact.generatePrivate(spec);

 msg.put(&quot;privateKey&quot;,  privateKey);        
   
    } catch(Exception e) {
        Trace.error(e)
        return false
    }
    
    return true
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract PrivateKey // Test CPF</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter // test CPF</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter // test CPF</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Presence Certificat //Test Reco</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Presence Certificat //Test Reco</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Controle Certificat // Test Reco</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Controle Certificat // Test Reco</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Access Token Service</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Access_Token_Service.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Access Token Service</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>defaultCircuit</td>
            <td>Return HTTP Error 401: Unauthorized</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Abort</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>error &#x3D; Unsupported Media Type</td>
        </tr>
    </table>
    <h3>filter :Decide what grant type to use</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decide what grant type to use</td>
            </tr>           
            <tr>
                <td>defaultOption</td>
                <td>RETURN_DEFAULT_CIRCUIT</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>${content.body.getParameters().get(&quot;grant_type&quot;)}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Validate Selector Expression</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate Selector Expression</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :error &#x3D; Unsupported Media Type</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>error &#x3D; Unsupported Media Type</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Abort</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in exception filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failure in exception filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Abort</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling exception filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Refresh</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Refresh.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Refresh Access token</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Refresh</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>JSON Remove jwttoken et codeChallenge</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Abort</td>
        </tr>
    </table>
    <h3>filter :Refresh Access token</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>${env.DSP2.REFRESHTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>${env.DSP2.ACCESSTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>PreserveRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>QueryString</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Refresh Access token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>
    <h3>filter :JSON Remove jwttoken et codeChallenge</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>jwttoken</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Remove jwttoken et codeChallenge</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :content body is null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>content body is null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :failure.reason is null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>failure.reason is null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Abort</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in exception filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failure in exception filter</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Abort</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling exception filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Client Credentials</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Client_Credentials.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Gestion Certificat ? // Test RECO</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Client Credentials</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;ICDC IDP - Create JWT without Authent&#x27;</td>
        </tr>
        <tr>
            <td>scopeCircuitPK</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Controle Certificat</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Call &#x27;ICDC IDP - Create JWT without Authent&#x27;</td>
        </tr>
    </table>
    <h3>filter :Access Token using client credentials</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>${env.DSP2.ACCESSTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>oauth.client.details</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NoRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access Token using client credentials</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>
    <h3>filter :JSON Remove jwttoken</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>jwttoken</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Remove jwttoken</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC IDP - Create JWT without Authent&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC IDP - Create JWT without Authent&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${oauth.client.details.getName()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Access Token using client credentials for Save Jwt</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>43200</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>true</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>36000</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>oauth.client.details</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NoRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Access Token using client credentials for Save Jwt</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>
    <h3>filter :Store Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ? // Test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ? // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Presence Certificat // Test RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Presence Certificat // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Controle Certificat</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Controle Certificat</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Create JWT without Authent</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Create_JWT_without_Authent.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Create JWT without Authent</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract REST Request Attributes</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Base64 Decode Bearer</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>http.header.authorization not null?</td>
        </tr>
    </table>
    <h3>filter :Calcul delai expiration jeton JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp;
	var expirationTime&#x3D;msg.get(&quot;expirationTime&quot;);

	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration en ms
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Base64 Encode Payload JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.common.base64.Encoder;

def invoke(msg)         
{        
    String data &#x3D; msg.get(&quot;jwt.payload&quot;);
    String base64EncodedData &#x3D; Encoder.encodeNoLineBreaks(data.getBytes());
    msg.put(&quot;jwt.payload.b64&quot;, base64EncodedData);
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Base64 Encode Payload JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Build JWT Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.payload</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>{
	&quot;iss&quot;:&quot;${env.IDP.ISS}&quot;,
	&quot;iat&quot;:${now},
	&quot;exp&quot;:${expiration.time},
	&quot;sub&quot;:&quot;${jwt.sub}&quot;,
	&quot;urn:cdc:claims:applicationEnv&quot;: &quot;${env.TYPE.ENVIRONNEMENT}&quot;,
	&quot;urn:cdc:claims:user:domaine&quot;: &quot;${apimgmt.application.domaine}&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:login&quot; : &quot;${jwt.login}&quot;
}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build JWT Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${jwt.payload.b64}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :create sub &amp; login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>create sub &amp; login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Read Application</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${oauth.application.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.application</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read Application</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribut oauth.application.id from KPS</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribut oauth.application.id from KPS</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Base64 Decode Bearer</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
function invoke(msg)         {            

try{
      var authHeader &#x3D; msg.get(&quot;http.header.Authorization&quot;);
      var values &#x3D; authHeader.split(&quot; &quot;);
      var encodedValue &#x3D; values[1];
      Trace.debug(&quot;Base64-encoded Authorization Value: &quot; + encodedValue);
      var decoded &#x3D; com.vordel.common.base64.Decoder.decodeToString(encodedValue);
      var index &#x3D; decoded.indexOf(&#x27;:&#x27;);
      var clientId &#x3D; decoded.substring(0, index);
      msg.put(&quot;client_id&quot;, clientId);
      return true;         
     }
	 catch (e) {
		Trace.error(&quot;&gt;&gt;&gt;Exception : &quot; +e);
	return false;
  }
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Base64 Decode Bearer</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :http.header.authorization not null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>http.header.authorization not null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :http.header.Authorization not null?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>http.header.Authorization not null?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :authorization -&gt; Authorization</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>authorization -&gt; Authorization</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - BEL-COMPTES-OPENBANKING</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_BEL-COMPTES-OPENBANKING.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - BEL-COMPTES-OPENBANKING</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Build BEL Payload</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>False Filter</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>// Erreur 403</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>All Elements inside SOAP Body (SOAP 1.1 or SOAP 1.2)</td>
        </tr>
    </table>
    <h3>filter :Build BEL Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build BEL Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&#x27;1.0&#x27; encoding&#x3D;&#x27;UTF-8&#x27;?&gt;
&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:urn&#x3D;&quot;urn:fr:icdc:dei:banque:titan:titanservice:ws:schema&quot;&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;urn:recupererListeComptesOpenBankingRequest&gt;
         &lt;urn:numeroAbonne&gt;${authentication.subject.id}&lt;/urn:numeroAbonne&gt;
      &lt;/urn:recupererListeComptesOpenBankingRequest&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connect to Titan /TitanService/TitanService/CompteService</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://dlj2eedevd2010.serv.cdc.fr:10050/TitanService/TitanService/CompteService</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Titan /TitanService/TitanService/CompteService</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute bel.recupererListeComptes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>bel.recupererListeComptes</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute bel.recupererListeComptes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :listeComptes not null ?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>expression</td>
                <td>${listeComptes.size() &gt; 0}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>listeComptes not null ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :True Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>True filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>True Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>True filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :// Erreur 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Erreur 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - GEDEON-ENTITY</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_GEDEON-ENTITY.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - GEDEON-ENTITY</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Build Gedeon Payload</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>All Elements inside SOAP Body (SOAP 1.1 or SOAP 1.2)</td>
        </tr>
    </table>
    <h3>filter :Build Gedeon Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build Gedeon Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>&lt;?xml version&#x3D;&#x27;1.0&#x27; encoding&#x3D;&#x27;UTF-8&#x27;?&gt;
&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:sch&#x3D;&quot;http://dei.icdc.fr/2012/12/ServicesGedeon/schema&quot;&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;sch:chercherAbonnesParNumerosAbonnes&gt;
         &lt;parametres&gt;
            &lt;!--1 or more repetitions:--&gt;
            &lt;listeNumerosAbonnes&gt;${authentication.subject.id}&lt;/listeNumerosAbonnes&gt;
            &lt;!--Optional:--&gt;
            &lt;codeApplication&gt;&lt;/codeApplication&gt;
            &lt;avecIdentite&gt;true&lt;/avecIdentite&gt;
            &lt;avecPrestations&gt;false&lt;/avecPrestations&gt;
         &lt;/parametres&gt;
      &lt;/sch:chercherAbonnesParNumerosAbonnes&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/xml;charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Connect to Gedeon /Gedeon/services/ServicesGedeon</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>http://dlj2eedevd2010.serv.cdc.fr:10650/Gedeon/services/ServicesGedeon</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to Gedeon /Gedeon/services/ServicesGedeon</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Resource Owner Password Credentials</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Resource_Owner_Password_Credentials.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC IDP - Create JWT with Basic Authent&#x27;</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Resource Owner Password Credentials</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Trace Filter</td>
        </tr>
        <tr>
            <td>scopeCircuitPK</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Create JWT with Basic Authent</td>
        </tr>
    </table>
    <h3>filter :Resource Owner Password Credentials</h3>
    <table>           
            <tr>
                <td>accessTokenlength</td>
                <td>54</td>
            </tr>           
            <tr>
                <td>scopesMustMatch</td>
                <td>Any</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>accessTokenType</td>
                <td>Bearer</td>
            </tr>           
            <tr>
                <td>refreshTokenExpiresInSecs</td>
                <td>${env.DSP2.REFRESHTOKEN.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>username</td>
            </tr>           
            <tr>
                <td>recordOutboundTxns</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>accessTokenExpiresInSecs</td>
                <td>${env.DSP2.ACCESSCODE.EXPIRATION.TIME}</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>authNWith</td>
                <td>REPOSITORY</td>
            </tr>           
            <tr>
                <td>refreshTokenlength</td>
                <td>46</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>refreshChoice</td>
                <td>NewRefresh</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>password</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>scopesForToken</td>
                <td>${scopes.for.token}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Resource Owner Password Credentials</td>
            </tr>           
            <tr>
                <td>subjectAttr</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>scopeChoice</td>
                <td>Application</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC IDP - Create JWT with Basic Authent&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC IDP - Create JWT with Basic Authent&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Remove jwttoken</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>jwttoken</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Remove jwttoken</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Create JWT with Basic Authent</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Create_JWT_with_Basic_Authent.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Create JWT with Basic Authent</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract REST Request Attributes</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Build JWT Payload</td>
        </tr>
    </table>
    <h3>filter :create sub &amp; login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>create sub &amp; login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${gide.jwt.payload.b64}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Build JWT Payload</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>gide.jwt.payload</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>{
	&quot;iss&quot;:&quot;${env.IDP.ISS}&quot;,
	&quot;iat&quot;:${now},
	&quot;exp&quot;:${expiration.time},
	&quot;sub&quot;:&quot;${jwt.sub}&quot;,
	&quot;urn:cdc:claims:applicationEnv&quot;: &quot;${env.TYPE.ENVIRONNEMENT}&quot;,
	&quot;urn:cdc:claims:user:domaine&quot;: &quot;OPENBANKING&quot;,
	&quot;urn:cdc:banque:in7:openbanking:claims:login&quot; : &quot;${jwt.login}&quot;
}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Build JWT Payload</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Base64 Encode Payload JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.common.base64.Encoder;

def invoke(msg)         
{        
    String data &#x3D; msg.get(&quot;gide.jwt.payload&quot;);
    String base64EncodedData &#x3D; Encoder.encodeNoLineBreaks(data.getBytes());
    msg.put(&quot;gide.jwt.payload.b64&quot;, base64EncodedData);
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Base64 Encode Payload JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp;
	var expirationTime&#x3D;msg.get(&quot;expirationTime&quot;);	

	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration en ms
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - PKCE CONTROL</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_PKCE_CONTROL.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - PKCE CONTROL</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract REST Request Attributes</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Compare code_verifier to code_challenge</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set Error Attributs </td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>DEFAULT - Process Error</td>
        </tr>
    </table>
    <h3>filter :Set Error Attributs </h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Error Attributs </td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Compare code_verifier to code_challenge</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);

function invoke(msg)         
{       
	//On récupère le code_challenge et code_challenge_method dans le cache temporaire de la request authorize
	var codeChallenge &#x3D; msg.get(&quot;codeChallenge&quot;);
	var codeChallengeMethod &#x3D; msg.get(&quot;codeChallengeMethod&quot;);
       var codeVerifier &#x3D; msg.get(&quot;params.query.code_verifier&quot;);
 	Trace.debug(&quot;codeChallenge:&quot;+codeChallenge);
	Trace.debug(&quot;codeChallengeMethod:&quot;+codeChallengeMethod );
	Trace.debug(&quot;codeVerifier :&quot;+codeVerifier  );

	if (codeChallenge !&#x3D; null &amp;&amp; codeChallenge !&#x3D;&#x27;&#x27;) {
		 if ( codeChallengeMethod !&#x3D; null &amp;&amp; codeChallengeMethod.equals(&quot;plain&quot;)  ) {
			  if(  codeVerifier !&#x3D; null &amp;&amp; codeVerifier.equals(codeChallenge) ) { 
				return true ;
	   		  } else {
				return false;
	   		  }	 
		} else {

		      var sha256Digester &#x3D; java.security.MessageDigest.getInstance(&quot;SHA-256&quot;);
	             sha256Digester.update(codeVerifier.getBytes(&quot;ISO_8859_1&quot;));
       	      var digestBytes &#x3D; sha256Digester.digest();
                    var controlCodeChallenge &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(digestBytes);

  		     Trace.debug(&quot;controlCodeChallenge:&quot;+controlCodeChallenge );

			if( controlCodeChallenge.equals(codeChallenge) ) { 
				return true ;
	   		  } else {
				return false;
	   		  }	 
		}
	}
	else{
		// Pas de codeChallenge dans la requete authorize d&#x27;origine
		return true;
	}        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Compare code_verifier to code_challenge</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;DEFAULT - Process Error&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;DEFAULT - Process Error&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request DSP2 -API OB</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_DSP2_-API_OB.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request DSP2 -API OB</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Read API Proxy</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>&#x27;Set Error Attributs</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Presence Certificat</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add aud</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${env.OPENBANKING.AUD}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>aud</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add aud</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add jti</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${id}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>jti</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add jti</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract SPS Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract SPS Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationName</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getName()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Create JWT Token Signed</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.jose.*);
importPackage(Packages.com.vordel.jose.crypto.*);
importPackage(Packages.com.vordel.jose.jwt.*);
importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.com.vordel.common.base64.*);
importPackage(org.apache.commons.codec.binary.*);

function invoke(msg)         
{        
	//Algorithm.HS256
	var headerJWT &#x3D;  &quot;ew0KICAiYWxnIjogIkhTMjU2IiwNCiAgInR5cCI6ICJKV1QiDQp9DQo&#x3D;&quot;;
	var dataJWT &#x3D; msg.get(&quot;jwt.token.backend&quot;);

	//On encode en base64 le payload
	var base64EncodedData &#x3D; com.vordel.common.base64.Encoder.encodeNoLineBreaks(dataJWT.getBytes());

	var data &#x3D;  new java.lang.String ( headerJWT + &quot;.&quot; + base64EncodedData) ;

	//Extraction de la secret key associée au SPS 
	var secretKey &#x3D; new java.lang.String(msg.get(&quot;jwt.secret.key&quot;));
	var secretHmac &#x3D; new com.vordel.jose.crypto.HmacSHA256Signer(secretKey.trim().getBytes());

	var signature &#x3D; secretHmac.sign( data.getBytes());	
	signature &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(signature )

	msg.put(&quot;jwt.token.signed&quot;, data + &quot;.&quot; +signature );

	return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create JWT Token Signed</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationId</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getApplicationID()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.backend</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.backend</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.backend</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Convert Scopes Requested and Obtained to String</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
	
	//Récupération des scopes requis HashSet
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;

	var scopesRequested &#x3D; msg.get(&quot;accesstoken.authn&quot;);
	var authScope &#x3D; new String(scopesRequested.getAuthorizationRequest().getScope());

	msg.put(&quot;scopes.requested.converted&quot;,  authScope.substring(1, authScope.length-1));

	//Récupération des scopes obtenus
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;
	var accessToken &#x3D; msg.get(&quot;accesstoken&quot;);
	var scopesObtained &#x3D; new String(accessToken.getScope());
	
	//Transformation sous la forme d&#x27;un tableau
	msg.put(&quot;scopes.obtained.converted&quot;,  scopesObtained.substring(1, scopesObtained.length-1));

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Convert Scopes Requested and Obtained to String</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode base64 JWT Token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         
{        
    var base64EncodedData &#x3D; msg.get(&quot;jwt.token.b64&quot;);

    Trace.debug(base64EncodedData + &quot;:&quot; + base64EncodedData );
    var dataDecoded &#x3D; Decoder.decodeToString(base64EncodedData);

    //obtention d&#x27;un jeton JWT : uniquement la partie PAYLOAD

    msg.put(&quot;jwt.token&quot;, dataDecoded  );
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode base64 JWT Token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.subject.id with username</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.authn.getUserAuthentication()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.subject.id with username</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Header Authorization</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${jwt.token.signed}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Authorization</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message Tranform JWT Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message Tranform JWT Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwt.token}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeRequested</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.requested.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.b64</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.getAdditionalInformation().get(&quot;jwttoken&quot;)}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.b64</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeObtained</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.obtained.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header // updated</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		Trace.debug(&quot;publicKey :&quot;+ publicKey );
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot;(request-target):&quot;+&quot; &quot;+ method.toLowerCase()+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		
		 var verifSign &#x3D; java.security.Signature.getInstance(&quot;SHA256withRSA&quot;);
         verifSign.initVerify(publicKey);
		 Trace.debug(&quot;verifSign   :&quot;+ verifSign );
		 verifSign.update(dataToSign.getBytes());
		 Trace.debug(&quot;verifSign 2 :&quot;+ verifSign );
		//var signBytes &#x3D; new java.util.ArrayList();
		//var signBytes &#x3D; Base64.getDecoder().decode(signature);
		//Trace.debug(&quot;signBytes   :&quot;+ signBytes );
		//
		//var isCorrect &#x3D; verifSign.verify(Base64.getDecoder().decode(signature));
		//Trace.debug(&quot;isCorrect   :&quot;+ isCorrect );
		
		
		
		/*var kf &#x3D; java.security.KeyFactory.getInstance(&quot;RSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIEogIBAAKCAQEA5S5rhDktEm2FnZZWH4W4nGebpkkGfMT/bR/W01C93n8v6kSSCp7qVNWgW071qkm+QN6wtRqKwF5nvASZYYa+LkrvlaEDyVFhMvfSD1wkYrvv7tBibr49hZJAQbNfQ3pLEe9av+lGsI7SiwbnebdsOAoUkOyMTILN5Lisw9jqzJ4ZpXrzpYppUgrU0P5xLJZpQaicmuVyvq62CqjLaE9SY7P0tWFEdPF+jDN1Qplep8aK3hPwI4aNXcDCO5XVIFk7+MjBNEiskkdi7EQTI/I+K6qaS1sOy4E+8PcOE+Vzj9F5Moz4aPYiQHfk86HUHvQD2p7hzbaZlhTV9sttDqGuSwIDAQABAoIBADlkcpBeMSdYPgnEyDSErEKev5/Y0cMVIlIVkxrAMYwylbE5EsmOGmi8RrgXAfZvGTHtkpsH1o9uFNRE4pRFxgKZyX3TILudoZW98eDe1k3TerZ3gO7yvT1h7q2FWenwCjSnmDZPGODGI3ulcvpMMNGn1JamZkwSxbTtenZhMAulYpAHziAD5vg/9ZqojgpKJ665orOYTt70VHZE9Id/DKX7S//AZKUaeZ5526sNNtcHb7SwKGYQWsDLprpWpvP8Nzp4R2mdkxDN4niHhiNLpMpK4QVZcgEHchhd9myrL/sHEIoT+yUfTPOk4RApzHpKYtnGT7U6ZuZMjZDsClKSyWECgYEA/7ZpJ5NMiF4fvslaBAxg3zOg3EhlcosX0jxXnLEK+phtZFbXISfsTVkntsdRG8NRCuECRYC1SKmIqfxDaw6K3ntMO/5u+madThiYHQzJCpVv/4uiQEhRyEsy/t9RMbI/TsBCuWbxzAmoyq6fXpf6O09ryZYMhRYYdlBW6hx9sScCgYEA5XBfwVenZti7Q4lDFOtr2mdbZgUV1MmIfHEkRyrDf5W+NBq2PmsrhYpXpLLsY4U2EM03JeQBvDtTXji/xQ9yuLrTp48+o0ipl/CnTXWou3MLUi6Oc6EMmWdPJy+QASEIeGubFr83x2mBmVk+KNgqzofv37I8BCRWqLCZpbh4yD0CgYB523SK/n/nMGuSYKO78CYt142dzAZEKpKkhkr+CcSAnSjsOxHz4/GQ/p6VVLCLOW2icI3Dj01Uni3ZS7TZDKoS0dEHef1q6IGoGMJMfa5Ek+g2cFVWquAGQgfAO62WsCnJHoftkGhD4oqEY+jgjC4cG4HzI8U9msT3hNuWXxNq2wKBgFPUSBgzN4W7QEh/uVPGZGSrCNjwmLZjYAvfptqdxEo0YwdUjyulKoSjNDyH5xjBjix7Xl/ou72Ti3VMlLyiVU8ra7O4AbHVFanfErGZgKnkccl4GzIiMKFH/sKZfSr8b8TXxBV+jhm88c4erjhsKs/FGR6JV6ZHxKXjyG+lQ/QdAoGAc6oSp3inDTsFXHdueaA8W76+NPlCs66huaVyIGHNU52YM3ws7OmjpVUl/d1KC/fOU6nk0wsa/4DroX3Cybl03P/fP+6Hmowtl51snQ5z/4d4eU5qI8Knt/JWPUHbXXbkHBNK8U/JcKUlb9VaLDlgHwqtmjyxKb3FZmX61gd/pu8&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );*/

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    var verify &#x3D; sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );	
		Trace.debug(&quot;verify  :&quot;+verify);
		//Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header // updated</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id with app name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id with app name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Do the validation of http-signature ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Do the validation of http-signature ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-TransactionID</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-TransactionID</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${id}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-TransactionID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path Extract Login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path Extract Login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-Login</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-Login</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${Login}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-Login</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT </h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var expirationTime&#x3D; msg.get(&quot;jwt.expirationtime&quot;);
	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 10heures
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT </td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON remove iat exp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON remove iat exp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add exp</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${expiration.time}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add exp</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add iat</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${now}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add iat</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Read API Proxy</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${api.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.apiproxy</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read API Proxy</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Presence Certificat // Test RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Presence Certificat // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :test ELK // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>test ELK // JNV</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header signature // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>signature</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header signature // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header SSL_CLIENT_CERT // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header user_cert  // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>user_cert</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header user_cert  // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes{1}</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes{1}</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header // updated // save</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot; (request-target):&quot;+&quot; &quot;+ method.toLowerCase()+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		var kf &#x3D; java.security.KeyFactory.getInstance(&quot;SHA256withRSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIEogIBAAKCAQEA5S5rhDktEm2FnZZWH4W4nGebpkkGfMT/bR/W01C93n8v6kSSCp7qVNWgW071qkm+QN6wtRqKwF5nvASZYYa+LkrvlaEDyVFhMvfSD1wkYrvv7tBibr49hZJAQbNfQ3pLEe9av+lGsI7SiwbnebdsOAoUkOyMTILN5Lisw9jqzJ4ZpXrzpYppUgrU0P5xLJZpQaicmuVyvq62CqjLaE9SY7P0tWFEdPF+jDN1Qplep8aK3hPwI4aNXcDCO5XVIFk7+MjBNEiskkdi7EQTI/I+K6qaS1sOy4E+8PcOE+Vzj9F5Moz4aPYiQHfk86HUHvQD2p7hzbaZlhTV9sttDqGuSwIDAQABAoIBADlkcpBeMSdYPgnEyDSErEKev5/Y0cMVIlIVkxrAMYwylbE5EsmOGmi8RrgXAfZvGTHtkpsH1o9uFNRE4pRFxgKZyX3TILudoZW98eDe1k3TerZ3gO7yvT1h7q2FWenwCjSnmDZPGODGI3ulcvpMMNGn1JamZkwSxbTtenZhMAulYpAHziAD5vg/9ZqojgpKJ665orOYTt70VHZE9Id/DKX7S//AZKUaeZ5526sNNtcHb7SwKGYQWsDLprpWpvP8Nzp4R2mdkxDN4niHhiNLpMpK4QVZcgEHchhd9myrL/sHEIoT+yUfTPOk4RApzHpKYtnGT7U6ZuZMjZDsClKSyWECgYEA/7ZpJ5NMiF4fvslaBAxg3zOg3EhlcosX0jxXnLEK+phtZFbXISfsTVkntsdRG8NRCuECRYC1SKmIqfxDaw6K3ntMO/5u+madThiYHQzJCpVv/4uiQEhRyEsy/t9RMbI/TsBCuWbxzAmoyq6fXpf6O09ryZYMhRYYdlBW6hx9sScCgYEA5XBfwVenZti7Q4lDFOtr2mdbZgUV1MmIfHEkRyrDf5W+NBq2PmsrhYpXpLLsY4U2EM03JeQBvDtTXji/xQ9yuLrTp48+o0ipl/CnTXWou3MLUi6Oc6EMmWdPJy+QASEIeGubFr83x2mBmVk+KNgqzofv37I8BCRWqLCZpbh4yD0CgYB523SK/n/nMGuSYKO78CYt142dzAZEKpKkhkr+CcSAnSjsOxHz4/GQ/p6VVLCLOW2icI3Dj01Uni3ZS7TZDKoS0dEHef1q6IGoGMJMfa5Ek+g2cFVWquAGQgfAO62WsCnJHoftkGhD4oqEY+jgjC4cG4HzI8U9msT3hNuWXxNq2wKBgFPUSBgzN4W7QEh/uVPGZGSrCNjwmLZjYAvfptqdxEo0YwdUjyulKoSjNDyH5xjBjix7Xl/ou72Ti3VMlLyiVU8ra7O4AbHVFanfErGZgKnkccl4GzIiMKFH/sKZfSr8b8TXxBV+jhm88c4erjhsKs/FGR6JV6ZHxKXjyG+lQ/QdAoGAc6oSp3inDTsFXHdueaA8W76+NPlCs66huaVyIGHNU52YM3ws7OmjpVUl/d1KC/fOU6nk0wsa/4DroX3Cybl03P/fP+6Hmowtl51snQ5z/4d4eU5qI8Knt/JWPUHbXXbkHBNK8U/JcKUlb9VaLDlgHwqtmjyxKb3FZmX61gd/pu8&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    	sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );		

		Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header // updated // save</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Get Scopes</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Get_Scopes.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Get Scopes</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set scopes.for.token</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Set scopes.for.token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
function invoke(msg)         {         
	
  	var scopes &#x3D; msg.get(&quot;scopes&quot;);
	var scopesSplit &#x3D; scopes.split(&quot; &quot;);
	msg.put(&quot;scopes.for.token&quot;, new java.util.HashSet(java.util.Arrays.asList(scopesSplit )));
	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set scopes.for.token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V4 - ListUsers</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V4_-_ListUsers.svg">
    <table>
        <tr>
            <td>start</td>
            <td>HTTP Basic</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V4 - ListUsers</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>repository</td>
            <td></td>
        </tr>
        <tr>
            <td>cacheToUse</td>
            <td></td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://iam.amazonaws.com/</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>
    <h3>filter :HTTP Basic</h3>
    <table>           
            <tr>
                <td>timePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>allowClientRetry</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>removeAuthNHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>HTTP basic authentication failed</td>
            </tr>           
            <tr>
                <td>invalidAttempts</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>credentialFormat</td>
                <td>Username</td>
            </tr>           
            <tr>
                <td>userTimePeriod</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>lockUser</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>lock</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>lockKey</td>
                <td>${http.request.clientaddr}</td>
            </tr>           
            <tr>
                <td>userTimePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>lockTimePeriod</td>
                <td>30</td>
            </tr>           
            <tr>
                <td>userInvalidAttempts</td>
                <td>6</td>
            </tr>           
            <tr>
                <td>lockTimePeriodUnit</td>
                <td>minute</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>HTTP basic authentication success for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>allowRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>timePeriod</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>HTTP Basic</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while authenticating via HTTP Basic. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>1</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V4 - ListGroups</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V4_-_ListGroups.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V4 - ListGroups</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://iam.amazonaws.com/</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V2 - DescribeInstances</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V2_-_DescribeInstances.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V2 - DescribeInstances</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>xpathNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :XML To JSON</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>autoArray</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>XML To JSON</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>autoPrimitive</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>namespaces</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://ec2.amazonaws.com/?Action&#x3D;DescribeInstances</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V2 - DescribeRegions</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V2_-_DescribeRegions.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V2 - DescribeRegions</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://ec2.amazonaws.com/?Action&#x3D;DescribeRegions</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V2 - DescribeInstances - no creds</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V2_-_DescribeInstances_-_no_creds.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V2 - DescribeInstances - no creds</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://ec2.amazonaws.com/?Action&#x3D;DescribeInstances</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : Amazon V4 - ListUsers - wrong signer</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/Amazon_V4_-_ListUsers_-_wrong_signer.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Connect to URL</td>
        </tr>
        <tr>
            <td>name</td>
            <td>Amazon V4 - ListUsers - wrong signer</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td></td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Connect to URL</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>${http.request.verb}</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://iam.amazonaws.com/?Action&#x3D;ListUsers</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Connect to URL</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
    </table>

    <h2>Policy : custom get scopes</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/custom_get_scopes.svg">
    <table>
        <tr>
            <td>name</td>
            <td>custom get scopes</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Scripting Language</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>fault</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Scripting Language</td>
        </tr>
    </table>
    <h3>filter :Scripting Language</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.kps.impl.KPS
import com.vordel.kps.query.KeyQuery;
import com.vordel.kps.ObjectNotFound
import com.vordel.trace.Trace
import com.vordel.circuit.oauth.common.OAuth2Utils
import com.vordel.common.apiserver.discovery.model.OAuthAppScope
import java.util.ArrayList

def invoke(msg) {
    	
    try {
	def clientId &#x3D; msg.get(&quot;params.query.client_id&quot;);
        
       def strScopes &#x3D; msg.get(&quot;params.query.scope&quot;);
       ArrayList requestedScopes &#x3D; null;
       if (strScopes !&#x3D; null){
           requestedScopes &#x3D; strScopes .tokenize(&quot; &quot;);
           Trace.info(&quot; requested scopes: &quot;+ requestedScopes );
       }     
      def app &#x3D; OAuth2Utils.getAppDetailsFromClientId(msg, clientId);
      def oauthScopes &#x3D; app.getDefaultScopes();
      ArrayList defaultScopes &#x3D; new ArrayList();
      oauthScopes.each { scope -&gt;
          defaultScopes.add(scope.getScope());
      }
      defaultScopes.unique();
	Trace.info(&quot; default scopes: &quot;+ defaultScopes);      

	def kpsTable &#x3D; KPS.getInstance().getModel().getAliases().get(&quot;ClientApplicationRegistry&quot;);

	def application&#x3D; kpsTable.getCached(clientId);
      def applicationId &#x3D; application.get(&quot;applicationId&quot;);
       Trace.info(&quot; applicationId   &quot;+ applicationId );  
       def query &#x3D; new KeyQuery(&quot;applicationId&quot;, applicationId );

     def kpsTableRes &#x3D; KPS.getInstance().getModel().getAliases().get(&quot;PortalOAuthResourcesStore&quot;);
	ArrayList scopes&#x3D; new ArrayList();
	def tx &#x3D; kpsTableRes .beginTransaction();
       
      def ressources &#x3D; tx.query(query);
	ressources.each { item -&gt;
            def scope &#x3D;  item.get(&quot;uriprefix&quot;);
		scopes.add(scope);
      } 
      scopes &#x3D; scopes.sort().intersect(defaultScopes.sort());
      Trace.info(&quot; intercept1 scopes: &quot;+ scopes);  
      if (requestedScopes  !&#x3D; null) {
          scopes &#x3D; scopes.sort().intersect(requestedScopes.sort() );
	    Trace.info(&quot;  intercept2 scopes: &quot;+ scopes);  
      }
	
	if( scopes.size() &gt; 0 ) {
	   msg.put(&quot;scopes.for.token&quot;, new java.util.HashSet(scopes));
      }
	Trace.info(&quot; scopes: &quot;+ scopes);               
    } catch(Exception e) {
        Trace.error(e)
        return false
    }
    
    return true
}

</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scripting Language</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : DEFAULT - Process Error</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEFAULT_-_Process_Error.svg">
    <table>
        <tr>
            <td>name</td>
            <td>DEFAULT - Process Error</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Validate Selector Expression</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Message error</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Error 500</td>
        </tr>
    </table>
    <h3>filter :Copy / Modify Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Copy / Modify Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message error</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message error</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
	&quot;error&quot; :  &quot;${error}&quot;,
	&quot;message&quot; : &quot;${message}&quot;,
	&quot;path&quot; : &quot;${path}&quot;,
	&quot;status&quot; : ${status},
	&quot;timestamp&quot; : &quot;${timestamp}&quot;
	
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json; charset&#x3D;utf-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Reflect Message</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>${status}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate Selector Expression</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate Selector Expression</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Error 500</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Error 500</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : dcr</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/dcr.svg">
    <table>
        <tr>
            <td>name</td>
            <td>dcr</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Set Attribute Filter</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Trace Filter</td>
        </tr>
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Scripting Language</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>
import com.vordel.trace.Trace;

def invoke(msg)         
{        

    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Scripting Language</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwtString}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : InsertAPIOpenBanking</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/InsertAPIOpenBanking.svg">
    <table>
        <tr>
            <td>name</td>
            <td>InsertAPIOpenBanking</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Calcul RefreshToken date + 90 jours</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Insert KPS API OpenBanking</td>
        </tr>
    </table>
    <h3>filter :Insert KPS API OpenBanking</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.util.Map;
import com.vordel.trace.Trace;
import com.vordel.kps.impl.KPS;
import com.vordel.mime.JSONBody;
import com.fasterxml.jackson.databind.ObjectMapper;
import groovy.transform.Field;

@Field def mapper &#x3D; new ObjectMapper();
def invoke(msg) 
{ 
def jsonBody &#x3D; msg.get(&quot;content.body&quot;);
if(jsonBody instanceof JSONBody){
	def store &#x3D; KPS.getInstance().getStore(&quot;StoreExpiryDate&quot;); // route -&gt; KPS alias name
	def transaction &#x3D; store.beginTransaction();
	def jsonNode &#x3D; jsonBody.getJSON();
	def map &#x3D; mapper.convertValue(jsonNode, Map.class);
	try{
		transaction.create(map);
	}catch(e){
		Trace.error(&quot;erreur1:&quot;+e);
		try{			
			transaction.update(map);
		}catch(e2){
			Trace.error(&quot;erreur2:&quot;+e2);
			return false;
		}finally{
			transaction.close();
		}
	}
	return true;
}
Trace.error(&quot;jsonBody:&quot;+jsonBody );
return false;
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Insert KPS API OpenBanking</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul RefreshToken date + 90 jours</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 90 jours
	exp &#x3D; now  + 7776000 * 1000;
	
	//Date exprimée en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);;

	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul RefreshToken date + 90 jours</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
    &quot;CodeApplication&quot;:&quot;${oauth.application.id}&quot;,
     &quot;SubjectID&quot;:&quot;${oauth.client.id}&quot;,
     &quot;ExpiryDate&quot;:&quot;${expiration.time}&quot;,
     &quot;StoreExpiryDateID&quot;:&quot;${oauth.application.id}.${oauth.client.id}&quot;
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :TraceFilterJN</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>TraceFilterJN</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request accountsTransactionsGet</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_accountsTransactionsGet.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request accountsTransactionsGet</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start&#x27;{1}</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Call &#x27;ICDC - Process Request DSP2 -Add JWT Header&#x27;</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Lever une erreur 403</td>
        </tr>
    </table>
    <h3>filter :Call &#x27;ICDC - Process Request DSP2 -Add JWT Header&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Process Request DSP2 -Add JWT Header&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start&#x27;{1}</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start&#x27;{1}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Récupérer date expiration</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Récupérer date expiration</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Comparaison de date expiration avec now</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp, diff;
       var ExpiryDate &#x3D; msg.get(&quot;ExpiryDate&quot;);
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
       exp &#x3D; Math.round(exp/1000);

       diff &#x3D; now - exp;

	msg.put(&quot;diff&quot;, diff.toString());

	return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Comparaison de date expiration avec now</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Lever une erreur 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Lever une erreur 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter JN1</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter JN1</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter JN2</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter JN2</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Vérifie si jeton expiré?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>expression</td>
                <td>${diff&gt;0}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Vérifie si jeton expiré?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : InsertAPIOpenBanking</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/InsertAPIOpenBanking.svg">
    <table>
        <tr>
            <td>name</td>
            <td>InsertAPIOpenBanking</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Récupérer durée API</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Set Message</td>
        </tr>
    </table>
    <h3>filter :TraceFilterMessageAInserer</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>TraceFilterMessageAInserer</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
    &quot;CodeApplication&quot;:&quot;${oauth.application.id}&quot;,
     &quot;SubjectID&quot;:&quot;${authentication.subject.id}&quot;,
     &quot;ExpiryDate&quot;:&quot;${expiration.time}&quot;,
     &quot;StoreExpiryDateID&quot;:&quot;${oauth.application.id}.${authentication.subject.id}&quot;
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Insert KPS API OpenBanking</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.util.Map;
import com.vordel.trace.Trace;
import com.vordel.kps.impl.KPS;
import com.vordel.mime.JSONBody;
import com.fasterxml.jackson.databind.ObjectMapper;
import groovy.transform.Field;

@Field def mapper &#x3D; new ObjectMapper();
def invoke(msg) 
{ 
def jsonBody &#x3D; msg.get(&quot;content.body&quot;);
if(jsonBody instanceof JSONBody){
	def store &#x3D; KPS.getInstance().getStore(&quot;StoreExpiryDate&quot;); // route -&gt; KPS alias name
	def transaction &#x3D; store.beginTransaction();
	def jsonNode &#x3D; jsonBody.getJSON();
	def map &#x3D; mapper.convertValue(jsonNode, Map.class);
	try{
		transaction.create(map);
	}catch(e){
		Trace.error(&quot;erreur1:&quot;+e);
		try{			
			transaction.update(map);
		}catch(e2){
			Trace.error(&quot;erreur2:&quot;+e2);
			return false;
		}finally{
			transaction.close();
		}
	}
	return true;
}
Trace.error(&quot;jsonBody:&quot;+jsonBody );
return false;
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Insert KPS API OpenBanking</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Récupérer durée API</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Récupérer durée API</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul RefreshToken date</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var now, exp, duree;
	
       duree &#x3D; msg.get(&quot;expirationTransactionTime&quot;);
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	exp &#x3D; now  + duree * 1000;
	
	//Date exprimée en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);;

	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul RefreshToken date</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request DSP2 - API OB with ExpiryDate Control</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_DSP2_-_API_OB_with_ExpiryDate_Control.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request DSP2 - API OB with ExpiryDate Control</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Restore Original Message</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Do the validation of http-signature ?</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Presence Certificat</td>
        </tr>
    </table>
    <h3>filter :Add X-Login</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-Login</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${Login}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-Login</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path Extract Login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path Extract Login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-TransactionID</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-TransactionID</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${id}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-TransactionID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Do the validation of http-signature ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Do the validation of http-signature ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id with app name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id with app name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot; (request-target):&quot;+&quot; &quot;+ method.toLowerCase()+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		var kf &#x3D; java.security.KeyFactory.getInstance(&quot;RSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIE6TAbBgkqhkiG9w0BBQMwDgQIztF9d+yVDqUCAggABIIEyB+3JnayJNh6dKdiDLTZ2Ehz2RJorymXFK+WgEJ62UhCN/WJF6/84eTRmHDw15c8zhTHyl6ErkBVAd74d/WmTyxfTQKl+t7noZ4lCg2Th9fNoz/ibZ5+EpMI3cxYKUm6h/fXabPBvUC6kORUfcIqzWloyMntHK2ZHjbFAY3my5HU+gpdZsoAxPuk1O7FWvxcuCd3K+/FrnJboEHmy5VWE9tM1rq78gVEkKwriNFeLPI/nZR8QtoEdF/ElqpGVfU+Jx4fIygc03L+x8v4UFzV8SYM1ejNEHwBBsN3ocGlZkuYpAjnZru+5LzHpWQmt3NAk9oI8Z47xCgiHalO1/fuxxgtctN1hC7a0u8JZYQf6lvAXCLo3jgbJzEuV/eprM/fI9m7XT+txqV1MVW1x+nuYEQL7N1Al4GZTt7vDYpqI3eCzlrBWXjQj8ETD7zoI4O88i6mi2VkT3UomNXWXzdQS4E50M+WbrQuQUs470EdTQDOfNbVudWCZ65UQVG5QjQ/aLds6tss4qrKYzywFcDVAGW3qXWm7t7M02boUEGJfC/XO8dSVGrZqLrzjerauWo/p9okTr+Mu8T5u19PaFIWailq28/f27i3GU2uwWzInHY4S1VPk/DV2zhq4OsxpnCOMIwNfiEpnX8PMKUFSu798z6l7ohQYdjZNUoY/4EEnOSYF57GV9L7Vxyy4wfjkTnRrx0hHODNd0H//qBRNDzCGyQLdo7UOh3+UtC4WVIJs5AboSFof6IVI+AtGJ4cQ353KLqCQZtudzqg9iDRwU/0wXor5B7jDqWyU9/zpYlcjg0jJRsZWanr4tof8HDJpIvsC2FP8xVBBMFpk08O4ZVTkeEeeJPBG51mbd9PyEoOeWFgZuGpYvr6loeuJx30dLV6FlPlEYAP0DijJTEywoEw+adQY9aY+zMnVcrrkSGTwl8FQ+8MurISiOsyGee2wNAYT1wxKQ0FgDf+mAvFHfMQG16GVsHlKbf0HRnAhFLpmIciWjImyfxSzl/psqFIDfPqyCEdGKXfx660FtDeagrl/so4VJC+Yejfs35inribkPswq2+qdBHOdiYkwel4bcL8S/lNDE36V8mnhhCdVgPJMs8BZIDVEga95o0avqQAbjVtrnDqCCkBRf7cOiIeS/rcjzn8CtB7w6JNgrFhqRdSeyTfHJGts4ATlAneL4CWRHH4Q+c2CFd6+0X9aiEKiUrULGLJFrfp4A3iXB0UhG7th7hmDKdsJ1g9CJyi/12kbNrJzMLe86LDotybf0C2fM91nVT+nuu+9hTdekUjhmq+1v5qyP8kAk9hAyMdpcvp1i2OqBg9BCp+ewos85MB6MnueGSeYqsna9oJJNc58RidEnoAvOnnlOQ/RlBym/IDVzQrG3ArSuL8LS9DnhrvfRmD1fLZ5kU90dbyVyrBP4I0cbHdRID7qZAKGgfaNpG7O7ohK1kNw2inmnq/ZNDw/K9tbZ3ZcrFqJi6bQvE0t9Yu9NWSZE791l4M6tUDLRdz3ll/d8DNx0MPXedC5aj1BA6Hg5iGRGsRXkXSxTLHV6hae9VRTGy+1OEcg3dVXcnp0Ommm/R9x8yzc1Qk8mo/ZvZRPYLeaNZ5x92taIt6M4DSqrhj05lRgW4hWA&#x3D;&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    	sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );		

		Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeObtained</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.obtained.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.b64</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.getAdditionalInformation().get(&quot;jwttoken&quot;)}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.b64</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeRequested</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.requested.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Message Tranform JWT Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message Tranform JWT Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwt.token}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Header Authorization</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${jwt.token.signed}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Authorization</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.subject.id with username</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.authn.getUserAuthentication()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.subject.id with username</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode base64 JWT Token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         
{        
    var base64EncodedData &#x3D; msg.get(&quot;jwt.token.b64&quot;);

    Trace.debug(base64EncodedData + &quot;:&quot; + base64EncodedData );
    var dataDecoded &#x3D; Decoder.decodeToString(base64EncodedData);

    //obtention d&#x27;un jeton JWT : uniquement la partie PAYLOAD

    msg.put(&quot;jwt.token&quot;, dataDecoded  );
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode base64 JWT Token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Convert Scopes Requested and Obtained to String</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
	
	//Récupération des scopes requis HashSet
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;

	var scopesRequested &#x3D; msg.get(&quot;accesstoken.authn&quot;);
	var authScope &#x3D; new String(scopesRequested.getAuthorizationRequest().getScope());

	msg.put(&quot;scopes.requested.converted&quot;,  authScope.substring(1, authScope.length-1));

	//Récupération des scopes obtenus
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;
	var accessToken &#x3D; msg.get(&quot;accesstoken&quot;);
	var scopesObtained &#x3D; new String(accessToken.getScope());
	
	//Transformation sous la forme d&#x27;un tableau
	msg.put(&quot;scopes.obtained.converted&quot;,  scopesObtained.substring(1, scopesObtained.length-1));

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Convert Scopes Requested and Obtained to String</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.backend</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.backend</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.backend</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationId</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getApplicationID()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Create JWT Token Signed</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.jose.*);
importPackage(Packages.com.vordel.jose.crypto.*);
importPackage(Packages.com.vordel.jose.jwt.*);
importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.com.vordel.common.base64.*);
importPackage(org.apache.commons.codec.binary.*);

function invoke(msg)         
{        
	//Algorithm.HS256
	var headerJWT &#x3D;  &quot;ew0KICAiYWxnIjogIkhTMjU2IiwNCiAgInR5cCI6ICJKV1QiDQp9DQo&#x3D;&quot;;
	var dataJWT &#x3D; msg.get(&quot;jwt.token.backend&quot;);

	//On encode en base64 le payload
	var base64EncodedData &#x3D; com.vordel.common.base64.Encoder.encodeNoLineBreaks(dataJWT.getBytes());

	var data &#x3D;  new java.lang.String ( headerJWT + &quot;.&quot; + base64EncodedData) ;

	//Extraction de la secret key associée au SPS 
	var secretKey &#x3D; new java.lang.String(msg.get(&quot;jwt.secret.key&quot;));
	var secretHmac &#x3D; new com.vordel.jose.crypto.HmacSHA256Signer(secretKey.trim().getBytes());

	var signature &#x3D; secretHmac.sign( data.getBytes());	
	signature &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(signature )

	msg.put(&quot;jwt.token.signed&quot;, data + &quot;.&quot; +signature );

	return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create JWT Token Signed</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationName</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getName()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Get Jwt Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Get Jwt Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add jti</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${id}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>jti</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add jti</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add aud</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${env.OPENBANKING.AUD}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>aud</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add aud</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Recuperer date expiration</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Recuperer date expiration</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter Date Expiration</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter Date Expiration</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Comparaison de date expiration avec now</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);

function invoke(msg)         {            
      
	var now, nowsec, diff;
       var ExpiryDate &#x3D; msg.get(&quot;ExpiryDate&quot;);
	Trace.debug(&quot;ExpiryDate:&quot;+ExpiryDate);
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
       nowsec &#x3D; Math.round(now/1000);
       Trace.debug(&quot;nowsec :&quot;+nowsec );
       diff &#x3D; ExpiryDate - nowsec;
	Trace.debug(&quot;diff  :&quot;+diff );
	msg.put(&quot;diff&quot;, diff.toString());

	return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Comparaison de date expiration avec now</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Verifie si jeton expire?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>expression</td>
                <td>${diff&gt;0}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verifie si jeton expire?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Lever une erreur 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Lever une erreur 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :invalid_token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>invalid_token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.application.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.application.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.application.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var expirationTime&#x3D; msg.get(&quot;jwt.expirationtime&quot;);
	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 10heures
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON remove iat exp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON remove iat exp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add iat</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${now}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add iat</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add exp</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${expiration.time}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add exp</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Read API Proxy</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${api.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.apiproxy</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read API Proxy</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Presence Certificat // Test RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Presence Certificat // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :test ELK // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>test ELK // JNV</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header signature // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>signature</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header signature // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header SSL_CLIENT_CERT // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header user_cert  // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>user_cert</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header user_cert  // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : DEFAULT - Process Error</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/DEFAULT_-_Process_Error.svg">
    <table>
        <tr>
            <td>name</td>
            <td>DEFAULT - Process Error</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Remove HTTP Header</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Initialisation des attributs</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Initialisation des attributs</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique End</td>
        </tr>
    </table>
    <h3>filter :Error &#x3D; 500</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Error &#x3D; 500</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate http reponse status est renseigné?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate http reponse status est renseigné?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Reflect Message</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>${status}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully echoed back the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to echo back the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Reflect Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while echoing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message error</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message error</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>{
	&quot;error&quot; :  &quot;${error}&quot;,
	&quot;message&quot; : &quot;${message}&quot;,
	&quot;path&quot; : &quot;${path}&quot;,
	&quot;status&quot; : ${status},
	&quot;timestamp&quot; : &quot;${dateNow}&quot;
	
}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json; charset&#x3D;utf-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique End{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>FILTER</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique End{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate http response info &#x3D;&gt; est renseigné? </h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate http response info &#x3D;&gt; est renseigné? </td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :error &#x3D; Not Found</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>error &#x3D; Not Found</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate Failure Reason &#x3D;&gt; failure reason contient &#x27;No Match For Request&#x27;?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate Failure Reason &#x3D;&gt; failure reason contient &#x27;No Match For Request&#x27;?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialisation des attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialisation des attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate http.response.info &#x3D;&gt; http.response.info contient &#x27;Unauthorized&#x27;?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate http.response.info &#x3D;&gt; http.response.info contient &#x27;Unauthorized&#x27;?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :error &#x3D; invalid_token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>error &#x3D; invalid_token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :error &#x3D; Bad request</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>error &#x3D; Bad request</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Validate http.response.info contient &#x27;Bad Request&#x27;?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Message attribute content check passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Message attribute content check failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Validate http.response.info contient &#x27;Bad Request&#x27;?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while content checking message attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter ://Date now</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.text.SimpleDateFormat;
import com.vordel.trace.Trace

def invoke(msg) {
try {
def now &#x3D; new Date();
nowFormat &#x3D; now.format(&quot;YYYY-MM-dd&#x27;T&#x27;HH:mm:ss&quot;);
msg.put(&quot;dateNow&quot;,nowFormat);
return true

     }
catch(Exception e) {
        Trace.error(e)	
        return false
    }

}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>//Date now</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Access Token Service Redirect</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Access_Token_Service_Redirect.svg">
    <table>
        <tr>
            <td>start</td>
            <td>set Audit Attribut</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Access Token Service Redirect</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Extract Certificate Attributes</td>
        </tr>
        <tr>
            <td>retryHTTPRanges</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>sslUsers</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>proxyServer</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>profile</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>connectionFailurePolicy</td>
            <td>-1</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Find Certificate from X-USER-CERT</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call IDP Post Token</h3>
    <table>           
            <tr>
                <td>sendReceivedContentHeaders</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>retryLatency</td>
                <td>500</td>
            </tr>           
            <tr>
                <td>stickyCookieName</td>
                <td>unnamed</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>slaBreachAsFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>protoHeaders</td>
                <td>${http.headers}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to route request to endpoint.</td>
            </tr>           
            <tr>
                <td>runPolicyOnConnectionFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyness</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>ciphers</td>
                <td>DEFAULT</td>
            </tr>           
            <tr>
                <td>forwardClientHostHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>useRootCerts</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>transparentProxy</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>stickyCookiePath</td>
                <td></td>
            </tr>           
            <tr>
                <td>method</td>
                <td>POST</td>
            </tr>           
            <tr>
                <td>stickyCookieDomain</td>
                <td></td>
            </tr>           
            <tr>
                <td>retryCount</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>handleRedirects</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>stickyCookieExpiry</td>
                <td>600000</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>https://idp-openbanking-int.serv.cdc.fr/oauth/token</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Successfully routed request to endpoint</td>
            </tr>           
            <tr>
                <td>performRetries</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call IDP Post Token</td>
            </tr>           
            <tr>
                <td>saveTransactionOnFailure</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while routing request to endpoint. Error: ${circuit.exception}</td>
            </tr>           
            <tr>
                <td>sendProxyMode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>caCerts</td>
                <td></td>
            </tr>           
    </table>
    <h3>filter :HTTP Redirect</h3>
    <table>           
            <tr>
                <td>httpResponseStatus</td>
                <td>302</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>HTTP Redirect</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>text/html</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
            <tr>
                <td>url</td>
                <td>${http.request.uri}</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${content.body}</td>
            </tr>           
    </table>
    <h3>filter :Set Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>grant_type&#x3D;${params.query.grant_type}&amp;client_id&#x3D;${client_id}&amp;redirect_uri&#x3D;${params.query.redirect_uri}&amp;state&#x3D;${params.query.state}&amp;code&#x3D;${params.query.code}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/x-www-form-urlencoded; charset&#x3D;UTF-8</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :set Audit Attribut</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>set Audit Attribut</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate from X-USER-CERT</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td>X-USER-CERT</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate from X-USER-CERT</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :add client_id , scopes to http.request.uri</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.java.net);

function invoke(msg)         {            

	var scopes &#x3D;  msg.get(&quot;scopes&quot;);

	scopes &#x3D; java.net.URLEncoder.encode(scopes  ,&quot;UTF-8&quot;)
	msg.put(&quot;scopes&quot;,   scopes);
	return true;
 }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>add client_id , scopes to http.request.uri</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Client_id &amp; scopes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Client_id &amp; scopes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate from Certificate Store</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate from Certificate Store</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request DSP2 -API Spe</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_DSP2_-API_Spe.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request DSP2 -API Spe</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set Attribute authentication.subject.id with app name</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
    </table>
    <h3>filter :Read API Proxy</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${api.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.apiproxy</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read API Proxy</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add iat</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${now}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add iat</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add exp</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${expiration.time}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add exp</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON remove iat exp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON remove iat exp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT </h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var expirationTime&#x3D; msg.get(&quot;jwt.expirationtime&quot;);
	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 10heures
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT </td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add X-Login</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-Login</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${Login}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-Login</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path Extract Login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path Extract Login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-TransactionID</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-TransactionID</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${id}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-TransactionID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Do the validation of http-signature ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Do the validation of http-signature ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id with app name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id with app name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot; (request-target):&quot;+&quot; &quot;+ method+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		var kf &#x3D; java.security.KeyFactory.getInstance(&quot;RSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIE6TAbBgkqhkiG9w0BBQMwDgQIztF9d+yVDqUCAggABIIEyB+3JnayJNh6dKdiDLTZ2Ehz2RJorymXFK+WgEJ62UhCN/WJF6/84eTRmHDw15c8zhTHyl6ErkBVAd74d/WmTyxfTQKl+t7noZ4lCg2Th9fNoz/ibZ5+EpMI3cxYKUm6h/fXabPBvUC6kORUfcIqzWloyMntHK2ZHjbFAY3my5HU+gpdZsoAxPuk1O7FWvxcuCd3K+/FrnJboEHmy5VWE9tM1rq78gVEkKwriNFeLPI/nZR8QtoEdF/ElqpGVfU+Jx4fIygc03L+x8v4UFzV8SYM1ejNEHwBBsN3ocGlZkuYpAjnZru+5LzHpWQmt3NAk9oI8Z47xCgiHalO1/fuxxgtctN1hC7a0u8JZYQf6lvAXCLo3jgbJzEuV/eprM/fI9m7XT+txqV1MVW1x+nuYEQL7N1Al4GZTt7vDYpqI3eCzlrBWXjQj8ETD7zoI4O88i6mi2VkT3UomNXWXzdQS4E50M+WbrQuQUs470EdTQDOfNbVudWCZ65UQVG5QjQ/aLds6tss4qrKYzywFcDVAGW3qXWm7t7M02boUEGJfC/XO8dSVGrZqLrzjerauWo/p9okTr+Mu8T5u19PaFIWailq28/f27i3GU2uwWzInHY4S1VPk/DV2zhq4OsxpnCOMIwNfiEpnX8PMKUFSu798z6l7ohQYdjZNUoY/4EEnOSYF57GV9L7Vxyy4wfjkTnRrx0hHODNd0H//qBRNDzCGyQLdo7UOh3+UtC4WVIJs5AboSFof6IVI+AtGJ4cQ353KLqCQZtudzqg9iDRwU/0wXor5B7jDqWyU9/zpYlcjg0jJRsZWanr4tof8HDJpIvsC2FP8xVBBMFpk08O4ZVTkeEeeJPBG51mbd9PyEoOeWFgZuGpYvr6loeuJx30dLV6FlPlEYAP0DijJTEywoEw+adQY9aY+zMnVcrrkSGTwl8FQ+8MurISiOsyGee2wNAYT1wxKQ0FgDf+mAvFHfMQG16GVsHlKbf0HRnAhFLpmIciWjImyfxSzl/psqFIDfPqyCEdGKXfx660FtDeagrl/so4VJC+Yejfs35inribkPswq2+qdBHOdiYkwel4bcL8S/lNDE36V8mnhhCdVgPJMs8BZIDVEga95o0avqQAbjVtrnDqCCkBRf7cOiIeS/rcjzn8CtB7w6JNgrFhqRdSeyTfHJGts4ATlAneL4CWRHH4Q+c2CFd6+0X9aiEKiUrULGLJFrfp4A3iXB0UhG7th7hmDKdsJ1g9CJyi/12kbNrJzMLe86LDotybf0C2fM91nVT+nuu+9hTdekUjhmq+1v5qyP8kAk9hAyMdpcvp1i2OqBg9BCp+ewos85MB6MnueGSeYqsna9oJJNc58RidEnoAvOnnlOQ/RlBym/IDVzQrG3ArSuL8LS9DnhrvfRmD1fLZ5kU90dbyVyrBP4I0cbHdRID7qZAKGgfaNpG7O7ohK1kNw2inmnq/ZNDw/K9tbZ3ZcrFqJi6bQvE0t9Yu9NWSZE791l4M6tUDLRdz3ll/d8DNx0MPXedC5aj1BA6Hg5iGRGsRXkXSxTLHV6hae9VRTGy+1OEcg3dVXcnp0Ommm/R9x8yzc1Qk8mo/ZvZRPYLeaNZ5x92taIt6M4DSqrhj05lRgW4hWA&#x3D;&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    	sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );		

		Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeObtained</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.obtained.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.b64</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.getAdditionalInformation().get(&quot;jwttoken&quot;)}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.b64</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeRequested</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.requested.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Message Tranform JWT Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message Tranform JWT Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwt.token}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Header Authorization</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${jwt.token.signed}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Authorization</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.subject.id with username</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.authn.getUserAuthentication()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.subject.id with username</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode base64 JWT Token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         
{        
    var base64EncodedData &#x3D; msg.get(&quot;jwt.token.b64&quot;);

    Trace.debug(base64EncodedData + &quot;:&quot; + base64EncodedData );
    var dataDecoded &#x3D; Decoder.decodeToString(base64EncodedData);

    //obtention d&#x27;un jeton JWT : uniquement la partie PAYLOAD

    msg.put(&quot;jwt.token&quot;, dataDecoded  );
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode base64 JWT Token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Convert Scopes Requested and Obtained to String</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
	
	//Récupération des scopes requis HashSet
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;

	var scopesRequested &#x3D; msg.get(&quot;accesstoken.authn&quot;);
	var authScope &#x3D; new String(scopesRequested.getAuthorizationRequest().getScope());

	msg.put(&quot;scopes.requested.converted&quot;,  authScope.substring(1, authScope.length-1));

	//Récupération des scopes obtenus
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;
	var accessToken &#x3D; msg.get(&quot;accesstoken&quot;);
	var scopesObtained &#x3D; new String(accessToken.getScope());
	
	//Transformation sous la forme d&#x27;un tableau
	msg.put(&quot;scopes.obtained.converted&quot;,  scopesObtained.substring(1, scopesObtained.length-1));

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Convert Scopes Requested and Obtained to String</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.backend</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.backend</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.backend</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationId</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getApplicationID()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Create JWT Token Signed</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.jose.*);
importPackage(Packages.com.vordel.jose.crypto.*);
importPackage(Packages.com.vordel.jose.jwt.*);
importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.com.vordel.common.base64.*);
importPackage(org.apache.commons.codec.binary.*);

function invoke(msg)         
{        
	//Algorithm.HS256
	var headerJWT &#x3D;  &quot;ew0KICAiYWxnIjogIkhTMjU2IiwNCiAgInR5cCI6ICJKV1QiDQp9DQo&#x3D;&quot;;
	var dataJWT &#x3D; msg.get(&quot;jwt.token.backend&quot;);

	//On encode en base64 le payload
	var base64EncodedData &#x3D; com.vordel.common.base64.Encoder.encodeNoLineBreaks(dataJWT.getBytes());

	var data &#x3D;  new java.lang.String ( headerJWT + &quot;.&quot; + base64EncodedData) ;

	//Extraction de la secret key associée au SPS 
	var secretKey &#x3D; new java.lang.String(msg.get(&quot;jwt.secret.key&quot;));
	var secretHmac &#x3D; new com.vordel.jose.crypto.HmacSHA256Signer(secretKey.trim().getBytes());

	var signature &#x3D; secretHmac.sign( data.getBytes());	
	signature &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(signature )

	msg.put(&quot;jwt.token.signed&quot;, data + &quot;.&quot; +signature );

	return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create JWT Token Signed</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationName</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getName()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract SPS Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract SPS Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add jti</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${id}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>jti</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add jti</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add aud</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${env.OPENBANKING.AUD}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>aud</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add aud</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :test ELK // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>test ELK // JNV</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header signature // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>signature</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header signature // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header SSL_CLIENT_CERT // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header user_cert  // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>user_cert</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header user_cert  // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request DSP2 -Add JWT Header</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_DSP2_-Add_JWT_Header.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request DSP2 -Add JWT Header</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Set Attribute authentication.subject.id with app name</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
    </table>
    <h3>filter :Gestion Certificat?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Read API Proxy</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${api.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.apiproxy</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read API Proxy</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add iat</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${now}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add iat</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add exp</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${expiration.time}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add exp</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON remove iat exp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON remove iat exp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT </h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var expirationTime&#x3D; msg.get(&quot;jwt.expirationtime&quot;);
	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 10heures
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT </td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add X-Login</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-Login</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${Login}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-Login</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path Extract Login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path Extract Login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-TransactionID</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-TransactionID</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${id}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-TransactionID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Do the validation of http-signature ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Do the validation of http-signature ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id with app name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id with app name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot; (request-target):&quot;+&quot; &quot;+ method+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		var kf &#x3D; java.security.KeyFactory.getInstance(&quot;RSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIE6TAbBgkqhkiG9w0BBQMwDgQIztF9d+yVDqUCAggABIIEyB+3JnayJNh6dKdiDLTZ2Ehz2RJorymXFK+WgEJ62UhCN/WJF6/84eTRmHDw15c8zhTHyl6ErkBVAd74d/WmTyxfTQKl+t7noZ4lCg2Th9fNoz/ibZ5+EpMI3cxYKUm6h/fXabPBvUC6kORUfcIqzWloyMntHK2ZHjbFAY3my5HU+gpdZsoAxPuk1O7FWvxcuCd3K+/FrnJboEHmy5VWE9tM1rq78gVEkKwriNFeLPI/nZR8QtoEdF/ElqpGVfU+Jx4fIygc03L+x8v4UFzV8SYM1ejNEHwBBsN3ocGlZkuYpAjnZru+5LzHpWQmt3NAk9oI8Z47xCgiHalO1/fuxxgtctN1hC7a0u8JZYQf6lvAXCLo3jgbJzEuV/eprM/fI9m7XT+txqV1MVW1x+nuYEQL7N1Al4GZTt7vDYpqI3eCzlrBWXjQj8ETD7zoI4O88i6mi2VkT3UomNXWXzdQS4E50M+WbrQuQUs470EdTQDOfNbVudWCZ65UQVG5QjQ/aLds6tss4qrKYzywFcDVAGW3qXWm7t7M02boUEGJfC/XO8dSVGrZqLrzjerauWo/p9okTr+Mu8T5u19PaFIWailq28/f27i3GU2uwWzInHY4S1VPk/DV2zhq4OsxpnCOMIwNfiEpnX8PMKUFSu798z6l7ohQYdjZNUoY/4EEnOSYF57GV9L7Vxyy4wfjkTnRrx0hHODNd0H//qBRNDzCGyQLdo7UOh3+UtC4WVIJs5AboSFof6IVI+AtGJ4cQ353KLqCQZtudzqg9iDRwU/0wXor5B7jDqWyU9/zpYlcjg0jJRsZWanr4tof8HDJpIvsC2FP8xVBBMFpk08O4ZVTkeEeeJPBG51mbd9PyEoOeWFgZuGpYvr6loeuJx30dLV6FlPlEYAP0DijJTEywoEw+adQY9aY+zMnVcrrkSGTwl8FQ+8MurISiOsyGee2wNAYT1wxKQ0FgDf+mAvFHfMQG16GVsHlKbf0HRnAhFLpmIciWjImyfxSzl/psqFIDfPqyCEdGKXfx660FtDeagrl/so4VJC+Yejfs35inribkPswq2+qdBHOdiYkwel4bcL8S/lNDE36V8mnhhCdVgPJMs8BZIDVEga95o0avqQAbjVtrnDqCCkBRf7cOiIeS/rcjzn8CtB7w6JNgrFhqRdSeyTfHJGts4ATlAneL4CWRHH4Q+c2CFd6+0X9aiEKiUrULGLJFrfp4A3iXB0UhG7th7hmDKdsJ1g9CJyi/12kbNrJzMLe86LDotybf0C2fM91nVT+nuu+9hTdekUjhmq+1v5qyP8kAk9hAyMdpcvp1i2OqBg9BCp+ewos85MB6MnueGSeYqsna9oJJNc58RidEnoAvOnnlOQ/RlBym/IDVzQrG3ArSuL8LS9DnhrvfRmD1fLZ5kU90dbyVyrBP4I0cbHdRID7qZAKGgfaNpG7O7ohK1kNw2inmnq/ZNDw/K9tbZ3ZcrFqJi6bQvE0t9Yu9NWSZE791l4M6tUDLRdz3ll/d8DNx0MPXedC5aj1BA6Hg5iGRGsRXkXSxTLHV6hae9VRTGy+1OEcg3dVXcnp0Ommm/R9x8yzc1Qk8mo/ZvZRPYLeaNZ5x92taIt6M4DSqrhj05lRgW4hWA&#x3D;&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    	sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );		

		Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeObtained</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.obtained.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.b64</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.getAdditionalInformation().get(&quot;jwttoken&quot;)}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.b64</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeRequested</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.requested.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Message Tranform JWT Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message Tranform JWT Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwt.token}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Header Authorization</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${jwt.token.signed}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Authorization</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.subject.id with username</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.authn.getUserAuthentication()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.subject.id with username</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode base64 JWT Token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         
{        
    var base64EncodedData &#x3D; msg.get(&quot;jwt.token.b64&quot;);

    Trace.debug(base64EncodedData + &quot;:&quot; + base64EncodedData );
    var dataDecoded &#x3D; Decoder.decodeToString(base64EncodedData);

    //obtention d&#x27;un jeton JWT : uniquement la partie PAYLOAD

    msg.put(&quot;jwt.token&quot;, dataDecoded  );
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode base64 JWT Token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Convert Scopes Requested and Obtained to String</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
	
	//Récupération des scopes requis HashSet
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;

	var scopesRequested &#x3D; msg.get(&quot;accesstoken.authn&quot;);
	var authScope &#x3D; new String(scopesRequested.getAuthorizationRequest().getScope());

	msg.put(&quot;scopes.requested.converted&quot;,  authScope.substring(1, authScope.length-1));

	//Récupération des scopes obtenus
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;
	var accessToken &#x3D; msg.get(&quot;accesstoken&quot;);
	var scopesObtained &#x3D; new String(accessToken.getScope());
	
	//Transformation sous la forme d&#x27;un tableau
	msg.put(&quot;scopes.obtained.converted&quot;,  scopesObtained.substring(1, scopesObtained.length-1));

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Convert Scopes Requested and Obtained to String</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.backend</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.backend</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.backend</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationId</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getApplicationID()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Create JWT Token Signed</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.jose.*);
importPackage(Packages.com.vordel.jose.crypto.*);
importPackage(Packages.com.vordel.jose.jwt.*);
importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.com.vordel.common.base64.*);
importPackage(org.apache.commons.codec.binary.*);

function invoke(msg)         
{        
	//Algorithm.HS256
	var headerJWT &#x3D;  &quot;ew0KICAiYWxnIjogIkhTMjU2IiwNCiAgInR5cCI6ICJKV1QiDQp9DQo&#x3D;&quot;;
	var dataJWT &#x3D; msg.get(&quot;jwt.token.backend&quot;);

	//On encode en base64 le payload
	var base64EncodedData &#x3D; com.vordel.common.base64.Encoder.encodeNoLineBreaks(dataJWT.getBytes());

	var data &#x3D;  new java.lang.String ( headerJWT + &quot;.&quot; + base64EncodedData) ;

	//Extraction de la secret key associée au SPS 
	var secretKey &#x3D; new java.lang.String(msg.get(&quot;jwt.secret.key&quot;));
	var secretHmac &#x3D; new com.vordel.jose.crypto.HmacSHA256Signer(secretKey.trim().getBytes());

	var signature &#x3D; secretHmac.sign( data.getBytes());	
	signature &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(signature )

	msg.put(&quot;jwt.token.signed&quot;, data + &quot;.&quot; +signature );

	return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create JWT Token Signed</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationName</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getName()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract SPS Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract SPS Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add jti</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${id}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>jti</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add jti</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add aud</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${env.OPENBANKING.AUD}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>aud</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add aud</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header SSL_CLIENT_CERT // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header signature // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>signature</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header signature // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header user_cert  // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>user_cert</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header user_cert  // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Presence Certificat</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Presence_Certificat.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Presence Certificat</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract REST Request Attributes</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>attribute</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Verification présence header HTTP //Test RECO</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>// Erreur 401 - pas de certificat</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td>-1</td>
        </tr>
    </table>
    <h3>filter :Verification présence header HTTP //Test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verification présence header HTTP //Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :String Replace // Test RECO</h3>
    <table>           
            <tr>
                <td>regexMatchString</td>
                <td></td>
            </tr>           
            <tr>
                <td>destAttributeOverride</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>replacementString</td>
                <td></td>
            </tr>           
            <tr>
                <td>straightMatchString</td>
                <td>-----BEGIN CERTIFICATE-----</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>matchBehaviour</td>
                <td>MATCH_FIRST</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>destAttribute</td>
                <td>http.header.SSL_CLIENT_CERT_modif</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>String Replace // Test RECO</td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>http.header.SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>matchMode</td>
                <td>STRAIGHT_REPLACE</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate from SSL_CLIENT_CERT_modif // Test RECO</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td>${http.header.SSL_CLIENT_CERT_modif}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate from SSL_CLIENT_CERT_modif // Test RECO</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Présence Certificat? // Test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Présence Certificat? // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :// Erreur 401 - pas de certificat</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Erreur 401 - pas de certificat</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :// Pas de Certificat</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Pas de Certificat</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>

    <h2>Policy : ICDC - Process Request with ExpiryDate Control</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_-_Process_Request_with_ExpiryDate_Control.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC - Process Request with ExpiryDate Control</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Remove HTTP Header signature // JNV</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Read API Proxy</td>
        </tr>
        <tr>
            <td>certFromStore</td>
            <td></td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC - Trace Technique Start</td>
        </tr>
    </table>
    <h3>filter :// Pas de Certificat</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Pas de Certificat</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :// Erreur 401</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Erreur 401</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Presence Certificat ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Presence Certificat ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate from SSL_CLIENT_CERT_modif</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td>${http.header.SSL_CLIENT_CERT_modif}</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate from SSL_CLIENT_CERT_modif</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :String Replace</h3>
    <table>           
            <tr>
                <td>regexMatchString</td>
                <td>-----BEGIN CERTIFICATE-----</td>
            </tr>           
            <tr>
                <td>destAttributeOverride</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>replacementString</td>
                <td></td>
            </tr>           
            <tr>
                <td>straightMatchString</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>matchBehaviour</td>
                <td>MATCH_FIRST</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>destAttribute</td>
                <td>http.header.SSL_CLIENT_CERT_modif</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>String Replace</td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>http.header.SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>matchMode</td>
                <td>REGEX_REPLACE</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Extract REST Request Attributes</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>decode</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>queryAttributePrefix</td>
                <td>params.query</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract REST Request Attributes</td>
            </tr>           
            <tr>
                <td>useHeaders</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>useQueryString</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Read API Proxy</h3>
    <table>           
            <tr>
                <td>idSelector</td>
                <td>${api.id}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>targetAttribute</td>
                <td>apimgmt.apiproxy</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Read API Proxy</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add exp</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${expiration.time}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>exp</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add exp</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add iat</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>${now}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add iat</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON remove iat exp</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>node</td>
                <td>iat</td>
            </tr>           
            <tr>
                <td>savedDeletedNodes</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON remove iat exp</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>failOnError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Calcul delai expiration jeton JWT</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            

	var expirationTime&#x3D; msg.get(&quot;jwt.expirationtime&quot;);
	var now, exp;
	
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
	// Expiration dans 10heures
	exp &#x3D; now  + expirationTime * 1000;
	
	//JWT : date exprimé en secondes et non en millisecondes
	exp &#x3D; Math.round(exp/1000);
	now &#x3D; Math.round(now /1000);

	msg.put(&quot;now&quot;, now.toString());
	msg.put(&quot;expiration.time&quot;, exp.toString());

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Calcul delai expiration jeton JWT</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.application.id</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.application.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.application.id</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :invalid_token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>invalid_token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Lever une erreur 403</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Lever une erreur 403</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Verifie si jeton expire?</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>expression</td>
                <td>${diff&gt;0}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Verifie si jeton expire?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Comparaison de date expiration avec now</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);

function invoke(msg)         {            
      
	var now, nowsec, diff;
       var ExpiryDate &#x3D; msg.get(&quot;ExpiryDate&quot;);
	Trace.debug(&quot;ExpiryDate:&quot;+ExpiryDate);
	now &#x3D; new Date();	
	now &#x3D;  now.getTime() ;
       nowsec &#x3D; Math.round(now/1000);
       Trace.debug(&quot;nowsec :&quot;+nowsec );
       diff &#x3D; ExpiryDate - nowsec;
	Trace.debug(&quot;diff  :&quot;+diff );
	msg.put(&quot;diff&quot;, diff.toString());

	return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Comparaison de date expiration avec now</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter Date Expiration</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter Date Expiration</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Recuperer date expiration</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Recuperer date expiration</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter{1}</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter{1}</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add aud</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${env.OPENBANKING.AUD}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>aud</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add aud</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :JSON Add jti</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${id}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>jti</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add jti</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Get Jwt Config</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Get Jwt Config</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationName</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getName()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationName</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Create JWT Token Signed</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.jose.*);
importPackage(Packages.com.vordel.jose.crypto.*);
importPackage(Packages.com.vordel.jose.jwt.*);
importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(Packages.com.vordel.common.base64.*);
importPackage(org.apache.commons.codec.binary.*);

function invoke(msg)         
{        
	//Algorithm.HS256
	var headerJWT &#x3D;  &quot;ew0KICAiYWxnIjogIkhTMjU2IiwNCiAgInR5cCI6ICJKV1QiDQp9DQo&#x3D;&quot;;
	var dataJWT &#x3D; msg.get(&quot;jwt.token.backend&quot;);

	//On encode en base64 le payload
	var base64EncodedData &#x3D; com.vordel.common.base64.Encoder.encodeNoLineBreaks(dataJWT.getBytes());

	var data &#x3D;  new java.lang.String ( headerJWT + &quot;.&quot; + base64EncodedData) ;

	//Extraction de la secret key associée au SPS 
	var secretKey &#x3D; new java.lang.String(msg.get(&quot;jwt.secret.key&quot;));
	var secretHmac &#x3D; new com.vordel.jose.crypto.HmacSHA256Signer(secretKey.trim().getBytes());

	var signature &#x3D; secretHmac.sign( data.getBytes());	
	signature &#x3D; org.apache.commons.codec.binary.Base64.encodeBase64URLSafeString(signature )

	msg.put(&quot;jwt.token.signed&quot;, data + &quot;.&quot; +signature );

	return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Create JWT Token Signed</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:applicationId</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${oauth.client.details.getApplicationID()}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:applicationId</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.backend</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.backend</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.backend</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Convert Scopes Requested and Obtained to String</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>function invoke(msg)         {            
	
	//Récupération des scopes requis HashSet
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;

	var scopesRequested &#x3D; msg.get(&quot;accesstoken.authn&quot;);
	var authScope &#x3D; new String(scopesRequested.getAuthorizationRequest().getScope());

	msg.put(&quot;scopes.requested.converted&quot;,  authScope.substring(1, authScope.length-1));

	//Récupération des scopes obtenus
	//Attention : Obtention d&#x27;une chaine du type &quot;[urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0,urn:cdc:poc:libraire:api:1.0]&quot;
	var accessToken &#x3D; msg.get(&quot;accesstoken&quot;);
	var scopesObtained &#x3D; new String(accessToken.getScope());
	
	//Transformation sous la forme d&#x27;un tableau
	msg.put(&quot;scopes.obtained.converted&quot;,  scopesObtained.substring(1, scopesObtained.length-1));

	return true;         
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Convert Scopes Requested and Obtained to String</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode base64 JWT Token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);
importPackage(Packages.com.vordel.common.base64);

function invoke(msg)         
{        
    var base64EncodedData &#x3D; msg.get(&quot;jwt.token.b64&quot;);

    Trace.debug(base64EncodedData + &quot;:&quot; + base64EncodedData );
    var dataDecoded &#x3D; Decoder.decodeToString(base64EncodedData);

    //obtention d&#x27;un jeton JWT : uniquement la partie PAYLOAD

    msg.put(&quot;jwt.token&quot;, dataDecoded  );
    return true;        
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode base64 JWT Token</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set authentication.subject.id with username</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.authn.getUserAuthentication()}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set authentication.subject.id with username</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Add HTTP Header Authorization</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>Authorization</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${jwt.token.signed}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add HTTP Header Authorization</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Message Tranform JWT Token</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message Tranform JWT Token</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>${jwt.token}</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>application/json</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeRequested</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.requested.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeRequested</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Call &#x27;ICDC - Trace Technique Start{1}&#x27;</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Call &#x27;ICDC - Trace Technique Start{1}&#x27;</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Original Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Original Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute jwt.token.b64</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>jwt.token.b64</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${accesstoken.getAdditionalInformation().get(&quot;jwttoken&quot;)}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute jwt.token.b64</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Initialise Piste Audit Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Initialise Piste Audit Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Add urn:cdc:claims:scopeObtained</h3>
    <table>           
            <tr>
                <td>expression</td>
                <td>$</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>content</td>
                <td>&quot;${scopes.obtained.converted}&quot;</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>objectFieldName</td>
                <td>urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>insertLocationType</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Add urn:cdc:claims:scopeObtained</td>
            </tr>           
            <tr>
                <td>expressionType</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :SSL</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>SSL authentication passed for ${authentication.subject.id}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>SSL authentication failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>SSL</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred during SSL authentication. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Control of http-signature header</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.java.security);
importPackage(Packages.com.vordel.trace);
importPackage(Packages.java.util);
importPackage(org.apache.commons.codec.binary.*);
importPackage (java.security.*);
importPackage (java.security.spec.*);
importPackage (com.vordel.jose.crypto.*);

function invoke(msg)         
{       
   try{
	//On récupère la clé publique du certificat et le header http-signature
	var certificate&#x3D; msg.get(&quot;certificate&quot;);
	var signatureHeader&#x3D; msg.get(&quot;params.header.Signature&quot;);
	var paramsHeader&#x3D; msg.get(&quot;params.in.header&quot;);
	var contentHeaders&#x3D; msg.get(&quot;http.content.headers&quot;);
	var method&#x3D;msg.get(&quot;http.request.method&quot;);
	var uri &#x3D;msg.get(&quot;http.request.rawURI&quot;);
	
	Trace.debug(&quot;certificate :&quot;+certificate );

	if (certificate  !&#x3D; null &amp;&amp; certificate  !&#x3D;&#x27;&#x27;) {

		var publicKey &#x3D; certificate.getPublicKey();
		var algo&#x3D; publicKey.getAlgorithm();
		var format&#x3D; publicKey.getFormat();
		Trace.debug(&quot;algo :&quot;+algo );
		Trace.debug(&quot;format :&quot;+format );
		Trace.debug(&quot;signatureHeader:&quot;+signatureHeader );
		var signatureSplit&#x3D; signatureHeader.replace(&#x27;&quot;&#x27;,&#x27;&#x27;).split(&quot;,&quot;);
		var maMap &#x3D; new Object();
		for ( i &#x3D;0 ; i &lt;signatureSplit.length ; i++) {
		   var mapkey&#x3D;signatureSplit[i];
		   var mapkeySplit&#x3D;mapkey.split(&quot;&#x3D;&quot;);
		   var key&#x3D; mapkeySplit[0];
		   var value&#x3D;  mapkeySplit[1];
		   maMap[key] &#x3D; value;			
		}


		for(var key in maMap ){
 	  		Trace.debug(&#x27;key is :&#x27; + key + &#x27; and value is : &#x27;+ maMap [key]);
		}

		var headersString &#x3D; maMap [&#x27;headers&#x27;];
		var headersList &#x3D; new java.util.ArrayList();

		var headersStringSplit&#x3D; headersString.toLowerCase().split(&quot; +&quot;);
		var dataToSign&#x3D; new java.lang.String(&quot;&quot;);
		for ( i &#x3D;0 ; i &lt;headersStringSplit.length ; i++) {
		    var key &#x3D; headersStringSplit[i];		    
		    if (&quot;(request-target)&quot;.equals(key)) {
			dataToSign &#x3D; new java.lang.String(dataToSign +&quot; (request-target):&quot;+&quot; &quot;+ method+&quot; &quot;+ uri +&quot;\n&quot;);
		   }
		   else{
			var value &#x3D; paramsHeader.get(headersStringSplit[i]);
			if(value  &#x3D;&#x3D; null){
				value &#x3D; contentHeaders.get(headersStringSplit[i]);
			}
			dataToSign&#x3D; new java.lang.String(dataToSign + key + &quot;: &quot; + value+&quot;\n&quot;);
		   }				
		}	
	
		Trace.debug(&quot;dataToSign  :&quot;+dataToSign  );

		var signature&#x3D;maMap [&#x27;signature&#x27;];
	   	signature&#x3D;new java.lang.String(signature+&quot;&#x3D;&#x3D;&quot;);
	
		Trace.debug(&quot;requestSignature   :&quot;+ signature );
		
		// code a supprimer 
		var kf &#x3D; java.security.KeyFactory.getInstance(&quot;RSA&quot;);
		
      		var privateEncryptedKeyContent&#x3D;&quot;MIIE6TAbBgkqhkiG9w0BBQMwDgQIztF9d+yVDqUCAggABIIEyB+3JnayJNh6dKdiDLTZ2Ehz2RJorymXFK+WgEJ62UhCN/WJF6/84eTRmHDw15c8zhTHyl6ErkBVAd74d/WmTyxfTQKl+t7noZ4lCg2Th9fNoz/ibZ5+EpMI3cxYKUm6h/fXabPBvUC6kORUfcIqzWloyMntHK2ZHjbFAY3my5HU+gpdZsoAxPuk1O7FWvxcuCd3K+/FrnJboEHmy5VWE9tM1rq78gVEkKwriNFeLPI/nZR8QtoEdF/ElqpGVfU+Jx4fIygc03L+x8v4UFzV8SYM1ejNEHwBBsN3ocGlZkuYpAjnZru+5LzHpWQmt3NAk9oI8Z47xCgiHalO1/fuxxgtctN1hC7a0u8JZYQf6lvAXCLo3jgbJzEuV/eprM/fI9m7XT+txqV1MVW1x+nuYEQL7N1Al4GZTt7vDYpqI3eCzlrBWXjQj8ETD7zoI4O88i6mi2VkT3UomNXWXzdQS4E50M+WbrQuQUs470EdTQDOfNbVudWCZ65UQVG5QjQ/aLds6tss4qrKYzywFcDVAGW3qXWm7t7M02boUEGJfC/XO8dSVGrZqLrzjerauWo/p9okTr+Mu8T5u19PaFIWailq28/f27i3GU2uwWzInHY4S1VPk/DV2zhq4OsxpnCOMIwNfiEpnX8PMKUFSu798z6l7ohQYdjZNUoY/4EEnOSYF57GV9L7Vxyy4wfjkTnRrx0hHODNd0H//qBRNDzCGyQLdo7UOh3+UtC4WVIJs5AboSFof6IVI+AtGJ4cQ353KLqCQZtudzqg9iDRwU/0wXor5B7jDqWyU9/zpYlcjg0jJRsZWanr4tof8HDJpIvsC2FP8xVBBMFpk08O4ZVTkeEeeJPBG51mbd9PyEoOeWFgZuGpYvr6loeuJx30dLV6FlPlEYAP0DijJTEywoEw+adQY9aY+zMnVcrrkSGTwl8FQ+8MurISiOsyGee2wNAYT1wxKQ0FgDf+mAvFHfMQG16GVsHlKbf0HRnAhFLpmIciWjImyfxSzl/psqFIDfPqyCEdGKXfx660FtDeagrl/so4VJC+Yejfs35inribkPswq2+qdBHOdiYkwel4bcL8S/lNDE36V8mnhhCdVgPJMs8BZIDVEga95o0avqQAbjVtrnDqCCkBRf7cOiIeS/rcjzn8CtB7w6JNgrFhqRdSeyTfHJGts4ATlAneL4CWRHH4Q+c2CFd6+0X9aiEKiUrULGLJFrfp4A3iXB0UhG7th7hmDKdsJ1g9CJyi/12kbNrJzMLe86LDotybf0C2fM91nVT+nuu+9hTdekUjhmq+1v5qyP8kAk9hAyMdpcvp1i2OqBg9BCp+ewos85MB6MnueGSeYqsna9oJJNc58RidEnoAvOnnlOQ/RlBym/IDVzQrG3ArSuL8LS9DnhrvfRmD1fLZ5kU90dbyVyrBP4I0cbHdRID7qZAKGgfaNpG7O7ohK1kNw2inmnq/ZNDw/K9tbZ3ZcrFqJi6bQvE0t9Yu9NWSZE791l4M6tUDLRdz3ll/d8DNx0MPXedC5aj1BA6Hg5iGRGsRXkXSxTLHV6hae9VRTGy+1OEcg3dVXcnp0Ommm/R9x8yzc1Qk8mo/ZvZRPYLeaNZ5x92taIt6M4DSqrhj05lRgW4hWA&#x3D;&#x3D;&quot;;

		var password&#x3D; new java.lang.String(&quot;password&quot;);
		var passKeySpec &#x3D; new javax.crypto.spec.PBEKeySpec(password.toCharArray());

     	var encryptedKey &#x3D; new javax.crypto.EncryptedPrivateKeyInfo(Base64.getDecoder().decode(privateEncryptedKeyContent));
       	Trace.debug(&quot;encryptedKey.getAlgName(): &quot; +  encryptedKey.getAlgName());
       	
		var keyFac &#x3D; javax.crypto.SecretKeyFactory.getInstance(encryptedKey.getAlgName());//PBES2
        var passKey &#x3D; keyFac.generateSecret(passKeySpec);

        // Create PBE Cipher
        var pbeCipher &#x3D; javax.crypto.Cipher.getInstance(encryptedKey.getAlgName());
        // Initialize PBE Cipher with key and parameters
	    pbeCipher.init(javax.crypto.Cipher.DECRYPT_MODE, passKey, encryptedKey.getAlgParameters());

		var privateKeyBytes &#x3D;  pbeCipher.doFinal(encryptedKey.getEncryptedData())
		var privateKey &#x3D; kf.generatePrivate(new  java.security.spec.PKCS8EncodedKeySpec(privateKeyBytes));

		sha256signer &#x3D;new com.vordel.jose.crypto.RsaSHA256Signer(privateKey);
  	       var mySignature &#x3D; sha256signer.sign(dataToSign.getBytes() );

		Trace.debug(&quot;signDataWithMyCert   :&quot;+ new java.lang.String( Base64.getEncoder().encode(mySignature ))  );

		
		sha256verifier &#x3D;new com.vordel.jose.crypto.RsaSHA256Verifier(publicKey  );
	    	sha256verifier.verifySignature(dataToSign.getBytes() , Base64.getDecoder().decode(signature) );		

		Trace.debug(&quot;Signature Verification OK&quot;);

		return true;

	}
	else{
		// Pas de certificat dans la requete
		return false
	} 
 } 
  catch (exp){
	Trace.error(exp);
	return false;		
 }
     
}</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Control of http-signature header</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :&#x27;Set Error Attributs</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>&#x27;Set Error Attributs</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :False Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>False Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute authentication.subject.id with app name</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${authentication.application.name}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute authentication.subject.id with app name</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Find Certificate</h3>
    <table>           
            <tr>
                <td>certDetails</td>
                <td></td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Found a certificate in the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to find certificate in message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>certLocation</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Find Certificate</td>
            </tr>           
            <tr>
                <td>attributeName</td>
                <td>certificate</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while finding certificate in message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Do the validation of http-signature ?</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Do the validation of http-signature ?</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-TransactionID</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-TransactionID</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${id}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-TransactionID</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :JSON Path Extract Login</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>JSON Path Extract Login</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Add X-Login</h3>
    <table>           
            <tr>
                <td>base64Encode</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>X-Login</td>
            </tr>           
            <tr>
                <td>addWhere</td>
                <td>httpheaders</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>headerValue</td>
                <td>${Login}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Success in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>overwriteExistingHeader</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in adding the HTTP header to the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Add X-Login</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in adding the HTTP header to the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header signature // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>signature</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header signature // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header user_cert  // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>user_cert</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header user_cert  // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Remove HTTP Header SSL_CLIENT_CERT // JNV</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in removing the HTTP header from the message</td>
            </tr>           
            <tr>
                <td>headerName</td>
                <td>SSL_CLIENT_CERT</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Remove HTTP Header SSL_CLIENT_CERT // JNV</td>
            </tr>           
            <tr>
                <td>errorNoHeader</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in removing the HTTP header from the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Revoke Token</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Revoke_Token.svg">
    <table>
        <tr>
            <td>start</td>
            <td>Gestion Certificat ? // Test RECO</td>
        </tr>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Revoke Token</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>tokenStore</td>
            <td></td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Revoke OAuth token</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Revoke OAuth token</td>
        </tr>
        <tr>
            <td>circuitPK</td>
            <td>ICDC IDP - Presence Certificat</td>
        </tr>
    </table>
    <h3>filter :Revoke OAuth token</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>serviceName</td>
                <td></td>
            </tr>           
            <tr>
                <td>clientSecretHeaderName</td>
                <td>client_secret</td>
            </tr>           
            <tr>
                <td>clientIdHeaderName</td>
                <td>client_id</td>
            </tr>           
            <tr>
                <td>compositeContext</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>locationOfClientDetails</td>
                <td>AuthorizationHeader</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>metricsMask</td>
                <td>3</td>
            </tr>           
            <tr>
                <td>clientAttributeName</td>
                <td>authentication.subject.id</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Revoke OAuth token</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Gestion Certificat ? // Test RECO</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Gestion Certificat ? // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :ICDC IDP - Presence Certificat // Test RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in calling policy shortcut</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>ICDC IDP - Presence Certificat // Test RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in calling policy shortcut circuit. Error: ${circuit.exception}</td>
            </tr>           
    </table>

    <h2>Policy : ICDC IDP - Controle Certificat</h2>
    <img src="file://///wsl$/Ubuntu/home/seb/src/fed_analyze/svg/ICDC_IDP_-_Controle_Certificat.svg">
    <table>
        <tr>
            <td>name</td>
            <td>ICDC IDP - Controle Certificat</td>
        </tr>
        <tr>
            <td>start</td>
            <td>Extract Certificate Attributes</td>
        </tr>
        <tr>
            <td>description</td>
            <td></td>
        </tr>
        <tr>
            <td>logMask</td>
            <td>3</td>
        </tr>
        <tr>
            <td>category</td>
            <td>miscellaneous</td>
        </tr>
        <tr>
            <td>successNode</td>
            <td>Controle Certificat #3</td>
        </tr>
        <tr>
            <td>failureNode</td>
            <td>Erreur 401 - qcStatements KO // RECO</td>
        </tr>
    </table>
    <h3>filter :Extract Certificate Attributes</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Extracted attributes from certificate</td>
            </tr>           
            <tr>
                <td>certAttribute</td>
                <td>${certificate}</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to extract attributes from certificate</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>extractDistributionPoints</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract Certificate Attributes</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while extracting attributes from certificate. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Decode String Hexa</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>importPackage(Packages.com.vordel.trace);

function invoke(msg)         {

var OrganizationIdentifier &#x3D; msg.get(&quot;cert.subject.id.2.5.4.97&quot;);
Trace.debug(&quot;OrganizationIdentifier : &#x27;&quot;+ OrganizationIdentifier + &#x27;!&#x27;);
var hex  &#x3D; OrganizationIdentifier.toString();

// Decoder chaîne Hexa
var str &#x3D; &#x27;&#x27;;
	for (var n &#x3D; 5; n &lt; hex.length(); n +&#x3D; 2) {
		str +&#x3D; String.fromCharCode(parseInt(hex.substr(n, 2), 16));
	}

Trace.debug(&quot;OrganizationIdentifierDecod : &quot;+ str);
 msg.put(&quot;OrganizationIdentifier&quot;,  str);

           return true;         }</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Decode String Hexa</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>js</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Récupérer clientId_transco</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Récupérer clientId_transco</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :clientId_transco is not null</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>clientId_transco is not null</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :// Erreur 401 - Transco KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Erreur 401 - Transco KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :// Transco KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>// Transco KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Store Message</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in storing the message to attribute </td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to store the message in attribute</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Store Message</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>store.content.body</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in storing the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :String Replace // Test RECO</h3>
    <table>           
            <tr>
                <td>regexMatchString</td>
                <td></td>
            </tr>           
            <tr>
                <td>destAttributeOverride</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>replacementString</td>
                <td></td>
            </tr>           
            <tr>
                <td>straightMatchString</td>
                <td>-----END CERTIFICATE-----</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>matchBehaviour</td>
                <td>MATCH_FIRST</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>destAttribute</td>
                <td></td>
            </tr>           
            <tr>
                <td>name</td>
                <td>String Replace // Test RECO</td>
            </tr>           
            <tr>
                <td>sourceAttribute</td>
                <td>http.header.SSL_CLIENT_CERT_modif</td>
            </tr>           
            <tr>
                <td>matchMode</td>
                <td>STRAIGHT_REPLACE</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Set Message // RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in setting the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed in setting the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Message // RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>body</td>
                <td>-----BEGIN CERTIFICATE-----
${http.header.SSL_CLIENT_CERT_modif}
-----END CERTIFICATE-----</td>
            </tr>           
            <tr>
                <td>outputContentType</td>
                <td>plain/text</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in setting the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Order query.scopesRequested // Test RECO</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import com.vordel.trace.Trace;

def invoke(msg)     
{  
String scopesRequested &#x3D;msg.get(&quot;params.query.scope&quot;);
String scopesRequestedtri &#x3D; &quot;&quot;;
if(scopesRequested !&#x3D; null ){
	if (scopesRequested.contains(&quot;aisp&quot;)) scopesRequestedtri &#x3D; &quot;aisp&quot;;
	if (scopesRequested.contains(&quot;cbpii&quot;)) scopesRequestedtri &#x3D; scopesRequestedtri + &quot; &quot; + &quot;cbpii&quot;;
	if (scopesRequested.contains(&quot;pisp&quot;)) scopesRequestedtri &#x3D; scopesRequestedtri + &quot; &quot; + &quot;pisp&quot;;

	msg.put(&quot;query.scopesRequestedtri&quot;, scopesRequestedtri );

	 return true;         
	}
else return false;
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Order query.scopesRequested // Test RECO</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :test qcStatements</h3>
    <table>           
            <tr>
                <td>matchingRule</td>
                <td>MATCH_ALL</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Filter passed</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>test qcStatements</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Filter aborted due to exception</td>
            </tr>           
    </table>
    <h3>filter :Erreur 401 - qcStatements KO // RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Copied attributes successfully</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to copy attributes</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Erreur 401 - qcStatements KO // RECO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error occurred while copying attributes. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :qcStatements KO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td></td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Filter failed</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>qcStatements KO</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>False filter error. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract &amp; Order qcStatements // RECO</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.io.FileInputStream;
import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.security.cert.CertificateExpiredException
import java.security.cert.CertificateFactory;
import java.security.cert.CertificateNotYetValidException
import java.security.cert.X509Certificate;
import com.vordel.trace.Trace;
import com.vordel.common.base64.Decoder;
import java.util.Map;
import org.bouncycastle.asn1.ASN1InputStream;
import org.bouncycastle.asn1.DEROctetString;
import org.bouncycastle.asn1.DERSequence;
import org.bouncycastle.asn1.ASN1Sequence;
import org.bouncycastle.asn1.x509.qualified.QCStatement;
import org.bouncycastle.asn1.ASN1Encodable;

def invoke(msg) 
{
		def base64EncodedData &#x3D; msg.get(&quot;psd2.base64certificate&quot;);
		String roleStringTri &#x3D; &quot;&quot;;
               if(base64EncodedData !&#x3D; null ){
                                             
                              InputStream inStream &#x3D; null;
                              try {
                                             
                                             inStream &#x3D; new ByteArrayInputStream(base64EncodedData.getBytes());
                                           Trace.debug(new String(base64EncodedData.getBytes()));   
						CertificateFactory cf &#x3D; CertificateFactory.getInstance(&quot;X.509&quot;);
                                             X509Certificate cert &#x3D; (X509Certificate)cf.generateCertificate(inStream);
                                             if (cert !&#x3D; null) {
                                                            try {
                                                                           Trace.debug(cert.toString());         
                                                                           extensionValue&#x3D; cert.getExtensionValue(&quot;1.3.6.1.5.5.7.1.3&quot;)
                                                                           Trace.debug(&quot;&gt;&gt;&gt; extension: &quot; + extensionValue.toString());         
                                                                           ASN1Sequence qcStatements;
                                                         ASN1InputStream derAsn1InputStream &#x3D; new ASN1InputStream(new ByteArrayInputStream(extensionValue));
                                                           DEROctetString oct &#x3D; (DEROctetString) derAsn1InputStream.readObject();
							Trace.debug(&quot;&gt;&gt;&gt; oct : &quot; + oct );     
                                                                           derAsn1InputStream.close();
                                                           ASN1InputStream asn1InputStream &#x3D; new ASN1InputStream(oct.getOctets());
                                            qcStatements &#x3D; (ASN1Sequence) asn1InputStream.readObject();
							Trace.debug(&quot;&gt;&gt;&gt; qcStatements  : &quot; + qcStatements );     
                                                                           
                                                                           asn1InputStream.close();
                                       // Certificat CDC//
                                                  //QCStatement statement &#x3D; QCStatement.getInstance(qcStatements.getObjectAt(0));
                                                  //Trace.debug(&quot;&gt;&gt;&gt;  statement: &quot; +  statement);
									   // Certificat Eurobits//
                                                  //QCStatement statement &#x3D; QCStatement.getInstance(qcStatements.getObjectAt(3));
                                                  //Trace.debug(&quot;&gt;&gt;&gt;  statement: &quot; +  statement);
									   // Rajout qcStatement 0.4.0.19495.2
										for ( int j &#x3D; 0;  j &lt; qcStatements.size(); j++){
											QCStatement statement &#x3D; QCStatement.getInstance(qcStatements.getObjectAt(j));
											Trace.debug(&quot;&gt;&gt;&gt;  statementLoop: &quot; +  statement);
											Trace.debug(&quot;&gt;&gt;&gt;  getStatementId: &quot; +  statement.getStatementId().getId());
											if (statement.getStatementId().getId().contains(&quot;0.4.0.19495.2&quot;)) {
													Trace.debug(&quot;&gt;&gt;&gt;  sequenceStatementIdStringYES&quot;);
													///////////
													ASN1Encodable statementInfo &#x3D; statement.getStatementInfo();
										Trace.debug(&quot;&gt;&gt;&gt;  statementInfo : &quot; +  statementInfo);
                                                                           ASN1Sequence sequence &#x3D; ASN1Sequence.getInstance(statementInfo);
										Trace.debug(&quot;&gt;&gt;&gt;  sequence : &quot; +  sequence);
                                                                           ASN1Sequence seqroles &#x3D; ASN1Sequence.getInstance(sequence.getObjectAt(0));
										Trace.debug(&quot;&gt;&gt;&gt;  seqroles: &quot; +  seqroles);
                                                                           String[] roles &#x3D;  new String[4];
									   String rolestring &#x3D; null;
                                                                           for ( int i &#x3D; 0;  i &lt; seqroles.size(); i++){
                                                                                          ASN1Sequence seqRole &#x3D; ASN1Sequence.getInstance(seqroles.getObjectAt(i));
                                    roles[i] &#x3D;  seqRole.getObjectAt(1).getString();
					Trace.debug(&quot;&gt;&gt;&gt; role: &quot; + roles[i]);
					rolestring &#x3D; rolestring + &quot;,&quot; + seqRole.getObjectAt(1).getString();
					rolestring &#x3D; rolestring.replace(&quot;PSP_PI&quot;, &quot;pisp&quot;).replace(&quot;PSP_AI&quot;, &quot;aisp&quot;).replace(&quot;PSP_IC&quot;, &quot;cbpii&quot;).replace(&quot;null&quot;,&quot;&quot;).replace(&quot;,&quot;,&quot; &quot;);
					if (rolestring.contains(&quot;aisp&quot;)) roleStringTri &#x3D; &quot;aisp&quot;;
					if (rolestring.contains(&quot;cbpii&quot;)) roleStringTri &#x3D; roleStringTri  + &quot; &quot; + &quot;cbpii&quot;;
					if (rolestring.contains(&quot;pisp&quot;)) roleStringTri &#x3D; roleStringTri  + &quot; &quot; + &quot;pisp&quot;;
					Trace.debug(&quot;&gt;&gt;&gt; rolestring : &quot; + rolestring);
					Trace.debug(&quot;&gt;&gt;&gt; rolestringtri : &quot; + roleStringTri);
                                                                           }
                                             msg.put(&quot;certificate.roles&quot;, roles);
                                             msg.put(&quot;certificate.rolestring&quot;, rolestring );
                                             msg.put(&quot;certificate.rolestringtri&quot;, roleStringTri );
												}else{
													Trace.error(&quot;Le certificat ne contient pas de qcStatements valide&quot;);
												}
										}

										// Fin Rajout
										
										

                                                                                      
                                                            }catch(CertificateExpiredException e1) {
                                                                           Trace.error(&quot;Invalid QWAC certificate. Certificate is expired&quot;);
                                                            }catch(CertificateNotYetValidException e2) {
                                                                           Trace.error(&quot;Invalid QWAC certificate. Certificate is not yet valid&quot;);
                                                            }
                                             }

                              } catch(Exception e){
                                             Trace.error (e);
                              }finally {
                                             if (inStream !&#x3D; null) {
                                                            inStream.close();
                                             }
                              }
                              
               }
       return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract &amp; Order qcStatements // RECO</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Set Attribute Filter</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Set the attribute value</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to set the attribute value</td>
            </tr>           
            <tr>
                <td>messageAttribute</td>
                <td>psd2.base64certificate</td>
            </tr>           
            <tr>
                <td>attributeValue</td>
                <td>${content.body}</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Set Attribute Filter</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while setting the attribute value. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Restore Message // RECO</h3>
    <table>           
            <tr>
                <td>logSuccess</td>
                <td>Success in restoring the message</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to restore the message</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Restore Message // RECO</td>
            </tr>           
            <tr>
                <td>attributeToUse</td>
                <td>${store.content.body}</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error in restoring the message. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Trace Filter Controle Certificat #1 // Reco</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Trace Filter Controle Certificat #1 // Reco</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Controle Certificat #2</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Controle Certificat #2</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Controle Certificat #3</h3>
    <table>           
            <tr>
                <td>traceBody</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>traceMsg</td>
                <td></td>
            </tr>           
            <tr>
                <td>traceLevel</td>
                <td>5</td>
            </tr>           
            <tr>
                <td>doIndent</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Traced the message properties</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed to trace the message properties</td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Controle Certificat #3</td>
            </tr>           
            <tr>
                <td>traceAttributes</td>
                <td>1</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while tracing the message properties. Error: ${circuit.exception}</td>
            </tr>           
    </table>
    <h3>filter :Extract &amp; Order qcStatements // RECO &#x3D;&gt; save</h3>
    <table>           
            <tr>
                <td>abortProcessingOnLogError</td>
                <td>0</td>
            </tr>           
            <tr>
                <td>logMask</td>
                <td>2</td>
            </tr>           
            <tr>
                <td>generatedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>script</td>
                <td>import java.io.FileInputStream;
import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.security.cert.CertificateExpiredException
import java.security.cert.CertificateFactory;
import java.security.cert.CertificateNotYetValidException
import java.security.cert.X509Certificate;
import com.vordel.trace.Trace;
import com.vordel.common.base64.Decoder;
import java.util.Map;
import org.bouncycastle.asn1.ASN1InputStream;
import org.bouncycastle.asn1.DEROctetString;
import org.bouncycastle.asn1.DERSequence;
import org.bouncycastle.asn1.ASN1Sequence;
import org.bouncycastle.asn1.x509.qualified.QCStatement;
import org.bouncycastle.asn1.ASN1Encodable;

def invoke(msg) 
{
		def base64EncodedData &#x3D; msg.get(&quot;psd2.base64certificate&quot;);
		String roleStringTri &#x3D; &quot;&quot;;
               if(base64EncodedData !&#x3D; null ){
                                             
                              InputStream inStream &#x3D; null;
                              try {
                                             
                                             inStream &#x3D; new ByteArrayInputStream(base64EncodedData.getBytes());
                                           Trace.debug(new String(base64EncodedData.getBytes()));   
						CertificateFactory cf &#x3D; CertificateFactory.getInstance(&quot;X.509&quot;);
                                             X509Certificate cert &#x3D; (X509Certificate)cf.generateCertificate(inStream);
                                             if (cert !&#x3D; null) {
                                                            try {
                                                                           Trace.debug(cert.toString());         
                                                                           extensionValue&#x3D; cert.getExtensionValue(&quot;1.3.6.1.5.5.7.1.3&quot;)
                                                                           Trace.debug(&quot;&gt;&gt;&gt; extension: &quot; + extensionValue.toString());         
                                                                           ASN1Sequence qcStatements;
                                                         ASN1InputStream derAsn1InputStream &#x3D; new ASN1InputStream(new ByteArrayInputStream(extensionValue));
                                                           DEROctetString oct &#x3D; (DEROctetString) derAsn1InputStream.readObject();
							Trace.debug(&quot;&gt;&gt;&gt; oct : &quot; + oct );     
                                                                           derAsn1InputStream.close();
                                                           ASN1InputStream asn1InputStream &#x3D; new ASN1InputStream(oct.getOctets());
                                            qcStatements &#x3D; (ASN1Sequence) asn1InputStream.readObject();
							Trace.debug(&quot;&gt;&gt;&gt; qcStatements  : &quot; + qcStatements );     
                                                                           
                                                                           asn1InputStream.close();
                                             			   // Certificat CDC
                                                                          QCStatement statement &#x3D; QCStatement.getInstance(qcStatements.getObjectAt(0));
									   Trace.debug(&quot;&gt;&gt;&gt;  statement: &quot; +  statement);
									   // Certificat Eurobits
                                                                   //        QCStatement statement &#x3D; QCStatement.getInstance(qcStatements.getObjectAt(3));
										//Trace.debug(&quot;&gt;&gt;&gt;  statement: &quot; +  statement);
                                                                           ASN1Encodable statementInfo &#x3D; statement.getStatementInfo();
										Trace.debug(&quot;&gt;&gt;&gt;  statementInfo : &quot; +  statementInfo);
                                                                           ASN1Sequence sequence &#x3D; ASN1Sequence.getInstance(statementInfo);
										Trace.debug(&quot;&gt;&gt;&gt;  sequence : &quot; +  sequence);
                                                                           ASN1Sequence seqroles &#x3D; ASN1Sequence.getInstance(sequence.getObjectAt(0));
										Trace.debug(&quot;&gt;&gt;&gt;  seqroles: &quot; +  seqroles);
                                                                           String[] roles &#x3D;  new String[4];
									   String rolestring &#x3D; null;
                                                                           for ( int i &#x3D; 0;  i &lt; seqroles.size(); i++){
                                                                                          ASN1Sequence seqRole &#x3D; ASN1Sequence.getInstance(seqroles.getObjectAt(i));
                                    roles[i] &#x3D;  seqRole.getObjectAt(1).getString();
					Trace.debug(&quot;&gt;&gt;&gt; role: &quot; + roles[i]);
					rolestring &#x3D; rolestring + &quot;,&quot; + seqRole.getObjectAt(1).getString();
					rolestring &#x3D; rolestring.replace(&quot;PSP_PI&quot;, &quot;pisp&quot;).replace(&quot;PSP_AI&quot;, &quot;aisp&quot;).replace(&quot;PSP_IC&quot;, &quot;cbpii&quot;).replace(&quot;null&quot;,&quot;&quot;).replace(&quot;,&quot;,&quot; &quot;);
					if (rolestring.contains(&quot;aisp&quot;)) roleStringTri &#x3D; &quot;aisp&quot;;
					if (rolestring.contains(&quot;cbpii&quot;)) roleStringTri &#x3D; roleStringTri  + &quot; &quot; + &quot;cbpii&quot;;
					if (rolestring.contains(&quot;pisp&quot;)) roleStringTri &#x3D; roleStringTri  + &quot; &quot; + &quot;pisp&quot;;
					Trace.debug(&quot;&gt;&gt;&gt; rolestring : &quot; + rolestring);
					Trace.debug(&quot;&gt;&gt;&gt; rolestringtri : &quot; + roleStringTri);
                                                                           }
                                                                                                                                                                                    
                                             msg.put(&quot;certificate.roles&quot;, roles);
                                             msg.put(&quot;certificate.rolestring&quot;, rolestring );
                                             msg.put(&quot;certificate.rolestringtri&quot;, roleStringTri );
                                                                                      
                                                            }catch(CertificateExpiredException e1) {
                                                                           Trace.error(&quot;Invalid QWAC certificate. Certificate is expired&quot;);
                                                            }catch(CertificateNotYetValidException e2) {
                                                                           Trace.error(&quot;Invalid QWAC certificate. Certificate is not yet valid&quot;);
                                                            }
                                             }

                              } catch(Exception e){
                                             Trace.error (e);
                              }finally {
                                             if (inStream !&#x3D; null) {
                                                            inStream.close();
                                             }
                              }
                              
               }
       return true;         
}
</td>
            </tr>           
            <tr>
                <td>logSuccess</td>
                <td>Passed script filter</td>
            </tr>           
            <tr>
                <td>logFailure</td>
                <td>Failed script filter</td>
            </tr>           
            <tr>
                <td>requiredProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>logMaskType</td>
                <td>SERVICE</td>
            </tr>           
            <tr>
                <td>name</td>
                <td>Extract &amp; Order qcStatements // RECO &#x3D;&gt; save</td>
            </tr>           
            <tr>
                <td>consumedProperties</td>
                <td></td>
            </tr>           
            <tr>
                <td>engineName</td>
                <td>groovy</td>
            </tr>           
            <tr>
                <td>logFatal</td>
                <td>Error while attempt to run script filter. Error: ${circuit.exception}</td>
            </tr>           
    </table>

</body>
</html>

